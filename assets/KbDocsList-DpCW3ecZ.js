import{r as u,j as e,c as _,S as V,h as f,R as O}from"./AlertSnackbar-lBoJjy_c.js";import{c as v}from"./index-B5a5-Oe8.js";import{S as z}from"./delete-Dfw_3a_o.js";import{S as G}from"./download-D5CI_YfG.js";import{S as M}from"./edit-RxqNA5mD.js";import{S as K}from"./plus-u7WazedS.js";import{S as H,T as Q}from"./TableFooter-BnxhuOHa.js";import"./Button-BfGblH0o.js";import{B as x}from"./Button-DHAZ_-yy.js";import{T as $}from"./TextBox-Io9DBbi-.js";import{s as S,h as D}from"./utils-BPLOM7gE.js";import{C as J}from"./ConfirmDialog-BOEnSzA2.js";import{b as W,c as X,d as Y,e as Z,f as ee}from"./trainingDocuments-Dtdtp5Mf.js";import{u as I}from"./useSelectedBot-CI1XJECK.js";import{P as te}from"./PageHeader-BZfM5_ha.js";import{S as se}from"./send-D06_uxgX.js";import{F as oe,a as ne,d as ae}from"./index-CyaiAzgH.js";import"./env-CmL5wTXD.js";import"./SelectBox-DwPOkUqL.js";import"./LabelWrapper-12hdQ5vw.js";import"./bots-BWStd7ep.js";import"./organization-BGFoSxhm.js";function T({onDone:o,initial:a,onUpdate:l}){const[s,n]=u.useState(a||{question:"",content:"",_id:""}),r=(i,d)=>{n(N=>({...N,[i]:d}))},c=async()=>{const i=await W(s);l?.(i),o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(oe,{value:s,onChange:n,children:[e.jsx(ne,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:i=>r("question",i)}),e.jsx(ae,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:i=>r("content",i)})]}),e.jsx("div",{className:"text-center",children:e.jsx(x,{icon:e.jsx(se,{}),size:"lg",type:"rounded",onClick:c,className:"bg-[#49d4a1]"})})]})}function Ee(o){const{activeIndex:a,onNavigate:l=()=>{},docsList:s,onUpdate:n}=o,r=_(t=>t.organizationId),[c]=I(),[i,d]=X(),N=s??i,[h,q]=u.useState(10),[p,C]=u.useState(1),[g,E]=u.useState(""),L=[10,15,20,25],j=(N||[]).filter(t=>!g||t.question?.toLowerCase().includes(g.toLowerCase())||t.content?.toLowerCase().includes(g.toLowerCase())),w=Math.ceil(j.length/h),y=(p-1)*h,B=y+h,b=j.slice(y,B),R=()=>D(),k=()=>S(e.jsx(T,{onDone:R,onUpdate:n}),{showCloseButton:!0,width:"700px"}),P=async()=>{try{await Y(),f(!0,"Documents downloaded successfully","success")}catch(t){console.error("Error while downloading docs:",t),f(!0,"Failed to download documents","error")}};u.useEffect(()=>{p>w&&C(1)},[j.length,w,p]);const F=t=>{const m=typeof t=="string"?parseInt(t,10):t;typeof m=="number"&&!isNaN(m)&&(q(m),C(1))},A=t=>{t<1||t>w||C(t)},U=async()=>{try{await Z({botDetailsForVerification:{integrationUrl:""}},r,c)?f(!0,"The bot deployed successfully","success"):f(!0,"Not able to deploy the bot. Try after sometime!","error"),a&&l(a+1)}catch(t){console.error("Error during bot verification:",t),f(!0,"Not able to verify the bot. Try after sometime!","error")}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!s&&!a&&e.jsx("div",{children:e.jsx(te,{title:"Chat Bot Knowledge",icon:K,onClick:k})}),!s&&!a&&e.jsx("div",{className:"flex justify-between items-center py-3 px-2",children:e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx($,{value:g,placeholder:"Search",onChange:t=>E(t.target.value),iconRight:H}),e.jsx(x,{icon:e.jsx(G,{}),size:"sm",type:"secondary",className:"align-middle ",onClick:P,title:"Download as CSV"})]})}),e.jsxs("div",{className:v("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":d}),children:[e.jsx("div",{className:"flex-1",children:d?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:e.jsx(V,{className:"animate-spin w-12 h-12 text-primary"})}):b.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"No documents found."}):b.map((t,m)=>e.jsx(re,{doc:t,index:y+m,onUpdate:n},t._id))}),!s&&e.jsx(Q,{columns:[],rowsCount:h,onChangeCount:F,rowsCounts:L,pageIndex:p,totalPages:w,onNavigate:A,totalRows:j.length})]}),a&&!s&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(x,{label:"GENERATE",onClick:U})})]})}function re({doc:o,index:a,onUpdate:l}){const[,s]=I(),[n,r]=O.useState(!1),c=()=>{S(e.jsx(T,{onDone:D,initial:{question:o.question||"",content:o.content||"",_id:o._id},onUpdate:l}),{showCloseButton:!0,width:"700px"})},i=async d=>{console.log("Deleting document with ID:",d),await ee(d)};return e.jsxs("div",{className:v("w-full flex flex-row px-4 py-3 gap-8 border-b border-gray-100",{"bg-white":a%2!==0,"bg-[#f7f7f7]":a%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!o.question&&e.jsx("span",{className:"font-normal text-md",children:o.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:o.content}),!!o.sourceDocument&&s?.trainingMedia?.length>0&&e.jsx(ie,{document:o,trainingMedia:s.trainingMedia})]}),e.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[e.jsx(x,{icon:e.jsx(z,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>r(!0)}),e.jsx(x,{icon:e.jsx(M,{height:24,width:24}),type:"plain",className:"me-8",onClick:c})]}),e.jsxs(J,{title:"Are sure you want to delete?",open:n,setOpen:r,onConfirm:()=>i(o._id),children:["Confirm the deletion ",o.question||o._id,"."]})]})}function ie({document:o,trainingMedia:a}){const l=o.sourceDocument,s=u.useMemo(()=>{if(!a||!l)return null;const n=a.find(c=>c.docId===l);if(!n)return null;let r="";return n.url?r=decodeURIComponent(n.url.substring(n.url.lastIndexOf("/")+1)):n.originalName&&(r=n.originalName),{...n,fileName:r}},[l,a]);return s?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),s.url?e.jsxs("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[s.fileName,s.name?` ( ${s.name} )`:""]}):e.jsx("span",{children:s.fileName||s.name||"Unknown Document"})]}):null}export{Ee as default};
