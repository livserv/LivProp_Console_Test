import{R as l,j as d,r as vt}from"./index-CVL0-hNc.js";import{K as nt,J as rt,L as $,M as xt,N as It,Q as Ct,a as St,V as Lt,C as jt}from"./index-DDLNUiI1.js";import{g as ot,p as Bt,R as Mt}from"./ajax-9LNCspkD.js";import{r as Tt}from"./env-CBDBHzQq.js";import{b as P}from"./svg-icons-YRpojHzj.js";let B=null;function kt(t){t.origin||(t.origin=null),t.botId||(t.botId=null);try{const{origin:n,botId:r}=t;B=new BroadcastChannel("lp_web_chat");const e=Et(t);return B.addEventListener("message",e),B.postMessage({action:"GetConversationId",origin:n,botId:r}),()=>{B&&(B.removeEventListener("message",e),B.close(),B=null)}}catch(n){console.error("Unable to start session sharing:",n)}}function Et({onHistoryChange:t,getHistory:n,origin:r=null,botId:e=null}){return c=>{const i=c.data||{};if(!(i.origin!==r||i.botId!==e))try{if(i.action==="GetConversationId"){const u=n();R(u,r,e)}else if(i.action==="SetConversationId"){const{conversationId:u,history:m}=i;u?nt(u||void 0):rt(),m&&(t==null||t(m))}}catch(u){console.log("Error occurred when trying to handle session sharing:",u)}}}function R(t,n,r,e){if(B)try{const c=$()||"";if(!e&&!c)return;B.postMessage({action:"SetConversationId",origin:n,botId:r,conversationId:c,history:t})}catch(c){console.error("Error sharing session:",c)}}function z(){return{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}}function Nt(t,n,r){var p;const{updateContact:e,onReceiveChatResponse:c,bot:i,locationDetails:u,onCallback:m,recipientId:f,history:b,chatFlowId:y,preferredLanguage:w}=n,{flowId:v,flowType:a}=((p=b==null?void 0:b[b.length-1])==null?void 0:p.media)||{};return typeof t=="string"&&v&&(t={method:"flow-response",type:a,flowId:v,answer:t}),(t==null?void 0:t.type)==="customForm"&&(t!=null&&t.answer)&&(t={method:"flow-response",type:a,flowId:v,answer:t.answer}),r?At(t,i,{onReceiveChatResponse:c,updateContact:e,onCallback:m,recipientId:f,chatFlowId:y,language:w},u):Ut(t,i,{onReceiveChatResponse:c,updateContact:e,onCallback:m,recipientId:f,chatFlowId:y,language:w},u)}async function Ut(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:c,recipientId:i,chatFlowId:u,language:m},f){const b=$(),{_id:y,organizationId:w,botSettings:v}=n,a={userQuery:t,recipientDetails:{recipientId:i,conversationId:b,language:m,...f},chatFlowId:u};r&&(a.testMode=!0);try{const p=await Bt(`/bot/${w}/${y}/chat`,a,{noAuth:!0});return r==null||r(p),st(p,{updateContact:e,botSettings:v,onCallback:c})}catch(p){return[{role:"assistant",type:"text",content:p.message||"Unknown Server error"}]}}async function At(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:c,recipientId:i,chatFlowId:u,language:m},f){const b=$(),{_id:y,organizationId:w,botSettings:v}=n,a={userQuery:t,recipientDetails:{recipientId:i,conversationId:b,language:m,...f},chatFlowId:u};r&&(a.testMode=!0);try{const I=await(await fetch(`${Tt}voicebot/voiceChat?organizationId=${w}&botId=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();return r==null||r(I.data),{data:st(I.data,{updateContact:e,botSettings:v,onCallback:c}),audioUri:I.data.audioUri}}catch(p){return console.log(p,"error"),[{role:"assistant",type:"text",content:p.message||"Unknown Server error"}]}}function st(t,{updateContact:n,botSettings:r,onCallback:e}){const{chatRefId:c,recipientId:i,messages:u}=t;return nt(c),e==null||e("set-visitor-id",{recipientId:i}),k(u,{updateContact:n,botSettings:r})}function k(t,{updateContact:n,botSettings:r}){if(!(t!=null&&t.length))return t;const e=t[t.length-1];return e.type==="form"&&t.push({role:"user",type:"lead",content:"",profile:e.media,updateContact:n,botSettings:r}),e.type==="customForm"&&(e.role==="assistant"&&(e.role="user"),Object.assign(e,{type:"customForm",content:"",media:e.media,updateContact:n,botSettings:r})),t}async function Dt(t){try{const n=await xt(),r=new URLSearchParams(window.location.search),e=r.get("token"),c=r.get("sourceUrl");let i=document.referrer;if(c&&i)try{const a=new URL(c).hostname,p=new URL(i).hostname;a===p&&(i="")}catch(a){console.error("Invalid URL in sourceUrl or referer:",a)}const u=(n==null?void 0:n.country_name)||"NA",m=(n==null?void 0:n.city)||"NA",f={authToken:e,recipientId:t,sourceUrl:c,referer:i,country:u,city:m},{startupFlow:b,hideChatWindow:y,googleTagManagerId:w,...v}=await ot("/bot/get-bot-details-by-auth-token",f,{noAuth:!0});return{startupFlow:b,hideChatWindow:y,googleTagManagerId:w,bot:v}}catch(n){console.log("Failed to init chat:-",n)}}async function tt(t,n,r,{autoLaunch:e,startupMessages:c}){const{_id:i,organizationId:u,botSettings:m={}}=t,f=$();if(!n||!f)return e?c||[z()]:[];try{const b=await ot(`/bot/${u}/${i}/chat/history/${n}/${f}`,null,{noAuth:!0}),{messages:y}=b||{};return k(y,{updateContact:r,botSettings:m})}catch(b){console.error("Failed to fetch chat history:-",b)}return e?[z()]:[]}function Ft({text:t="We are Online!",onHide:n,design:r,isLeft:e}){const c=$t(r,e),[i,u]=l.useState(!0),m=l.useCallback(f=>{f.preventDefault(),f.stopPropagation(),u(!1),n==null||n()},[n]);return i?d.jsxs("div",{className:"button-tooltip",style:c,children:[d.jsxs("div",{children:[d.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"}),d.jsx("b",{children:t}),d.jsx("br",{})]}),d.jsx("a",{className:"close-indicator",onClick:m,children:d.jsx("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:d.jsx("path",{d:"M1490 1245q0 40-24 68l-136 136q-24 24-68 24t-68-28l-294-294-294 294q-24 24-68 24t-68-28l-136-136q-24-24-24-68t24-68l294-294-294-294q-24-24-24-68t24-68l136-136q24-24 68-24t68 28l294 294 294-294q24-24 68-28t68 28l136 136q28 24 24 68t-24 68l-294 294 294 294q24 24 24 68z",fill:"#fff"})})})]}):null}function $t(t,n){let{spacingCorner:r,spacingBottom:e}=(t==null?void 0:t.launcher)||{};if(r=parseFloat(r)||void 0,e=parseFloat(e)||void 0,r&&(r+=5),e&&(e+=75),r||e)return{bottom:e,[n?"left":"right"]:r}}function Ht({isLeft:t,bgColor:n,secBgColor:r,imageUrl:e,chatIcon:c,barText:i="Live Chat",fontSize:u,color:m,autoAnimate:f=!0,style:b,onClick:y}){const w=t?"bottom-left":"bottom-right",v={backgroundColor:n},a={backgroundImage:`linear-gradient(90deg, ${n}, ${r})`},p=l.useRef(null);return l.useEffect(()=>{if(f){const I=setInterval(()=>{var L;(L=p.current)==null||L.classList.remove("bar-hide"),setTimeout(()=>{var S;return(S=p.current)==null?void 0:S.classList.add("bar-hide")},7e3)},35e3);return()=>clearInterval(I)}},[f]),d.jsxs("div",{className:`lp-launcher expand-button ${w}`,onClick:y,style:b,children:[d.jsx("div",{ref:p,className:"text-container bar-hide",style:a,children:d.jsx("div",{className:"bar-text",style:{minWidth:"150px",fontSize:u,color:m},children:d.jsxs("p",{children:["Hi there,"," ",d.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"})," ","We are online!"]})})}),d.jsx("div",{className:"image-container",style:v,children:d.jsxs("div",{className:"image-sub-container",children:[e&&d.jsx("img",{src:e,alt:i}),!e&&c]})})]})}function _t({design:t,onToggle:n}){const{launcher:{launcherType:r,buttonLogoUrl:e,buttonOnMobile:c,barText:i,fontSize:u,spacingCorner:m,spacingBottom:f,showMinimizeButtonToolTip:b=!0}={},header:{bgColor:y,secBgColor:w,fontColor:v}={},window:{fontFamily:a,align:p}={}}=t||{},I=p==="bottomLeft",L={bottom:f,[I?"left":"right"]:m};if(r==="icon"||c){const S=e&&e.endsWith(".svg");return d.jsxs("div",{id:"lp-launcher",className:"lp-launcher button "+(!e||S?" bordered":""),onClick:n,style:{borderColor:y,color:v,background:!e||S?"linear-gradient(to right,"+y+", "+w+")":"transparent",verticalAlign:"middle",padding:!e||S?"16px":void 0,display:"flex",...L},children:[b&&d.jsx(Ft,{design:t,isLeft:I}),e&&d.jsx("img",{src:e,alt:"Live Chat"}),!e&&P]})}else return r==="expand"?d.jsx(Ht,{isLeft:I,color:v,style:L,bgColor:y,secBgColor:w,imageUrl:e,chatIcon:P,barText:i,fontSize:u,onClick:n}):d.jsxs("div",{id:"lp-launcher",className:"lp-launcher bar",onClick:n,style:{background:"linear-gradient(to right, "+y+", "+w+")",color:v,fontFamily:a,...L},children:[e&&d.jsx("img",{src:e,alt:i}),!e&&P,d.jsx("span",{children:i||"Live Chat"})]})}function Gt({googleTagManagerId:t}){return vt.useEffect(()=>{if(!t||document.querySelector(`script[data-gtm="${t}"]`))return;if(window.dataLayer&&document.querySelector('script[src*="gtm.js"]')){console.log("GTM already loaded by server");return}const n=document.createElement("script");n.innerHTML=`
            (function(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
                var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','${t}');
        `,document.head.appendChild(n);const r=document.createElement("noscript");return r.innerHTML=`
          <iframe src="https://www.googletagmanager.com/ns.html?id=${t}"
            height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe>
        `,document.body.insertBefore(r,document.body.firstChild),()=>{document.head.removeChild(n),document.body.removeChild(r)}},[t]),null}function Wt({design:t}){const n=t==null?void 0:t.remoteFontLink;return n?Mt.createPortal(d.jsx("link",{rel:"stylesheet",href:n}),document.head,"remoteFont"):null}const Pt={window:{spacingCorner:"0px",spacingBottom:"7px"},launcher:{spacingCorner:"0px",spacingBottom:"7px"}},et=["lead","options","customForm","stop"];function Kt(t){var Y,Z,q;const{botDetails:n,botDesign:r,startupFlow:e,onReceiveChatResponse:c,autoLaunch:i,recipientId:u,origin:m,onCallback:f,optionsRenderer:b,fullscreen:y}=t,[w,v]=l.useState(i||!1),[a,p]=l.useState(r),[I,L]=l.useState(!1),[S,O]=l.useState(n),[H,Q]=l.useState(e),[it,_]=l.useState(e==null?void 0:e.messages),[ct,lt]=l.useState(u),[E,G]=l.useState([]),[V,dt]=l.useState(),[J,K]=l.useState(),[ut,gt]=l.useState(null),o=l.useRef({autoLaunch:i});if(y)try{const s=window.innerWidth+"px",g=window.innerHeight+"px";a.window.width=s,a.window.height=g,a.window.spacingBottom="0px",a.window.spacingCorner="0px",a.launcher.spacingBottom="0px",a.launcher.spacingCorner="0px"}catch(s){console.error("Error setting fullscreen design:",s)}o.current.recipientId=ct,o.current.bot=S,o.current.chatFlowId=H==null?void 0:H.flowId,o.current.startupMessages=it,o.current.origin=m,o.current.preferredLanguage=J;const ht=l.useCallback(s=>{It(s),K(s)},[]);o.current.setAndBroadcastHistory=l.useCallback(s=>{var g;typeof s=="function"?G(h=>{var x;const C=s(h);return R(C,o.current.origin,(x=o.current.bot)==null?void 0:x._id,!0),C}):(G(s),R(s,o.current.origin,(g=o.current.bot)==null?void 0:g._id,!0))},[]),o.current.onCallback=l.useCallback((s,g)=>{s==="set-visitor-id"&&g.recipientId&&lt(g.recipientId),f==null||f(s,g)},[f]),o.current.history=E,o.current.showBot=w,o.current.design=a,o.current.locationDetails=V,o.current.onReceiveChatResponse=c,o.current.isLoadedInConsole=!!c,l.useEffect(()=>{O(n)},[n]),l.useEffect(()=>{var h;const{updateContact:s,bot:g}=o.current;Q(e),(h=e==null?void 0:e.messages)!=null&&h.length?_(k([...e.messages],{updateContact:s,botSettings:g.botSettings})):_(!1)},[e]),l.useEffect(()=>{if(S&&!o.current.isLoadedInConsole)return kt({botId:S._id,origin:o.current.origin,onHistoryChange:s=>{var g;!(s!=null&&s.length)&&!((g=o.current.history)!=null&&g.length)||G(s)},getHistory:()=>o.current.history})},[S]),l.useEffect(()=>{p(r)},[r]),l.useEffect(()=>{K(Ct());const{updateContact:s,bot:g,recipientId:h,autoLaunch:C,setAndBroadcastHistory:x,startupMessages:F}=o.current;g?tt(g,h,s,{autoLaunch:C,startupMessages:k(F,{updateContact:s,botSettings:g.botSettings})}).then(x):Dt(h).then(N=>{if(!N)return;const{bot:j,startupFlow:M,googleTagManagerId:mt,hideChatWindow:wt}=N;if(wt)try{window.top&&window.top!==window.self&&window.top.postMessage({lsMessage:"hide_ls_window"},"*")}catch(U){console.error("Error hiding chat window:",U.message||U)}else{gt(mt),O(j),Q(M);const U=k(M==null?void 0:M.messages,{updateContact:s,botSettings:j.botSettings});_(U);const{design:bt,isLoadedInConsole:yt}=o.current;!bt&&j.botDesign&&p(St(j.botDesign,yt?void 0:Pt)),tt(j,h,s,{autoLaunch:C,startupMessages:k(U,{updateContact:s,botSettings:j.botSettings})}).then(x)}}),Lt().then(dt)},[]);const A=l.useCallback((s,g)=>{var F,N,j,M;const{design:h,onCallback:C}=o.current;let{showBot:x}=o.current;x=s?!x:x,C==null||C("windowToggle",{state:x,design:x?{width:(F=h==null?void 0:h.window)==null?void 0:F.width,height:(N=h==null?void 0:h.window)==null?void 0:N.height,spacingBottom:(j=h==null?void 0:h.window)==null?void 0:j.spacingBottom,spacingCorner:(M=h==null?void 0:h.window)==null?void 0:M.spacingCorner}:g})},[]),D=l.useCallback(async s=>{var g;(g=o.current.history)!=null&&g.length||setTimeout(()=>{var C;if((C=o.current.startupMessages)!=null&&C.length){o.current.setAndBroadcastHistory(x=>x.concat(...o.current.startupMessages));return}const h=z();o.current.setAndBroadcastHistory(x=>x?x.concat(h):[h])},s||1700)},[]),X=l.useCallback(()=>{A(!0),v(s=>!s),L(!0),setTimeout(()=>L(!1),1e3),D()},[A,D]);l.useLayoutEffect(()=>{a&&A(!1,!0)},[a,A]);const W=l.useCallback(async(s,g=!1)=>Nt(s,o.current,g),[]);o.current.updateContact=l.useCallback(async s=>{const g=await W(s);o.current.setAndBroadcastHistory(h=>h.filter(C=>!et.includes(C.type)).concat(...Array.isArray(g)?g:[]))},[W]);const ft=l.useCallback(()=>{o.current.setAndBroadcastHistory([]),rt(),delete o.current.history,D(700)},[D]);if(!S||!V)return null;let T="hide-chat";w&&I?T="opening":w&&!I?T="show-chat":!w&&I&&(T="closing"),T+=((Y=a==null?void 0:a.window)==null?void 0:Y.align)==="bottomLeft"?" bottom-left ":" bottom-right ",c&&(T+=" test-console");const pt=E&&et.includes((Z=E[E.length-1])==null?void 0:Z.type);return d.jsxs(d.Fragment,{children:[d.jsx(Wt,{design:a}),d.jsx(Gt,{googleTagManagerId:ut}),d.jsxs("div",{className:"chat-handler "+T,children:[w&&!!S&&d.jsx(jt,{botDesign:a,messages:E,showTime:!0,displayComponents:void 0,onUserMessage:W,disabledMessage:pt,onHistoryChange:o.current.setAndBroadcastHistory,onClear:ft,onHide:X,onCallback:o.current.onCallback,optionsRenderer:b,language:J,setLanguage:ht,fullscreen:y,activateVoiceBot:((q=a==null?void 0:a.composer)==null?void 0:q.activateVoiceBot)??!1}),!w&&!I&&d.jsx(_t,{design:a,onToggle:X})]})]})}const at="lp-vid";function Xt(t,n){if(t==="set-visitor-id"){const{recipientId:r}=n||{};r&&Rt(r)}}function Yt(){try{return localStorage.getItem(at)||void 0}catch(t){console.error("Unable to use browser cache",t)}}function Rt(t){try{localStorage.setItem(at,t)}catch(n){console.error("Unable to use browser cache",n)}}export{Kt as C,Yt as g,Xt as h};
