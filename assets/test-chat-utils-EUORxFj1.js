import{R as l,j as d,r as xt}from"./index-BSPHc8Uh.js";import{K as rt,J as ot,L as H,M as It,N as Ct,Q as St,a as Lt,V as jt,C as Bt}from"./index-DeScPusg.js";import{g as st,p as Mt,R as Tt}from"./ajax-C0fq9NdW.js";import{r as kt}from"./env-CBDBHzQq.js";import{b as R}from"./svg-icons-CsmVt6Ao.js";let B=null;function Et(t){t.origin||(t.origin=null),t.botId||(t.botId=null);try{const{origin:n,botId:r}=t;B=new BroadcastChannel("lp_web_chat");const e=Nt(t);return B.addEventListener("message",e),B.postMessage({action:"GetConversationId",origin:n,botId:r}),()=>{B&&(B.removeEventListener("message",e),B.close(),B=null)}}catch(n){console.error("Unable to start session sharing:",n)}}function Nt({onHistoryChange:t,getHistory:n,origin:r=null,botId:e=null}){return c=>{const i=c.data||{};if(!(i.origin!==r||i.botId!==e))try{if(i.action==="GetConversationId"){const u=n();z(u,r,e)}else if(i.action==="SetConversationId"){const{conversationId:u,history:p}=i;u?rt(u||void 0):ot(),p&&(t==null||t(p))}}catch(u){console.log("Error occurred when trying to handle session sharing:",u)}}}function z(t,n,r,e){if(B)try{const c=H()||"";if(!e&&!c)return;B.postMessage({action:"SetConversationId",origin:n,botId:r,conversationId:c,history:t})}catch(c){console.error("Error sharing session:",c)}}function O(){return{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}}function Ut(t,n,r){var y;const{updateContact:e,onReceiveChatResponse:c,bot:i,locationDetails:u,onCallback:p,recipientId:f,history:w,chatFlowId:b,preferredLanguage:x,url:m}=n,{flowId:v,flowType:a}=((y=w==null?void 0:w[w.length-1])==null?void 0:y.media)||{};return typeof t=="string"&&v&&(t={method:"flow-response",type:a,flowId:v,answer:t}),(t==null?void 0:t.type)==="customForm"&&(t!=null&&t.answer)&&(t={method:"flow-response",type:a,flowId:v,answer:t.answer}),r?Dt(t,i,m,{onReceiveChatResponse:c,updateContact:e,onCallback:p,recipientId:f,chatFlowId:b,language:x},u):At(t,i,m,{onReceiveChatResponse:c,updateContact:e,onCallback:p,recipientId:f,chatFlowId:b,language:x},u)}async function At(t,n,r,{onReceiveChatResponse:e,updateContact:c,onCallback:i,recipientId:u,chatFlowId:p,language:f},w){const b=H(),{_id:x,organizationId:m,botSettings:v}=n,a={url:r,userQuery:t,recipientDetails:{recipientId:u,conversationId:b,language:f,...w},chatFlowId:p};e&&(a.testMode=!0);try{const y=await Mt(`/bot/${m}/${x}/chat`,a,{noAuth:!0});return e==null||e(y),at(y,{updateContact:c,botSettings:v,onCallback:i})}catch(y){return[{role:"assistant",type:"text",content:y.message||"Unknown Server error"}]}}async function Dt(t,n,r,{onReceiveChatResponse:e,updateContact:c,onCallback:i,recipientId:u,chatFlowId:p,language:f},w){const b=H(),{_id:x,organizationId:m,botSettings:v}=n,a={url:r,userQuery:t,recipientDetails:{recipientId:u,conversationId:b,language:f,...w},chatFlowId:p};e&&(a.testMode=!0);try{const C=await(await fetch(`${kt}voicebot/voiceChat?organizationId=${m}&botId=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();return e==null||e(C.data),{data:at(C.data,{updateContact:c,botSettings:v,onCallback:i}),audioUri:C.data.audioUri}}catch(y){return console.log(y,"error"),[{role:"assistant",type:"text",content:y.message||"Unknown Server error"}]}}function at(t,{updateContact:n,botSettings:r,onCallback:e}){const{chatRefId:c,recipientId:i,messages:u}=t;return rt(c),e==null||e("set-visitor-id",{recipientId:i}),E(u,{updateContact:n,botSettings:r})}function E(t,{updateContact:n,botSettings:r}){if(!(t!=null&&t.length))return t;const e=t[t.length-1];return e.type==="form"&&t.push({role:"user",type:"lead",content:"",profile:e.media,updateContact:n,botSettings:r}),e.type==="customForm"&&(e.role==="assistant"&&(e.role="user"),Object.assign(e,{type:"customForm",content:"",media:e.media,updateContact:n,botSettings:r})),t}async function Ft(t){try{const n=await It(),r=new URLSearchParams(window.location.search),e=r.get("token"),c=r.get("sourceUrl");let i=document.referrer;if(c&&i)try{const v=new URL(c).hostname,a=new URL(i).hostname;v===a&&(i="")}catch(v){console.error("Invalid URL in sourceUrl or referer:",v)}const u=(n==null?void 0:n.country_name)||"NA",p=(n==null?void 0:n.city)||"NA",f={authToken:e,recipientId:t,sourceUrl:c,referer:i,country:u,city:p},{startupFlow:w,hideChatWindow:b,googleTagManagerId:x,...m}=await st("/bot/get-bot-details-by-auth-token",f,{noAuth:!0});return{startupFlow:w,hideChatWindow:b,googleTagManagerId:x,bot:m}}catch(n){console.log("Failed to init chat:-",n)}}async function et(t,n,r,{autoLaunch:e,startupMessages:c}){const{_id:i,organizationId:u,botSettings:p={}}=t,f=H();if(!n||!f)return e?c||[O()]:[];try{const w=await st(`/bot/${u}/${i}/chat/history/${n}/${f}`,null,{noAuth:!0}),{messages:b}=w||{};return E(b,{updateContact:r,botSettings:p})}catch(w){console.error("Failed to fetch chat history:-",w)}return e?[O()]:[]}function $t({text:t="We are Online!",onHide:n,design:r,isLeft:e}){const c=Ht(r,e),[i,u]=l.useState(!0),p=l.useCallback(f=>{f.preventDefault(),f.stopPropagation(),u(!1),n==null||n()},[n]);return i?d.jsxs("div",{className:"button-tooltip",style:c,children:[d.jsxs("div",{children:[d.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"}),d.jsx("b",{children:t}),d.jsx("br",{})]}),d.jsx("a",{className:"close-indicator",onClick:p,children:d.jsx("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:d.jsx("path",{d:"M1490 1245q0 40-24 68l-136 136q-24 24-68 24t-68-28l-294-294-294 294q-24 24-68 24t-68-28l-136-136q-24-24-24-68t24-68l294-294-294-294q-24-24-24-68t24-68l136-136q24-24 68-24t68 28l294 294 294-294q24-24 68-28t68 28l136 136q28 24 24 68t-24 68l-294 294 294 294q24 24 24 68z",fill:"#fff"})})})]}):null}function Ht(t,n){let{spacingCorner:r,spacingBottom:e}=(t==null?void 0:t.launcher)||{};if(r=parseFloat(r)||void 0,e=parseFloat(e)||void 0,r&&(r+=5),e&&(e+=75),r||e)return{bottom:e,[n?"left":"right"]:r}}function _t({isLeft:t,bgColor:n,secBgColor:r,imageUrl:e,chatIcon:c,barText:i="Live Chat",fontSize:u,color:p,autoAnimate:f=!0,style:w,onClick:b}){const x=t?"bottom-left":"bottom-right",m={backgroundColor:n},v={backgroundImage:`linear-gradient(90deg, ${n}, ${r})`},a=l.useRef(null);return l.useEffect(()=>{if(f){const y=setInterval(()=>{var C;(C=a.current)==null||C.classList.remove("bar-hide"),setTimeout(()=>{var L;return(L=a.current)==null?void 0:L.classList.add("bar-hide")},7e3)},35e3);return()=>clearInterval(y)}},[f]),d.jsxs("div",{className:`lp-launcher expand-button ${x}`,onClick:b,style:w,children:[d.jsx("div",{ref:a,className:"text-container bar-hide",style:v,children:d.jsx("div",{className:"bar-text",style:{minWidth:"150px",fontSize:u,color:p},children:d.jsxs("p",{children:["Hi there,"," ",d.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"})," ","We are online!"]})})}),d.jsx("div",{className:"image-container",style:m,children:d.jsxs("div",{className:"image-sub-container",children:[e&&d.jsx("img",{src:e,alt:i}),!e&&c]})})]})}function Gt({design:t,onToggle:n}){const{launcher:{launcherType:r,buttonLogoUrl:e,buttonOnMobile:c,barText:i,fontSize:u,spacingCorner:p,spacingBottom:f,showMinimizeButtonToolTip:w=!0}={},header:{bgColor:b,secBgColor:x,fontColor:m}={},window:{fontFamily:v,align:a}={}}=t||{},y=a==="bottomLeft",C={bottom:f,[y?"left":"right"]:p};if(r==="icon"||c){const L=e&&e.endsWith(".svg");return d.jsxs("div",{id:"lp-launcher",className:"lp-launcher button "+(!e||L?" bordered":""),onClick:n,style:{borderColor:b,color:m,background:!e||L?"linear-gradient(to right,"+b+", "+x+")":"transparent",verticalAlign:"middle",padding:!e||L?"16px":void 0,display:"flex",...C},children:[w&&d.jsx($t,{design:t,isLeft:y}),e&&d.jsx("img",{src:e,alt:"Live Chat"}),!e&&R]})}else return r==="expand"?d.jsx(_t,{isLeft:y,color:m,style:C,bgColor:b,secBgColor:x,imageUrl:e,chatIcon:R,barText:i,fontSize:u,onClick:n}):d.jsxs("div",{id:"lp-launcher",className:"lp-launcher bar",onClick:n,style:{background:"linear-gradient(to right, "+b+", "+x+")",color:m,fontFamily:v,...C},children:[e&&d.jsx("img",{src:e,alt:i}),!e&&R,d.jsx("span",{children:i||"Live Chat"})]})}function Wt({googleTagManagerId:t}){return xt.useEffect(()=>{if(!t||document.querySelector(`script[data-gtm="${t}"]`))return;if(window.dataLayer&&document.querySelector('script[src*="gtm.js"]')){console.log("GTM already loaded by server");return}const n=document.createElement("script");n.innerHTML=`
            (function(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
                var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','${t}');
        `,document.head.appendChild(n);const r=document.createElement("noscript");return r.innerHTML=`
          <iframe src="https://www.googletagmanager.com/ns.html?id=${t}"
            height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe>
        `,document.body.insertBefore(r,document.body.firstChild),()=>{document.head.removeChild(n),document.body.removeChild(r)}},[t]),null}function Pt({design:t}){const n=t==null?void 0:t.remoteFontLink;return n?Tt.createPortal(d.jsx("link",{rel:"stylesheet",href:n}),document.head,"remoteFont"):null}const Rt={window:{spacingCorner:"0px",spacingBottom:"7px"},launcher:{spacingCorner:"0px",spacingBottom:"7px"}},nt=["lead","options","customForm","stop"];function Xt(t){var Z,q,tt;const{botDetails:n,botDesign:r,startupFlow:e,onReceiveChatResponse:c,autoLaunch:i,recipientId:u,origin:p,onCallback:f,optionsRenderer:w,fullscreen:b,sourceUrl:x}=t,[m,v]=l.useState(i||!1),[a,y]=l.useState(r),[C,L]=l.useState(!1),[T,Q]=l.useState(n),[_,V]=l.useState(e),[ct,G]=l.useState(e==null?void 0:e.messages),[lt,dt]=l.useState(u),[N,W]=l.useState([]),[J,ut]=l.useState(),[K,X]=l.useState(),[gt,ht]=l.useState(null),o=l.useRef({autoLaunch:i});if(b)try{const s=window.innerWidth+"px",g=window.innerHeight+"px";a.window.width=s,a.window.height=g,a.window.spacingBottom="0px",a.window.spacingCorner="0px",a.launcher.spacingBottom="0px",a.launcher.spacingCorner="0px"}catch(s){console.error("Error setting fullscreen design:",s)}o.current.recipientId=lt,o.current.bot=T,o.current.chatFlowId=_==null?void 0:_.flowId,o.current.startupMessages=ct,o.current.origin=p,o.current.preferredLanguage=K,o.current.url=x;const ft=l.useCallback(s=>{Ct(s),X(s)},[]);o.current.setAndBroadcastHistory=l.useCallback(s=>{var g;typeof s=="function"?W(h=>{var I;const S=s(h);return z(S,o.current.origin,(I=o.current.bot)==null?void 0:I._id,!0),S}):(W(s),z(s,o.current.origin,(g=o.current.bot)==null?void 0:g._id,!0))},[]),o.current.onCallback=l.useCallback((s,g)=>{s==="set-visitor-id"&&g.recipientId&&dt(g.recipientId),f==null||f(s,g)},[f]),o.current.history=N,o.current.showBot=m,o.current.design=a,o.current.locationDetails=J,o.current.onReceiveChatResponse=c,o.current.isLoadedInConsole=!!c,l.useEffect(()=>{Q(n)},[n]),l.useEffect(()=>{var h;const{updateContact:s,bot:g}=o.current;V(e),(h=e==null?void 0:e.messages)!=null&&h.length?G(E([...e.messages],{updateContact:s,botSettings:g.botSettings})):G(!1)},[e]),l.useEffect(()=>{if(T&&!o.current.isLoadedInConsole)return Et({botId:T._id,origin:o.current.origin,onHistoryChange:s=>{var g;!(s!=null&&s.length)&&!((g=o.current.history)!=null&&g.length)||W(s)},getHistory:()=>o.current.history})},[T]),l.useEffect(()=>{y(r)},[r]),l.useEffect(()=>{X(St());const{updateContact:s,bot:g,recipientId:h,autoLaunch:S,setAndBroadcastHistory:I,startupMessages:$}=o.current;g?et(g,h,s,{autoLaunch:S,startupMessages:E($,{updateContact:s,botSettings:g.botSettings})}).then(I):Ft(h).then(U=>{if(!U)return;const{bot:j,startupFlow:M,googleTagManagerId:wt,hideChatWindow:bt}=U;if(bt)try{window.top&&window.top!==window.self&&window.top.postMessage({lsMessage:"hide_ls_window"},"*")}catch(A){console.error("Error hiding chat window:",A.message||A)}else{ht(wt),Q(j),V(M);const A=E(M==null?void 0:M.messages,{updateContact:s,botSettings:j.botSettings});G(A);const{design:yt,isLoadedInConsole:vt}=o.current;!yt&&j.botDesign&&y(Lt(j.botDesign,vt?void 0:Rt)),et(j,h,s,{autoLaunch:S,startupMessages:E(A,{updateContact:s,botSettings:j.botSettings})}).then(I)}}),jt().then(ut)},[]);const D=l.useCallback((s,g)=>{var $,U,j,M;const{design:h,onCallback:S}=o.current;let{showBot:I}=o.current;I=s?!I:I,S==null||S("windowToggle",{state:I,design:I?{width:($=h==null?void 0:h.window)==null?void 0:$.width,height:(U=h==null?void 0:h.window)==null?void 0:U.height,spacingBottom:(j=h==null?void 0:h.window)==null?void 0:j.spacingBottom,spacingCorner:(M=h==null?void 0:h.window)==null?void 0:M.spacingCorner}:g})},[]),F=l.useCallback(async s=>{var g;(g=o.current.history)!=null&&g.length||setTimeout(()=>{var S;if((S=o.current.startupMessages)!=null&&S.length){o.current.setAndBroadcastHistory(I=>I.concat(...o.current.startupMessages));return}const h=O();o.current.setAndBroadcastHistory(I=>I?I.concat(h):[h])},s||1700)},[]),Y=l.useCallback(()=>{D(!0),v(s=>!s),L(!0),setTimeout(()=>L(!1),1e3),F()},[D,F]);l.useLayoutEffect(()=>{a&&D(!1,!0)},[a,D]);const P=l.useCallback(async(s,g=!1)=>Ut(s,o.current,g),[]);o.current.updateContact=l.useCallback(async s=>{const g=await P(s);o.current.setAndBroadcastHistory(h=>h.filter(S=>!nt.includes(S.type)).concat(...Array.isArray(g)?g:[]))},[P]);const pt=l.useCallback(()=>{o.current.setAndBroadcastHistory([]),ot(),delete o.current.history,F(700)},[F]);if(!T||!J)return null;let k="hide-chat";m&&C?k="opening":m&&!C?k="show-chat":!m&&C&&(k="closing"),k+=((Z=a==null?void 0:a.window)==null?void 0:Z.align)==="bottomLeft"?" bottom-left ":" bottom-right ",c&&(k+=" test-console");const mt=N&&nt.includes((q=N[N.length-1])==null?void 0:q.type);return d.jsxs(d.Fragment,{children:[d.jsx(Pt,{design:a}),d.jsx(Wt,{googleTagManagerId:gt}),d.jsxs("div",{className:"chat-handler "+k,children:[m&&!!T&&d.jsx(Bt,{botDesign:a,messages:N,showTime:!0,displayComponents:void 0,onUserMessage:P,disabledMessage:mt,onHistoryChange:o.current.setAndBroadcastHistory,onClear:pt,onHide:Y,onCallback:o.current.onCallback,optionsRenderer:w,language:K,setLanguage:ft,fullscreen:b,activateVoiceBot:((tt=a==null?void 0:a.composer)==null?void 0:tt.activateVoiceBot)??!1}),!m&&!C&&d.jsx(Gt,{design:a,onToggle:Y})]})]})}const it="lp-vid";function Yt(t,n){if(t==="set-visitor-id"){const{recipientId:r}=n||{};r&&zt(r)}}function Zt(){try{return localStorage.getItem(it)||void 0}catch(t){console.error("Unable to use browser cache",t)}}function zt(t){try{localStorage.setItem(it,t)}catch(n){console.error("Unable to use browser cache",n)}}export{Xt as C,Zt as g,Yt as h};
