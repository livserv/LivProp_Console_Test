import{R as i,j as c,r as xt}from"./index-BQ_c26gs.js";import{K as nt,J as rt,L as H,M as vt,N as Ct,a as It,Q as St,C as jt}from"./index-BPfKQBNU.js";import{g as ot,p as Lt,R as Bt}from"./ajax-DTWQusQr.js";import{r as Mt}from"./env-CBDBHzQq.js";import{b as P}from"./svg-icons-5nVAWZGO.js";let B=null;function Tt(t){t.origin||(t.origin=null),t.botId||(t.botId=null);try{const{origin:n,botId:r}=t;B=new BroadcastChannel("lp_web_chat");const e=kt(t);return B.addEventListener("message",e),B.postMessage({action:"GetConversationId",origin:n,botId:r}),()=>{B&&(B.removeEventListener("message",e),B.close(),B=null)}}catch(n){console.error("Unable to start session sharing:",n)}}function kt({onHistoryChange:t,getHistory:n,origin:r=null,botId:e=null}){return l=>{const d=l.data||{};if(!(d.origin!==r||d.botId!==e))try{if(d.action==="GetConversationId"){const u=n();z(u,r,e)}else if(d.action==="SetConversationId"){const{conversationId:u,history:p}=d;u?nt(u||void 0):rt(),p&&(t==null||t(p))}}catch(u){console.log("Error occurred when trying to handle session sharing:",u)}}}function z(t,n,r,e){if(B)try{const l=H()||"";if(!e&&!l)return;B.postMessage({action:"SetConversationId",origin:n,botId:r,conversationId:l,history:t})}catch(l){console.error("Error sharing session:",l)}}function O(){return{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}}function Et(t,n,r){var m;const{updateContact:e,onReceiveChatResponse:l,bot:d,locationDetails:u,onCallback:p,recipientId:f,history:b,chatFlowId:y,preferredLanguage:w}=n,{flowId:v,flowType:a}=((m=b==null?void 0:b[b.length-1])==null?void 0:m.media)||{};return typeof t=="string"&&v&&(t={method:"flow-response",type:a,flowId:v,answer:t}),(t==null?void 0:t.type)==="customForm"&&(t!=null&&t.answer)&&(t={method:"flow-response",type:a,flowId:v,answer:t.answer}),r?Nt(t,d,{onReceiveChatResponse:l,updateContact:e,onCallback:p,recipientId:f,chatFlowId:y,language:w},u):Dt(t,d,{onReceiveChatResponse:l,updateContact:e,onCallback:p,recipientId:f,chatFlowId:y,language:w},u)}async function Dt(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:l,recipientId:d,chatFlowId:u,language:p},f){const b=H(),{_id:y,organizationId:w,botSettings:v}=n,a={userQuery:t,recipientDetails:{recipientId:d,conversationId:b,language:p,...f},chatFlowId:u};r&&(a.testMode=!0);try{const m=await Lt(`/bot/${w}/${y}/chat`,a,{noAuth:!0});return r==null||r(m),st(m,{updateContact:e,botSettings:v,onCallback:l})}catch(m){return[{role:"assistant",type:"text",content:m.message||"Unknown Server error"}]}}async function Nt(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:l,recipientId:d,chatFlowId:u,language:p},f){const b=H(),{_id:y,organizationId:w,botSettings:v}=n,a={userQuery:t,recipientDetails:{recipientId:d,conversationId:b,language:p,...f},chatFlowId:u};r&&(a.testMode=!0);try{const C=await(await fetch(`${Mt}voicebot/voiceChat?organizationId=${w}&botId=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();return r==null||r(C.data),{data:st(C.data,{updateContact:e,botSettings:v,onCallback:l}),audioUri:C.data.audioUri}}catch(m){return console.log(m,"error"),[{role:"assistant",type:"text",content:m.message||"Unknown Server error"}]}}function st(t,{updateContact:n,botSettings:r,onCallback:e}){const{chatRefId:l,recipientId:d,messages:u}=t;return nt(l),e==null||e("set-visitor-id",{recipientId:d}),k(u,{updateContact:n,botSettings:r})}function k(t,{updateContact:n,botSettings:r}){if(!(t!=null&&t.length))return t;const e=t[t.length-1];return e.type==="form"&&t.push({role:"user",type:"lead",content:"",profile:e.media,updateContact:n,botSettings:r}),e.type==="customForm"&&(e.role==="assistant"&&(e.role="user"),Object.assign(e,{type:"customForm",content:"",media:e.media,updateContact:n,botSettings:r})),t}async function Ft(t){try{const n=new URLSearchParams(window.location.search),r=n.get("token"),e=n.get("sourceUrl"),l={authToken:r,recipientId:t,sourceUrl:e},{startupFlow:d,hideChatWindow:u,googleTagManagerId:p,...f}=await ot("/bot/get-bot-details-by-auth-token",l,{noAuth:!0});return{startupFlow:d,hideChatWindow:u,googleTagManagerId:p,bot:f}}catch(n){console.log("Failed to init chat:-",n)}}async function tt(t,n,r,{autoLaunch:e,startupMessages:l}){const{_id:d,organizationId:u,botSettings:p={}}=t,f=H();if(!n||!f)return e?l||[O()]:[];try{const b=await ot(`/bot/${u}/${d}/chat/history/${n}/${f}`,null,{noAuth:!0}),{messages:y}=b||{};return k(y,{updateContact:r,botSettings:p})}catch(b){console.error("Failed to fetch chat history:-",b)}return e?[O()]:[]}function $t({text:t="We are Online!",onHide:n,design:r,isLeft:e}){const l=At(r,e),[d,u]=i.useState(!0),p=i.useCallback(f=>{f.preventDefault(),f.stopPropagation(),u(!1),n==null||n()},[n]);return d?c.jsxs("div",{className:"button-tooltip",style:l,children:[c.jsxs("div",{children:[c.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"}),c.jsx("b",{children:t}),c.jsx("br",{})]}),c.jsx("a",{className:"close-indicator",onClick:p,children:c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:c.jsx("path",{d:"M1490 1245q0 40-24 68l-136 136q-24 24-68 24t-68-28l-294-294-294 294q-24 24-68 24t-68-28l-136-136q-24-24-24-68t24-68l294-294-294-294q-24-24-24-68t24-68l136-136q24-24 68-24t68 28l294 294 294-294q24-24 68-28t68 28l136 136q28 24 24 68t-24 68l-294 294 294 294q24 24 24 68z",fill:"#fff"})})})]}):null}function At(t,n){let{spacingCorner:r,spacingBottom:e}=(t==null?void 0:t.launcher)||{};if(r=parseFloat(r)||void 0,e=parseFloat(e)||void 0,r&&(r+=5),e&&(e+=75),r||e)return{bottom:e,[n?"left":"right"]:r}}function Ht({isLeft:t,bgColor:n,secBgColor:r,imageUrl:e,chatIcon:l,barText:d="Live Chat",fontSize:u,color:p,autoAnimate:f=!0,style:b,onClick:y}){const w=t?"bottom-left":"bottom-right",v={backgroundColor:n},a={backgroundImage:`linear-gradient(90deg, ${n}, ${r})`},m=i.useRef(null);return i.useEffect(()=>{if(f){const C=setInterval(()=>{var S;(S=m.current)==null||S.classList.remove("bar-hide"),setTimeout(()=>{var j;return(j=m.current)==null?void 0:j.classList.add("bar-hide")},7e3)},35e3);return()=>clearInterval(C)}},[f]),c.jsxs("div",{className:`lp-launcher expand-button ${w}`,onClick:y,style:b,children:[c.jsx("div",{ref:m,className:"text-container bar-hide",style:a,children:c.jsx("div",{className:"bar-text",style:{minWidth:"150px",fontSize:u,color:p},children:c.jsxs("p",{children:["Hi there,"," ",c.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"})," ","We are online!"]})})}),c.jsx("div",{className:"image-container",style:v,children:c.jsxs("div",{className:"image-sub-container",children:[e&&c.jsx("img",{src:e,alt:d}),!e&&l]})})]})}function Ut({design:t,onToggle:n}){const{launcher:{launcherType:r,buttonLogoUrl:e,buttonOnMobile:l,barText:d,fontSize:u,spacingCorner:p,spacingBottom:f,showMinimizeButtonToolTip:b=!0}={},header:{bgColor:y,secBgColor:w,fontColor:v}={},window:{fontFamily:a,align:m}={}}=t||{},C=m==="bottomLeft",S={bottom:f,[C?"left":"right"]:p};return r==="icon"||l?c.jsxs("div",{id:"lp-launcher",className:"lp-launcher button"+(e?"":" bordered"),onClick:n,style:{borderColor:y,color:v,background:e?"transparent":"linear-gradient(to right,"+y+", "+w+")",verticalAlign:"middle",padding:e?void 0:"16px",display:"flex",...S},children:[b&&c.jsx($t,{design:t,isLeft:C}),e&&c.jsx("img",{src:e,alt:"Live Chat"}),!e&&P]}):r==="expand"?c.jsx(Ht,{isLeft:C,color:v,style:S,bgColor:y,secBgColor:w,imageUrl:e,chatIcon:P,barText:d,fontSize:u,onClick:n}):c.jsxs("div",{id:"lp-launcher",className:"lp-launcher bar",onClick:n,style:{background:"linear-gradient(to right, "+y+", "+w+")",color:v,fontFamily:a,...S},children:[e&&c.jsx("img",{src:e,alt:d}),!e&&P,c.jsx("span",{children:d||"Live Chat"})]})}function _t({googleTagManagerId:t}){return xt.useEffect(()=>{if(!t||document.querySelector(`script[data-gtm="${t}"]`))return;if(window.dataLayer&&document.querySelector('script[src*="gtm.js"]')){console.log("GTM already loaded by server");return}const n=document.createElement("script");n.innerHTML=`
            (function(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
                var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','${t}');
        `,document.head.appendChild(n);const r=document.createElement("noscript");return r.innerHTML=`
          <iframe src="https://www.googletagmanager.com/ns.html?id=${t}"
            height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe>
        `,document.body.insertBefore(r,document.body.firstChild),()=>{document.head.removeChild(n),document.body.removeChild(r)}},[t]),null}function Gt({design:t}){const n=t==null?void 0:t.remoteFontLink;return n?Bt.createPortal(c.jsx("link",{rel:"stylesheet",href:n}),document.head,"remoteFont"):null}const Wt={window:{spacingCorner:"0px",spacingBottom:"7px"},launcher:{spacingCorner:"0px",spacingBottom:"7px"}},et=["lead","options","customForm","stop"];function Jt(t){var Y,Z,q;const{botDetails:n,botDesign:r,startupFlow:e,onReceiveChatResponse:l,autoLaunch:d,recipientId:u,origin:p,onCallback:f,optionsRenderer:b,fullscreen:y}=t,[w,v]=i.useState(d||!1),[a,m]=i.useState(r),[C,S]=i.useState(!1),[j,Q]=i.useState(n),[U,R]=i.useState(e),[it,_]=i.useState(e==null?void 0:e.messages),[ct,lt]=i.useState(u),[E,G]=i.useState([]),[V,dt]=i.useState(),[J,K]=i.useState(),[ut,gt]=i.useState(null),o=i.useRef({autoLaunch:d});if(y)try{const s=window.innerWidth+"px",g=window.innerHeight+"px";a.window.width=s,a.window.height=g,a.window.spacingBottom="0px",a.window.spacingCorner="0px",a.launcher.spacingBottom="0px",a.launcher.spacingCorner="0px"}catch(s){console.error("Error setting fullscreen design:",s)}o.current.recipientId=ct,o.current.bot=j,o.current.chatFlowId=U==null?void 0:U.flowId,o.current.startupMessages=it,o.current.origin=p,o.current.preferredLanguage=J;const ht=i.useCallback(s=>{vt(s),K(s)},[]);o.current.setAndBroadcastHistory=i.useCallback(s=>{var g;typeof s=="function"?G(h=>{var x;const I=s(h);return z(I,o.current.origin,(x=o.current.bot)==null?void 0:x._id,!0),I}):(G(s),z(s,o.current.origin,(g=o.current.bot)==null?void 0:g._id,!0))},[]),o.current.onCallback=i.useCallback((s,g)=>{s==="set-visitor-id"&&g.recipientId&&lt(g.recipientId),f==null||f(s,g)},[f]),o.current.history=E,o.current.showBot=w,o.current.design=a,o.current.locationDetails=V,o.current.onReceiveChatResponse=l,o.current.isLoadedInConsole=!!l,i.useEffect(()=>{Q(n)},[n]),i.useEffect(()=>{var h;const{updateContact:s,bot:g}=o.current;R(e),(h=e==null?void 0:e.messages)!=null&&h.length?_(k([...e.messages],{updateContact:s,botSettings:g.botSettings})):_(!1)},[e]),i.useEffect(()=>{if(j&&!o.current.isLoadedInConsole)return Tt({botId:j._id,origin:o.current.origin,onHistoryChange:s=>{var g;!(s!=null&&s.length)&&!((g=o.current.history)!=null&&g.length)||G(s)},getHistory:()=>o.current.history})},[j]),i.useEffect(()=>{m(r)},[r]),i.useEffect(()=>{K(Ct());const{updateContact:s,bot:g,recipientId:h,autoLaunch:I,setAndBroadcastHistory:x,startupMessages:A}=o.current;g?tt(g,h,s,{autoLaunch:I,startupMessages:k(A,{updateContact:s,botSettings:g.botSettings})}).then(x):Ft(h).then(D=>{if(!D)return;const{bot:L,startupFlow:M,googleTagManagerId:mt,hideChatWindow:wt}=D;if(wt)try{window.top&&window.top!==window.self&&window.top.postMessage({lsMessage:"hide_ls_window"},"*")}catch(N){console.error("Error hiding chat window:",N.message||N)}else{gt(mt),Q(L),R(M);const N=k(M==null?void 0:M.messages,{updateContact:s,botSettings:L.botSettings});_(N);const{design:bt,isLoadedInConsole:yt}=o.current;!bt&&L.botDesign&&m(It(L.botDesign,yt?void 0:Wt)),tt(L,h,s,{autoLaunch:I,startupMessages:k(N,{updateContact:s,botSettings:L.botSettings})}).then(x)}}),St().then(dt)},[]);const F=i.useCallback((s,g)=>{var A,D,L,M;const{design:h,onCallback:I}=o.current;let{showBot:x}=o.current;x=s?!x:x,I==null||I("windowToggle",{state:x,design:x?{width:(A=h==null?void 0:h.window)==null?void 0:A.width,height:(D=h==null?void 0:h.window)==null?void 0:D.height,spacingBottom:(L=h==null?void 0:h.window)==null?void 0:L.spacingBottom,spacingCorner:(M=h==null?void 0:h.window)==null?void 0:M.spacingCorner}:g})},[]),$=i.useCallback(async s=>{var g;(g=o.current.history)!=null&&g.length||setTimeout(()=>{var I;if((I=o.current.startupMessages)!=null&&I.length){o.current.setAndBroadcastHistory(x=>x.concat(...o.current.startupMessages));return}const h=O();o.current.setAndBroadcastHistory(x=>x?x.concat(h):[h])},s||1700)},[]),X=i.useCallback(()=>{F(!0),v(s=>!s),S(!0),setTimeout(()=>S(!1),1e3),$()},[F,$]);i.useLayoutEffect(()=>{a&&F(!1,!0)},[a,F]);const W=i.useCallback(async(s,g=!1)=>Et(s,o.current,g),[]);o.current.updateContact=i.useCallback(async s=>{const g=await W(s);o.current.setAndBroadcastHistory(h=>h.filter(I=>!et.includes(I.type)).concat(...Array.isArray(g)?g:[]))},[W]);const ft=i.useCallback(()=>{o.current.setAndBroadcastHistory([]),rt(),delete o.current.history,$(700)},[$]);if(!j||!V)return null;let T="hide-chat";w&&C?T="opening":w&&!C?T="show-chat":!w&&C&&(T="closing"),T+=((Y=a==null?void 0:a.window)==null?void 0:Y.align)==="bottomLeft"?" bottom-left ":" bottom-right ",l&&(T+=" test-console");const pt=E&&et.includes((Z=E[E.length-1])==null?void 0:Z.type);return c.jsxs(c.Fragment,{children:[c.jsx(Gt,{design:a}),c.jsx(_t,{googleTagManagerId:ut}),c.jsxs("div",{className:"chat-handler "+T,children:[w&&!!j&&c.jsx(jt,{botDesign:a,messages:E,showTime:!0,displayComponents:void 0,onUserMessage:W,disabledMessage:pt,onHistoryChange:o.current.setAndBroadcastHistory,onClear:ft,onHide:X,onCallback:o.current.onCallback,optionsRenderer:b,language:J,setLanguage:ht,fullscreen:y,activateVoiceBot:((q=a==null?void 0:a.composer)==null?void 0:q.activateVoiceBot)??!1}),!w&&!C&&c.jsx(Ut,{design:a,onToggle:X})]})]})}const at="lp-vid";function Kt(t,n){if(t==="set-visitor-id"){const{recipientId:r}=n||{};r&&Pt(r)}}function Xt(){try{return localStorage.getItem(at)||void 0}catch(t){console.error("Unable to use browser cache",t)}}function Pt(t){try{localStorage.setItem(at,t)}catch(n){console.error("Unable to use browser cache",n)}}export{Jt as C,Xt as g,Kt as h};
