import{j as e,h as b,r as B,c as U,u as K,R as M}from"./AlertSnackbar-lBoJjy_c.js";import{F as I,a as V}from"./formik.esm-CUDIF_J_.js";import{c as g,a as C,d as W,e as T,f as Z,g as J}from"./index.esm-f3KrK5uW.js";import{B as f}from"./Button-BUErKIkp.js";import"./index-DDVnIUkz.js";import"./Button-BfGblH0o.js";import{T as N}from"./TextBox-Byl1ojPW.js";import{a as Q,b as $,d as X,g as Y}from"./integrations-DD29vTUc.js";import{C as S,l as P}from"./index-BzubCbFt.js";import{w as H}from"./env-DWkyVZs8.js";import{P as O}from"./ProgressButton-CoLcqq_z.js";import{g as ee}from"./common-PFIJTlAS.js";import{w as R}from"./env-CmL5wTXD.js";import{l as ae}from"./ajax-C92vMgMI.js";import{s as y,h as se}from"./utils-BPLOM7gE.js";import{C as w}from"./ConfirmDialog-CUxvc3Gr.js";import{u as le}from"./organization-BeqV9dKf.js";import{S as te}from"./cancel-Czd1xiMc.js";import{S as oe}from"./link-Ul-d4Acz.js";import{S as ie}from"./plus-u7WazedS.js";import{S as de}from"./SpeedDial-T6_-cQAN.js";import{S as L}from"./whatsapp-Cwj35Qnn.js";import{u as ne}from"./useSelectedBot-CI1XJECK.js";import{P as re}from"./PageHeader-mjWFswKG.js";import"./LabelWrapper-DJDIkEgu.js";import"./SelectBox-CsK0tKl_.js";function F({botId:s,organizationId:l,setPopUpDialog:r,crmIntegrationObj:d,edit:c}){const x=async(t,{setErrors:a,setStatus:n,setSubmitting:i})=>{try{const p={_id:d?._id,botId:s,organizationId:l,callbackURL:t.crmCallBackUrl,channelId:"CRM_Callback_123",channelName:"CRM_Callback"};await Q(p),n({success:!0}),i(!0),r(),b(!0,"The CRM callback url added successfully!","success")}catch(p){n({success:!1}),a({submit:p.message}),i(!1),b(!0,"Not able to CRM callback url. Try after sometime!","error")}};return e.jsx("div",{className:"w-full",children:e.jsx(I,{initialValues:{crmCallBackUrl:d?d.callbackURL:"",submit:""},validationSchema:g().shape({crmCallBackUrl:C().url("Enter valid url!").required("CRM Callback URL is required"),submit:C()}),onSubmit:x,children:({errors:t,handleBlur:a,handleChange:n,handleSubmit:i,isSubmitting:p,touched:m,values:o})=>e.jsxs("form",{noValidate:!0,onSubmit:i,children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{label:"CRM callback URL",id:"crmCallBackUrl",type:"url",name:"crmCallBackUrl",value:o.crmCallBackUrl,onBlur:a,onChange:n,autoComplete:"off",className:m.crmCallBackUrl&&t.crmCallBackUrl?"border-red-500":""}),m.crmCallBackUrl&&t.crmCallBackUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:String(t.crmCallBackUrl)})]}),t.submit&&typeof t.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mb-2",children:t.submit}),e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{disabled:p,isLoading:p,htmlType:"submit",type:"primary",size:"lg",label:c?p?"Updating...":"Update":p?"Adding...":"Add"})})]})})})}function z({botId:s,organizationId:l,setPopUpDialog:r,gupshupIntegrationObj:d,edit:c}){const x=async(a,{setErrors:n,setStatus:i,setSubmitting:p})=>{try{let m=a;const o=d?._id;d&&(m={...a,objId:o}),await $(m),i({success:!0}),p(!0),r(!1),b(!0,"The Gupshup integration added successfully!","success")}catch(m){i({success:!1}),n({submit:m.message}),p(!1),b(!0,"Not able to activate Gupshup integration. Try after sometime!","error")}};function t(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(I,{initialValues:{webHookUrl:`${H}/gupshup/${l}/${s}/entrypoint`,appId:d?.appId||"",appName:d?.appName||"",phoneNumberId:d?.phoneNumberId||"",channelId:"gupshup_123",channelName:"gupshup",leadCategory:d?.leadCategory||"preSale",leadUpgradeToPreSaleCount:d?.leadUpgradeToPreSaleCount||"",submit:""},validationSchema:g().shape({appId:C().required("App ID is required"),appName:C().required("App name is required"),phoneNumberId:T().min(10,"Please enter a valid phone number id").required("Phone number is required"),leadUpgradeToPreSaleCount:W().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||typeof a=="number"&&a>0)}),onSubmit:x,children:({errors:a,handleBlur:n,handleChange:i,handleSubmit:p,isSubmitting:m,touched:o,values:u})=>e.jsxs("form",{noValidate:!0,onSubmit:p,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Gupshup Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(S,{text:u.webHookUrl,onCopy:()=>b(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:u.webHookUrl,name:"webHookUrl",onBlur:n,onChange:i,autoComplete:"off",disabled:!0,onKeyDown:t,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),o.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"Gupshup App ID *"}),e.jsx(N,{id:"appId",name:"appId",value:u.appId,onBlur:n,onChange:j=>i(j.target.value),autoComplete:"off",onKeyDown:t,className:o.appId&&a.appId?"border-red-500":""}),o.appId&&a.appId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.appId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"Gupshup App Name *"}),e.jsx(N,{id:"appName",name:"appName",value:u.appName,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.appName&&a.appName?"border-red-500":""}),o.appName&&a.appName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number *"}),e.jsx(N,{id:"phoneNumberId",name:"phoneNumberId",type:"number",value:u.phoneNumberId,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),o.phoneNumberId&&a.phoneNumberId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.phoneNumberId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.phoneNumberId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:u.leadCategory||"preSale",onBlur:n,onChange:i,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),o.leadCategory&&a.leadCategory&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadCategory})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(N,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:u.leadUpgradeToPreSaleCount,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadUpgradeToPreSaleCount=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadUpgradeToPreSaleCount})})]})]}),a.submit&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(f,{disabled:m,isLoading:m,htmlType:"submit",type:"primary",size:"lg",label:c?"Edit":"Add"})})]})})})}function q({botId:s,organizationId:l,setPopUpDialog:r,whatsappIntegrationObj:d,edit:c}){const x=async(a,{setErrors:n,setStatus:i,setSubmitting:p})=>{try{let m=a;const o=d?._id;o&&(m={...a,objId:o}),await $(m),i({success:!0}),p(!0),r(!1),b(!0,"The WhatsApp integration added successfully!","success")}catch(m){i({success:!1}),n({submit:m.message}),p(!1),b(!0,"Not able to activate WhatsApp integration. Try after sometime!","error")}};function t(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(I,{initialValues:{webHookUrl:`${H}/whatsapp/${l}/${s}/entrypoint`,webHookSecret:ee(l,s),appId:d?.appId||"",appName:d?.appName||"",phoneNumberId:d?.phoneNumberId||"",verificationToken:d?.verificationToken||"",channelId:"whatsapp_123",channelName:"whatsapp",leadCategory:d?.leadCategory||"preSale",leadUpgradeToPreSaleCount:d?.leadUpgradeToPreSaleCount||"",submit:""},validationSchema:g().shape({appId:T().required("App ID must be a number"),appName:C().required("App name is required"),phoneNumberId:T().min(10,"Please enter a valid phone number id").required("Phone number is required"),verificationToken:C().required("Access Token  is required"),leadUpgradeToPreSaleCount:W().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||!isNaN(Number(a))&&Number(a)>0)}),onSubmit:x,children:({errors:a,handleBlur:n,handleChange:i,handleSubmit:p,isSubmitting:m,touched:o,values:u})=>e.jsxs("form",{noValidate:!0,onSubmit:p,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Webhook Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(S,{text:u.webHookUrl,onCopy:()=>b(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:u.webHookUrl,name:"webHookUrl",onBlur:n,onChange:i,autoComplete:"off",disabled:!0,onKeyDown:t,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),o.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookSecret",children:"Webhook Verify token *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(S,{text:u.webHookSecret,onCopy:()=>b(!0,"Webhook Verify Token copied to clipboard","success"),children:e.jsx("input",{id:"webHookSecret",type:"text",value:u.webHookSecret,name:"webHookSecret",onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:"w-full border rounded px-3 py-2 bg-gray-100",disabled:!0})})}),o.webHookSecret&&a.webHookSecret&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookSecret})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"App ID *"}),e.jsx(N,{id:"appId",name:"appId",value:u.appId,onBlur:n,onChange:i,onKeyDown:t,className:o.appId&&a.appId?"border-red-500":""}),o.appId&&a.appId&&typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"App Name *"}),e.jsx(N,{id:"appName",name:"appName",value:u.appName,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.appName&&a.appName?"border-red-500":""}),o.appName&&a.appName&&a.appName==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number ID *"}),e.jsx(N,{id:"phoneNumberId",name:"phoneNumberId",type:"text",value:u.phoneNumberId,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),o.phoneNumberId&&a.phoneNumberId&&a.phoneNumberId==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"verificationToken",children:"Access Token *"}),e.jsx(N,{id:"verificationToken",name:"verificationToken",type:"text",value:u.verificationToken,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.verificationToken&&a.verificationToken?"border-red-500":""}),o.verificationToken&&a.verificationToken&&typeof a.verificationToken=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.verificationToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:u.leadCategory||"preSale",onBlur:n,onChange:i,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),o.leadCategory&&a.leadCategory&&typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(N,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:u.leadUpgradeToPreSaleCount,onBlur:n,onChange:i,autoComplete:"off",onKeyDown:t,className:o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadUpgradeToPreSaleCount})]})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(O,{isLoading:m,disabled:m,type:"submit",children:c?"Edit":"Add"})})]})})})}function k({label:s,value:l,copyText:r,onCopy:d}){return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 my-3",children:[e.jsx("b",{className:"sm:min-w-[180px] text-sm sm:text-base",children:s}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap flex-1 font-mono text-xs sm:text-sm",title:l,children:l}),e.jsx(P.CopyToClipboard,{text:r||l,onCopy:d,children:e.jsx(f,{label:"Copy",type:"primary",style:{minWidth:60}})})]})]})}function me({integrationObj:s}){const[l,r]=B.useState(!1),d=async(t,a)=>{try{await X(t),b(!0,`The ${a} deleted successfully!`,"success")}catch{b(!0,`Not able to delete the ${a}. Try after sometime!`,"error")}},c=t=>{const a=new Date(t);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(a)};let x=null;if(s.channelName==="Webchat")x=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-3",children:"Chat window Script Tag"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs sm:text-sm break-all flex-1",children:s.scriptTag}),e.jsx(P.CopyToClipboard,{text:s.scriptTag,onCopy:()=>b(!0,"chat script copied to clipboard","success"),children:e.jsx(f,{label:"Copy",type:"primary",style:{width:"100%",maxWidth:"120px"}})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:c(s.integratedAt)})]})]});else if(s.channelName==="whatsapp"){const t=`${R}/whatsapp/${s.organizationId}/${s.botId}/${s._id}/entrypoint`,a=ae(s.organizationId,s.botId);x=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx("div",{className:"font-bold text-lg",children:"WhatsApp Integration"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{label:"Edit",type:"plain",onClick:()=>{y(e.jsx(q,{botId:s.botId,organizationId:s.organizationId,setPopUpDialog:()=>{},whatsappIntegrationObj:s,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(f,{label:"Delete",type:"plain",onClick:()=>r(!0)}),e.jsx(w,{title:"Delete Whatsapp integration?",open:l,setOpen:r,onConfirm:()=>d(s,"Whatsapp integration"),children:"Confirm the deletion of Whatsapp integration."})]})]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"App Name:"})," ",s.appName]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"App Id:"})," ",s.appId]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"Phone Number ID:"})," ",s.phoneNumberId]}),e.jsx(k,{label:"Webhook Callback Url:",value:t,onCopy:()=>b(!0,"Web hook callback url copied to clipboard","success")}),e.jsx(k,{label:"Webhook Verification Token:",value:a,onCopy:()=>b(!0,"Webhook Verification Token copied to clipboard","success")}),e.jsx(k,{label:"Access Token:",value:s.verificationToken,onCopy:()=>b(!0,"Access Token copied to clipboard","success")}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Initial Lead Category:"})," ",s.leadCategory||"preSales"]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",s.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:c(s.integratedAt)})]})]})}else if(s.channelName==="gupshup"){const t=`${R}/gupshup/${s.organizationId}/${s.botId}/${s._id}/entrypoint`;x=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx("div",{className:"font-bold text-lg",children:"Gupshup Integration"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{label:"Edit",type:"plain",onClick:()=>{y(e.jsx(z,{botId:s.botId,organizationId:s.organizationId,setPopUpDialog:()=>{},gupshupIntegrationObj:s,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(f,{label:"Delete",type:"plain",onClick:()=>r(!0)}),e.jsx(w,{title:"Delete Gupshup integration?",open:l,setOpen:r,onConfirm:()=>d(s,"Gupshup integration"),children:"Confirm the deletion of Gupshup integration."})]})]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"App Name:"})," ",s.appName]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"App Id:"})," ",s.appId]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"Phone Number:"})," ",s.phoneNumberId]}),e.jsx(k,{label:"Webhook Callback Url:",value:t,onCopy:()=>b(!0,"Web hook callback url copied to clipboard","success")}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Initial Lead Category:"})," ",s.leadCategory||"preSales"]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",s.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:c(s.integratedAt)})]})]})}else s.channelName==="CRM_Callback"&&(x=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-3",children:"CRM Callback URL"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-3",children:[e.jsx("span",{className:"font-mono text-xs sm:text-sm break-all flex-1",children:s.callbackURL}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{label:"Edit",type:"plain",onClick:()=>{y(e.jsx(F,{botId:s.botId,organizationId:s.organizationId,setPopUpDialog:se,crmIntegrationObj:s,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(f,{label:"Delete",type:"plain",onClick:()=>r(!0)}),e.jsx(P.CopyToClipboard,{text:s.callbackURL,onCopy:()=>b(!0,"CRM callback URL copied to clipboard","success"),children:e.jsx(f,{label:"Copy",type:"primary"})})]}),e.jsx(w,{title:"Delete CRM callback URL?",open:l,setOpen:r,onConfirm:()=>d(s,"crm callback url"),children:"Confirm the deletion of CRM callback URL."})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:c(s.integratedAt)})]})]}));return e.jsx("div",{className:"bg-white rounded shadow p-4 mb-4",children:x})}function ce({admins:s,index:l,handleBlur:r,handleChange:d,errors:c,touched:x,remove:t}){return e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(N,{label:"Admin Name",id:`admins.${l}.adminName`,name:`admins.${l}.adminName`,type:"text",value:s.adminName,onBlur:r,onChange:d,autoComplete:"off",disabled:l===0,className:l!==0&&x.admins?.[l]?.adminName&&c.admins?.[l]?.adminName?"border-red-500":""}),l!==0&&x.admins?.[l]?.adminName&&c.admins?.[l]?.adminName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].adminName})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx(N,{label:"Role",id:`admins.${l}.role`,name:`admins.${l}.role`,type:"text",value:s.role,onBlur:r,onChange:d,autoComplete:"off",disabled:l===0,className:l!==0&&x.admins?.[l]?.role&&c.admins?.[l]?.role?"border-red-500":""}),l!==0&&x.admins?.[l]?.role&&c.admins?.[l]?.role&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].role})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(N,{label:"Email",id:`admins.${l}.email`,name:`admins.${l}.email`,type:"text",value:s.email,onBlur:r,onChange:d,autoComplete:"off",disabled:l===0,className:l!==0&&x.admins?.[l]?.email&&c.admins?.[l]?.email?"border-red-500":""}),l!==0&&x.admins?.[l]?.email&&c.admins?.[l]?.email&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].email})]}),l!==0&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Delete"}),e.jsx(f,{type:"plain",label:"ðŸ—‘ï¸",className:"text-2xl text-red-600",onClick:()=>t(l)})]})]})})}function pe({organizationId:s}){const r={admins:U(a=>a.organization?.admins)||[],submit:""},d=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),c=g().shape({admins:Z().of(J(a=>a.index===0?g().shape({}):g().shape({adminName:C().required("Admin Name is required"),role:C().required("Role is required"),email:C().trim().required("Email is required").email("Invalid email id").matches(d,"Invalid email id")})))}),x=a=>a.map((n,i)=>({...n,itemNo:i+1})),t=async(a,{setErrors:n,setStatus:i,setSubmitting:p})=>{try{const{submit:m,...o}=a;p(!0),await le(o,s),b(!0,"Lead email ids updated successfully","success"),i({success:!0})}catch(m){i({success:!1}),n({submit:m.message}),p(!1),b(!0,m.message,"error")}};return e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Lead emails are sending to below given email ids"}),e.jsx("br",{}),e.jsx("br",{})]}),e.jsx(I,{initialValues:r,onSubmit:t,validationSchema:c,children:({errors:a,handleBlur:n,handleChange:i,handleSubmit:p,touched:m,values:o,setFieldValue:u,isSubmitting:j})=>e.jsx("form",{onSubmit:p,children:e.jsx(V,{name:"admins",children:({push:h,remove:v})=>e.jsxs(e.Fragment,{children:[o.admins.map((E,D)=>e.jsx(ce,{admins:E,index:D,handleBlur:n,handleChange:i,errors:a,touched:m,remove:A=>{v(A);const G=x(o.admins.filter((xe,_)=>_!==A));u("admins",G)}},D)),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4 mt-4",children:[e.jsx(f,{type:"secondary",className:"ml-2",onClick:()=>{h({adminName:"",role:"",email:""})},label:"Add Email"}),e.jsx(f,{type:"primary",className:"ml-2",disabled:j,isLoading:j,htmlType:"submit",label:"Save Changes"})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})]})})})})]})}function ze(){const[s]=ne(),l=K(h=>h.botsList),r=U(h=>h.organizationId),d=U(h=>h.isSuperUser),[c,x]=B.useState(!1);M.useEffect(()=>{(async()=>{const v={organizationId:r,botId:s};try{await Y(v)}catch{b(!0,"Not able to fetch integrations details. Try after sometime!","error")}})()},[s,r]);const t=l.find(h=>h._id===s)?.integrations;let a=null,n=null,i=null;t!==void 0&&(a=t.find(h=>h.channelName==="CRM_Callback"),n=t.find(h=>h.channelName==="whatsapp"),i=t.find(h=>h.channelName==="gupshup"));const p=()=>{y(n?e.jsx("div",{children:"The Whatsapp integration already configured."}):e.jsx(q,{botId:s,organizationId:r,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},m=()=>{y(a?e.jsx("div",{children:"The CRM Callback URL has been successfully configured."}):e.jsx(F,{botId:s,organizationId:r,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},o=()=>{y(i?e.jsx("div",{children:"The Gupshup integration already configured."}):e.jsx(z,{botId:s,organizationId:r,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},u=[{name:"WhatsApp Integration",icon:e.jsx(L,{}),method:p},{name:"CRM Callback",icon:e.jsx(oe,{}),method:m},{name:"Gupshup Integration",icon:e.jsx(L,{}),method:o}],j=d?u:u.filter(h=>h.name!=="Gupshup Integration");return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 relative",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(re,{title:"Integrations",icon:c?te:ie,onClick:()=>x(h=>!h)}),e.jsx(de,{actions:j,isOpen:c,onClose:()=>x(!1)})]})}),e.jsxs("div",{className:"space-y-4",children:[t&&t.map((h,v)=>h.channelId!=="callConnect_123"&&e.jsx(me,{integrationObj:h},v)),d&&e.jsx(pe,{organizationId:r})]})]})}export{ze as default};
