import{b as d,f as N,R as F,h as K,r as x,j as e}from"./index-BUi7dVI-.js";import{c as v}from"./Button-B8BZ1MfC.js";import{S as M}from"./delete-CU4Ib-lD.js";import{S as O}from"./edit-DxIHDvo_.js";import{S as G}from"./plus-YfVPyVyP.js";import{g as C,r as T,p as U,j as V}from"./ajax-trSxn-SP.js";import{B as b}from"./Button-DZ2Bo7Yd.js";import{S as W}from"./TextBox-C36CaT4K.js";import{s as y,h as k}from"./utils-B3TvvZ68.js";import{S as H,a as Q}from"./send-BgFbAndD.js";import{u as S}from"./useSelectedBot-Bo-n9yUo.js";import{P as J}from"./PageHeader-BoAGOlEn.js";import{F as X,b as Y,d as Z}from"./index-CEextgYE.js";async function we(o){const{selectedBotId:i}=N.getState(),{organizationId:s,kbDocs:t}=d.getState(),n=await C(`/bot/${s}/${i}/knowledge-base/list`);d.setState(a=>({kbDocs:{...a.kbDocs||{},[String(i)]:n}}))}async function P(o){const{organizationId:i,selectedBotId:s}=d.getState(),t=await U(`/bot/${i}/${s}/knowledge-base`,o);return d.setState(n=>{const a={...n.kbDocs||{}},c=a[s];if(!c)return{};if(a[s]=[...c],o._id){const r=a[s].findIndex(u=>u._id===t._id);r>=0?a[s][r]=t:a[s].push(t)}else a[s].push(t);return{kbDocs:a}}),t}async function ee(o){const{organizationId:i,selectedBotId:s}=d.getState();await T(`/bot/${i}/${s}/knowledge-base/${o}`,o),d.setState(t=>{var a;const n={...t.kbDocs||{}};return n[s]=(a=n[s])==null?void 0:a.filter(c=>c._id!==o),{kbDocs:n}})}async function Ne(o){if(!(o!=null&&o.length))return[];const{organizationId:i}=d.getState(),{selectedBotId:s}=N.getState();return await C(`/bot/${i}/${s}/knowledge-base/list?${o.map(t=>`docIds=${t}`).join("&")}`)}const f=K(()=>({page:1,rowsPerPage:10,totalDocs:0,docsList:[],isLoading:!1}));function te(){const o=d(n=>n.organizationId),[i]=S();F.useEffect(()=>{se()},[i,o]);const s=f(n=>n.docsList),t=f(n=>n.isLoading);return[s,t]}async function se(o=1,i=10){const{organizationId:s}=d.getState(),{selectedBotId:t}=N.getState();if(!s||!t)return;const{botId:n}=f.getState(),a={page:o,rowsPerPage:i,isLoading:!0};n!==t&&(a.docsList=[]),f.setState(a);const c=await V.get(`/bot/${s}/${t}/knowledge-base/list`);f.setState({botId:t,docsList:c,totalDocs:c.length,isLoading:!1})}function I({onDone:o,initial:i}){const[s,t]=x.useState(i||{question:"",content:""}),n=(c,r)=>{t(u=>({...u,[c]:r}))},a=async()=>{await P(s),o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(X,{value:s,onChange:t,children:[e.jsx(Y,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:c=>n("question",c)}),e.jsx(Z,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:c=>n("content",c)})]}),e.jsx("div",{className:"text-center",children:e.jsx(b,{icon:e.jsx(H,{}),size:"lg",type:"rounded",onClick:a,className:"bg-[#49d4a1]"})})]})}function oe(o){const{activeIndex:i,onNavigate:s=()=>{},docsList:t}=o,[n]=S(),[a,c]=te(),r=t??a,[u,L]=x.useState(10),[h,g]=x.useState(1),[D]=x.useState(""),B=[10,15,20,25],j=(r||[]).filter(l=>{var m;return!D||((m=l.question)==null?void 0:m.toLowerCase().includes(D.toLowerCase()))}),p=Math.ceil(j.length/u),w=(h-1)*u,$=w+u,A=j.slice(w,$),E=()=>k(),_=()=>y(e.jsx(I,{onDone:E}),{showCloseButton:!0,width:"700px"});x.useEffect(()=>{h>p&&g(1)},[j.length,p,h]);const q=l=>{const m=typeof l=="string"?parseInt(l,10):l;typeof m=="number"&&!isNaN(m)&&(L(m),g(1))},R=l=>{l<1||l>p||g(l)},z=async()=>{try{const l=await Q(n,{verificationStatus:!0});console.log("Bot verification response:",l),i&&s(i+1)}catch(l){console.error("Error during bot verification:",l)}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!t&&!i&&e.jsx("div",{className:"mb-4",children:e.jsx(J,{title:"Chat Bot Knowledge",icon:G,search:!0,onClick:_})}),e.jsxs("div",{className:v("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":c}),children:[e.jsx("div",{className:"flex-1",children:A.map((l,m)=>e.jsx(ne,{doc:l,index:w+m},l._id))}),!t&&e.jsx("div",{className:"w-full flex flex-row px-4 py-3 gap-8 border-t border-gray-100 bg-white mt-auto",children:e.jsx(ie,{count:u,counts:B,currentPage:h,totalPages:p,onChangeCount:q,goToPage:R})})]}),i&&!t&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(b,{label:"GENERATE",onClick:z})})]})}function ne({doc:o,index:i}){var a;const[,s]=S(),t=()=>{y(e.jsx(I,{onDone:k,initial:{question:o.question||"",content:o.content||""}}),{showCloseButton:!0,width:"700px"})},n=async c=>{console.log("Deleting document with ID:",c),await ee(c)};return e.jsxs("div",{className:v("w-full flex flex-row px-4 py-3 gap-8 border-b border-gray-100",{"bg-white":i%2!==0,"bg-[#f7f7f7]":i%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!o.question&&e.jsx("span",{className:"font-normal text-md",children:o.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:o.content}),!!o.sourceDocument&&((a=s==null?void 0:s.trainingMedia)==null?void 0:a.length)>0&&e.jsx(ae,{document:o,trainingMedia:s.trainingMedia})]}),e.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[e.jsx(b,{icon:e.jsx(M,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>n(o._id)}),e.jsx(b,{icon:e.jsx(O,{height:24,width:24}),type:"plain",className:"me-8",onClick:t})]})]})}function ae({document:o,trainingMedia:i}){const s=o.sourceDocument,t=x.useMemo(()=>{if(!i||!s)return null;const n=i.find(c=>c.docId===s);if(!n)return null;let a="";return n.url?a=decodeURIComponent(n.url.substring(n.url.lastIndexOf("/")+1)):n.originalName&&(a=n.originalName),{...n,fileName:a}},[s,i]);return t?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),t.url?e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[t.fileName,t.name?` ( ${t.name} )`:""]}):e.jsx("span",{children:t.fileName||t.name||"Unknown Document"})]}):null}const ie=({count:o,counts:i,currentPage:s,totalPages:t,onChangeCount:n,goToPage:a})=>{const c=i.map(r=>({label:r,value:r}));return e.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 min-w-max",children:"Rows per page"}),e.jsx(W,{className:"border border-gray-300 rounded px-2 py-1",value:o,options:c,showClear:!1,onChange:r=>n(r)})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(1),disabled:s===1,children:"«"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(s-1),disabled:s===1,children:"‹"}),e.jsxs("span",{className:"px-2 text-sm font-medium",children:[s," of ",t||1]}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(s+1),disabled:s>=t||!t,children:"›"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(t),disabled:s>=t||!t,children:"»"})]})]})},Se=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{oe as K,Ne as a,Se as b,we as g};
