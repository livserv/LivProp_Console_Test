import{r as u,j as e,c as _,S as V,h as f,R as O}from"./AlertSnackbar-C1aUMYU1.js";import{c as y}from"./index-CaBd9U9N.js";import{S as z}from"./delete-DBBYroVm.js";import{S as G}from"./download-CF2ONCOX.js";import{S as M}from"./edit-DtuwsU34.js";import{S as K}from"./plus-JK6up8ig.js";import{S as H,T as Q}from"./TableFooter-Sw0yz9Sj.js";import"./Button-858BvB8A.js";import{B as x}from"./Button-CyKn1nFN.js";import{T as $}from"./TextBox-DpFMXUQ6.js";import{s as S,h as D}from"./utils-BPLOM7gE.js";import{C as J}from"./ConfirmDialog-Br1LktL3.js";import{b as W,c as X,d as Y,e as Z,f as ee}from"./trainingDocuments-BLN79bKs.js";import{u as I}from"./useSelectedBot-DfCk3dXC.js";import{P as te}from"./PageHeader-lhnbYhCq.js";import{S as se}from"./send-B13BkskV.js";import{F as oe,a as ne,d as re}from"./index-BUtnEojO.js";import"./SelectBox-BqLJ97oN.js";import"./LabelWrapper-CF3T_xZa.js";import"./ajax-C92vMgMI.js";import"./env-CmL5wTXD.js";import"./bots-RTkzsknN.js";import"./organization-D650NEzb.js";function k({onDone:o,initial:r,onUpdate:l}){const[s,n]=u.useState(r||{question:"",content:"",_id:""}),a=(i,d)=>{n(N=>({...N,[i]:d}))},c=async()=>{const i=await W(s);l?.(i),o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(oe,{value:s,onChange:n,children:[e.jsx(ne,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:i=>a("question",i)}),e.jsx(re,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-40",onChange:i=>a("content",i)})]}),e.jsx("div",{className:"text-center",children:e.jsx(x,{icon:e.jsx(se,{}),size:"lg",type:"rounded",onClick:c,className:"bg-[#49d4a1]"})})]})}function Ee(o){const{activeIndex:r,onNavigate:l=()=>{},docsList:s,onUpdate:n}=o,a=_(t=>t.organizationId),[c]=I(),[i,d]=X(),N=s??i,[h,T]=u.useState(10),[p,C]=u.useState(1),[g,q]=u.useState(""),E=[10,15,20,25],j=(N||[]).filter(t=>!g||t.question?.toLowerCase().includes(g.toLowerCase())||t.content?.toLowerCase().includes(g.toLowerCase())),w=Math.ceil(j.length/h),b=(p-1)*h,L=b+h,v=j.slice(b,L),B=()=>D(),R=()=>S(e.jsx(k,{onDone:B,onUpdate:n}),{showCloseButton:!0,width:"700px"}),P=async()=>{try{await Y(),f(!0,"Documents downloaded successfully","success")}catch(t){console.error("Error while downloading docs:",t),f(!0,"Failed to download documents","error")}};u.useEffect(()=>{p>w&&C(1)},[j.length,w,p]);const F=t=>{const m=typeof t=="string"?parseInt(t,10):t;typeof m=="number"&&!isNaN(m)&&(T(m),C(1))},A=t=>{t<1||t>w||C(t)},U=async()=>{try{await Z({botDetailsForVerification:{integrationUrl:""}},a,c)?f(!0,"The bot deployed successfully","success"):f(!0,"Not able to deploy the bot. Try after sometime!","error"),r&&l(r+1)}catch(t){console.error("Error during bot verification:",t),f(!0,"Not able to verify the bot. Try after sometime!","error")}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!s&&!r&&e.jsx("div",{children:e.jsx(te,{title:"Chat Bot Knowledge",icon:K,onClick:R})}),!s&&!r&&e.jsx("div",{className:"flex justify-between items-center py-3 px-2",children:e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx($,{value:g,placeholder:"Search",onChange:t=>q(t.target.value),iconRight:H}),e.jsx(x,{icon:e.jsx(G,{}),size:"sm",type:"secondary",className:"align-middle ",onClick:P,title:"Download as CSV"})]})}),e.jsxs("div",{className:y("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":d}),children:[e.jsx("div",{className:"flex-1",children:d?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:e.jsx(V,{className:"animate-spin w-12 h-12 text-primary"})}):v.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"No documents found."}):v.map((t,m)=>e.jsx(ae,{doc:t,index:b+m,onUpdate:n},t._id))}),!s&&e.jsx(Q,{columns:[],rowsCount:h,onChangeCount:F,rowsCounts:E,pageIndex:p,totalPages:w,onNavigate:A,totalRows:j.length})]}),r&&!s&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(x,{label:"GENERATE",onClick:U})})]})}function ae({doc:o,index:r,onUpdate:l}){const[,s]=I(),[n,a]=O.useState(!1),c=()=>{S(e.jsx(k,{onDone:D,initial:{question:o.question||"",content:o.content||"",_id:o._id},onUpdate:l}),{showCloseButton:!0,width:"700px"})},i=async d=>{console.log("Deleting document with ID:",d),await ee(d)};return e.jsxs("div",{className:y("w-full flex flex-row px-4 py-3 gap-4 border-b border-gray-100",{"bg-white":r%2!==0,"bg-[#f7f7f7]":r%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:[!!o.question&&e.jsx("span",{className:"font-normal text-md break-words",children:o.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3 break-words",children:o.content}),!!o.sourceDocument&&s?.trainingMedia?.length>0&&e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3 break-words",children:e.jsx(ie,{document:o,trainingMedia:s.trainingMedia})})]}),e.jsxs("div",{className:"flex flex-row items-center gap-2 flex-shrink-0",children:[e.jsx(x,{icon:e.jsx(z,{height:24,width:24}),type:"plain",onClick:()=>a(!0)}),e.jsx(x,{icon:e.jsx(M,{height:24,width:24}),type:"plain",onClick:c})]}),e.jsxs(J,{title:"Are sure you want to delete?",open:n,setOpen:a,onConfirm:()=>i(o._id),children:["Confirm the deletion ",o.question||o._id,"."]})]})}function ie({document:o,trainingMedia:r}){const l=o.sourceDocument,s=u.useMemo(()=>{if(!r||!l)return null;const n=r.find(c=>c.docId===l);if(!n)return null;let a="";return n.url?a=decodeURIComponent(n.url.substring(n.url.lastIndexOf("/")+1)):n.originalName&&(a=n.originalName),{...n,fileName:a}},[l,r]);return s?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),s.url?e.jsxs("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[s.fileName,s.name?` ( ${s.name} )`:""]}):e.jsx("span",{children:s.fileName||s.name||"Unknown Document"})]}):null}export{Ee as default};
