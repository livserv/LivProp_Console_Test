import{r as u,j as e,c as _,S as V,h as f,R as O}from"./AlertSnackbar-Cu3h0plZ.js";import{c as y}from"./index-Dg8oRa5J.js";import{S as z}from"./delete-C6YpXY0O.js";import{S as G}from"./download-CzRVVFET.js";import{S as M}from"./edit-VrWMFNEh.js";import{S as K}from"./plus-BIc-EsA3.js";import{S as H,T as Q}from"./TableFooter-BVFgPTOX.js";import"./Button-CdgpWTFt.js";import{B as x}from"./Button-xOGl-aJM.js";import{T as $}from"./TextBox-5aOHTS0e.js";import{s as S,h as D}from"./utils-BPLOM7gE.js";import{C as J}from"./ConfirmDialog-BKi3KCNW.js";import{b as W,c as X,d as Y,e as Z,f as ee}from"./trainingDocuments-DcMDnJto.js";import{u as I}from"./useSelectedBot-Be2ooMzm.js";import{P as te}from"./PageHeader-DOOQ2yEQ.js";import{S as oe}from"./send-DHeWFBaW.js";import{F as se,b as ne}from"./index-CVcrBw65.js";import{F as re}from"./Form-DWA9qjOT.js";import"./SelectBox-BDGweDPH.js";import"./LabelWrapper-EgF8sr7h.js";import"./ajax-C92vMgMI.js";import"./env-CmL5wTXD.js";import"./bots-vzdJkLOI.js";import"./organization-DVIpOgT3.js";function k({onDone:s,initial:r,onUpdate:l}){const[o,n]=u.useState(r||{question:"",content:"",_id:""}),a=(i,d)=>{n(N=>({...N,[i]:d}))},c=async()=>{const i=await W(o);l?.(i),s()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(re,{value:o,onChange:n,children:[e.jsx(se,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:i=>a("question",i)}),e.jsx(ne,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-40",onChange:i=>a("content",i)})]}),e.jsx("div",{className:"text-center",children:e.jsx(x,{icon:e.jsx(oe,{}),size:"lg",type:"rounded",onClick:c,className:"bg-[#49d4a1]"})})]})}function Le(s){const{activeIndex:r,onNavigate:l=()=>{},docsList:o,onUpdate:n}=s,a=_(t=>t.organizationId),[c]=I(),[i,d]=X(),N=o??i,[h,T]=u.useState(10),[p,b]=u.useState(1),[g,q]=u.useState(""),E=[10,15,20,25],j=(N||[]).filter(t=>!g||t.question?.toLowerCase().includes(g.toLowerCase())||t.content?.toLowerCase().includes(g.toLowerCase())),w=Math.ceil(j.length/h),C=(p-1)*h,L=C+h,v=j.slice(C,L),B=()=>D(),R=()=>S(e.jsx(k,{onDone:B,onUpdate:n}),{showCloseButton:!0,width:"700px"}),F=async()=>{try{await Y(),f(!0,"Documents downloaded successfully","success")}catch(t){console.error("Error while downloading docs:",t),f(!0,"Failed to download documents","error")}};u.useEffect(()=>{p>w&&b(1)},[j.length,w,p]);const P=t=>{const m=typeof t=="string"?parseInt(t,10):t;typeof m=="number"&&!isNaN(m)&&(T(m),b(1))},A=t=>{t<1||t>w||b(t)},U=async()=>{try{await Z({botDetailsForVerification:{integrationUrl:""}},a,c)?f(!0,"The bot deployed successfully","success"):f(!0,"Not able to deploy the bot. Try after sometime!","error"),r&&l(r+1)}catch(t){console.error("Error during bot verification:",t),f(!0,"Not able to verify the bot. Try after sometime!","error")}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!o&&!r&&e.jsx("div",{children:e.jsx(te,{title:"Chat Bot Knowledge",icon:K,onClick:R})}),!o&&!r&&e.jsx("div",{className:"flex justify-between items-center py-3 px-2",children:e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx($,{value:g,placeholder:"Search",onChange:t=>q(t.target.value),iconRight:H}),e.jsx(x,{icon:e.jsx(G,{}),size:"sm",type:"secondary",className:"align-middle ",onClick:F,title:"Download as CSV"})]})}),e.jsxs("div",{className:y("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":d}),children:[e.jsx("div",{className:"flex-1",children:d?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:e.jsx(V,{className:"animate-spin w-12 h-12 text-primary"})}):v.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"No documents found."}):v.map((t,m)=>e.jsx(ae,{doc:t,index:C+m,onUpdate:n},t._id))}),!o&&e.jsx(Q,{columns:[],rowsCount:h,onChangeCount:P,rowsCounts:E,pageIndex:p,totalPages:w,onNavigate:A,totalRows:j.length})]}),r&&!o&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(x,{label:"GENERATE",onClick:U})})]})}function ae({doc:s,index:r,onUpdate:l}){const[,o]=I(),[n,a]=O.useState(!1),c=()=>{S(e.jsx(k,{onDone:D,initial:{question:s.question||"",content:s.content||"",_id:s._id},onUpdate:l}),{showCloseButton:!0,width:"700px"})},i=async d=>{console.log("Deleting document with ID:",d),await ee(d)};return e.jsxs("div",{className:y("w-full flex flex-row px-4 py-3 gap-4 border-b border-gray-100",{"bg-white":r%2!==0,"bg-[#f7f7f7]":r%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1 min-w-0",children:[!!s.question&&e.jsx("span",{className:"font-normal text-md break-words",children:s.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3 break-words",children:s.content}),!!s.sourceDocument&&o?.trainingMedia?.length>0&&e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3 break-words",children:e.jsx(ie,{document:s,trainingMedia:o.trainingMedia})})]}),e.jsxs("div",{className:"flex flex-row items-center gap-2 flex-shrink-0",children:[e.jsx(x,{icon:e.jsx(z,{height:24,width:24}),type:"plain",onClick:()=>a(!0)}),e.jsx(x,{icon:e.jsx(M,{height:24,width:24}),type:"plain",onClick:c})]}),e.jsxs(J,{title:"Are sure you want to delete?",open:n,setOpen:a,onConfirm:()=>i(s._id),children:["Confirm the deletion ",s.question||s._id,"."]})]})}function ie({document:s,trainingMedia:r}){const l=s.sourceDocument,o=u.useMemo(()=>{if(!r||!l)return null;const n=r.find(c=>c.docId===l);if(!n)return null;let a="";return n.url?a=decodeURIComponent(n.url.substring(n.url.lastIndexOf("/")+1)):n.originalName&&(a=n.originalName),{...n,fileName:a}},[l,r]);return o?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),o.url?e.jsxs("a",{href:o.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[o.fileName,o.name?` ( ${o.name} )`:""]}):e.jsx("span",{children:o.fileName||o.name||"Unknown Document"})]}):null}export{Le as default};
