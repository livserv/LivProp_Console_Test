import{o as S,g as u,q as w,r as p,p as g}from"./index-B4Pd27tI.js";import{f as l}from"./bots-BMhX1rh2.js";import{c,R as D,l as $,u as d,o as I}from"./AlertSnackbar-BBOi9bHj.js";import{u as m}from"./useSelectedBot-CTuACohy.js";const i=$(()=>({page:1,rowsPerPage:10,totalDocs:0,docsList:[],isLoading:!1,kbDocs:{}}));function z(){const n=c(s=>s.organizationId),[o]=m();D.useEffect(()=>{y()},[o,n]);const e=i(s=>s.docsList),t=i(s=>s.isLoading);return[e,t]}async function y(n=1,o=10){const{organizationId:e}=c.getState(),{selectedBotId:t}=d.getState();if(!e||!t)return;const{botId:s}=i.getState(),a={page:n,rowsPerPage:o,isLoading:!0};s!==t&&(a.docsList=[]),i.setState(a);const r=await S.get(`/bot/${e}/${t}/knowledge-base/list`);i.setState({botId:t,docsList:r,totalDocs:r.length,isLoading:!1})}async function B(n){const{selectedBotId:o}=d.getState(),{organizationId:e}=c.getState(),{kbDocs:t}=i.getState(),s=await u(`/bot/${e}/${o}/knowledge-base/list`);i.setState(a=>({kbDocs:{...a.docsList||{},[String(o)]:s}}))}async function F(n){const{selectedBotId:o}=d.getState(),{organizationId:e}=c.getState();if(!o)throw new Error("No bot selected");const t=await g(`/bot/${e}/${o}/knowledge-base`,n);return i.setState(s=>{const a=[...s.docsList||[]];if(!Array.isArray(a))return{docsList:[t],totalDocs:1};if(n._id){const r=a.findIndex(b=>b._id===t._id);r>=0?a[r]=t:a.push(t)}else a.push(t);return{docsList:a,totalDocs:a.length}}),t}async function x(n){const{selectedBotId:o}=d.getState(),{organizationId:e}=c.getState();if(!o)throw new Error("No bot selected");await p(`/bot/${e}/${o}/knowledge-base/${n}`,n),i.setState(t=>{const a=[...t.docsList||[]].filter(r=>r._id!==n);return{docsList:a,totalDocs:a.length}})}async function C(n){if(!n?.length)return[];const{organizationId:o}=c.getState(),{selectedBotId:e}=d.getState();return await u(`/bot/${o}/${e}/knowledge-base/list?${n.map(t=>`docIds=${t}`).join("&")}`)}async function E(){const{organizationId:n,botsMap:o}=c.getState(),{selectedBotId:e}=d.getState(),t=`/bot/${n}/${e}/knowledge-base/download`,s=await u(t),a=o[String(e)]?.botName||"KBDocs";w(s,a+"_"+I().format("YYYYMMDD")+".csv")}async function _(n){const{organizationId:o}=c.getState(),{selectedBotId:e}=d.getState(),t=await g(`/bot/${o}/${e}/add-training-media`,n);t.trainingMedia?e?(l(e,{trainingMedia:t.trainingMedia}),await f(e,o)):console.error("Bot ID is undefined."):console.warn("trainingMedia is null or undefined.")}async function K(n){const{organizationId:o}=c.getState(),{selectedBotId:e}=d.getState(),t=new FormData;if(t.append("file",n),!(!o||!e))try{const s=await g(`/bot/${o}/${e}/add-training-media`,t);l(e,{trainingMedia:s.trainingMedia}),await f(e,o)}catch{throw new Error("File upload failed. Please try again.")}}async function P(n,o,e){const t=await g(`/bot/${e}/${o}/delete-training-media-document`,n);l(o,{trainingMedia:t.trainingDocuments})}async function f(n,o){const e=await g(`/bot/${o}/${n}/knowledge-base/train`,{});return i.setState(t=>{const s={...t.kbDocs||{}};return delete s[n],{kbDocs:s}}),B().catch(t=>console.error("Error fetching Knowledge base content:",t)),e}async function R(n,o,e){const t=await g(`/bot/${o}/${e}/add-bot-tax-details`,n),{_id:s,botDetailsForVerification:a}=t;return l(s,{botDetailsForVerification:a}),a}export{_ as a,F as b,z as c,E as d,R as e,x as f,C as g,P as h,f as t,K as u};
