import{g as N,c as w,R as i,r as f,j as e}from"./AlertSnackbar-BZv5XCa6.js";import{g as j,j as R}from"./index-BmF1FII0.js";import{a as k,C as V,K as A}from"./KbDocsEditor-24WSYT2u.js";import"./env-CmL5wTXD.js";import"./svg-icons-DYx9xu16.js";import"./env-CBDBHzQq.js";import"./Button-G0N6qh_I.js";import"./index-BCBe3WsG.js";import"./KbDocsList-GK7HZsV3.js";import"./delete-DMobMiQi.js";import"./download-3fltnL9L.js";import"./edit-DO3kkDAl.js";import"./plus-Cj5yGcnd.js";import"./TableFooter-Dn6rnFKD.js";import"./SelectBox-1plhzATO.js";import"./LabelWrapper-COY-wAmE.js";import"./Button-Bp3KLPoL.js";import"./TextBox-DOuaDUpj.js";import"./utils-BPLOM7gE.js";import"./ConfirmDialog-CcXuGu7e.js";import"./trainingDocuments-CLBzY402.js";import"./bots-R5UKFFoc.js";import"./useSelectedBot-De1owT-_.js";import"./PageHeader-Dxt-ivdX.js";import"./organization-DGedQ_Gd.js";import"./send-BwQvgGFa.js";import"./index-F7RWJ0Hq.js";import"./ProgressButton-BXdCpKCq.js";function he(s){const o=N(),r=s.organizationId??o.organizationId,n=s.botId??o.botId,c=s.recipientId??o.recipientId,d=s.chatId??o.chatId,{isSuperUser:y}=w(),{isAuthenticated:g}=w(),[l,I]=i.useState(),[m,$]=i.useState(),[u,h]=f.useState(null),[x,b]=f.useState(!1),v=`/bot/${r}/${n}/chat/history/${c}/${d}?includeBot=1${g?"&includeKB=1":""}${m?.code?`&language=${encodeURIComponent(m.code)}`:""}`;i.useEffect(()=>{j(v).then(t=>{const a=R(t.messages[0]?.createdAt);t.botDesign=k(t.botDesign,{window:{width:"600px",height:"calc(100vh - 120px)"},header:{titleText:a+` (${t.titleText})`}}),I(E(t))},t=>{console.error("Unable to load chat conversations:",t)})},[v]);const C=i.useCallback(async(t,a)=>{const p=await j(`/bot/${r}/${n}/chat/history/${c}/${d}/replay/${t}?modelName=${a||""}`);h(p)},[r,n,c,d]);if(!l)return e.jsx("div",{children:"Loading... Please wait..."});const S=t=>{const{role:a,type:p,passedDocIds:H,searchQuery:M}=t||{};if(a!=="assistant"||p!=="text"||!H?.length&&!M)return null;const B=()=>e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M19 2H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm0 17H8V4h11v15zm-2-7H10v2h7v-2zm0-4H10v2h7V8zm-9 9H5V5c0-1.1.9-2 2-2h1v2H7v12zm0 2v-2h1v2H7z"})});return e.jsx("span",{className:"ml-2 cursor-pointer",onClick:()=>D(t),children:e.jsx(B,{})})},D=t=>{h(t),b(!0)},z=()=>{b(!1),h(null)};return e.jsxs("div",{className:"conversation-history overflow-x-auto"+(g&&x?" with-sidebar":""),children:[e.jsx("div",{className:"chat-window-wrapper ",children:e.jsx(V,{botDesign:l.botDesign,messages:l.messages,showTime:!0,disabledMessage:!0,optionsRenderer:S,language:m,setLanguage:$,activateVoiceBot:!1})}),u&&x&&e.jsxs("div",{className:"sidebar-wrapper",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 pb-2 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold m-0",children:"View Knowledge base"}),e.jsx("button",{onClick:z,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close sidebar",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsx(A,{message:u,isSuperUser:y,onReplay:C})]})]})}function E(s){const o=s.messages.length&&s.messages[s.messages.length-1];return o?.type==="options"&&(o.content=""),s}export{he as default};
