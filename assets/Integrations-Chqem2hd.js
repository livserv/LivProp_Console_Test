import{j as e,h as ue,i as fe,r as Z,e as xe,b as z,R as be}from"./index-BjyquQqj.js";import{F as H,a as he}from"./formik.esm-B0MMKUlQ.js";import{c as E,a as I,b as oe,d as X,e as ye,f as Ce}from"./index.esm-BbH67Ydh.js";import{a as N,P as ve}from"./ProgressButton-6xkmWtq3.js";import{B as w}from"./Button-xWVoz13c.js";import"./Button-6bMBa1_B.js";import{w as Y,l as Ne}from"./ajax-O4xclg-c.js";import{T as S}from"./TextBox-CU_W52Of.js";import{a as ge,b as re,d as ke,g as je}from"./integrations-BQYK17fX.js";import{w as se}from"./env-CBDBHzQq.js";import{s as L}from"./utils-B3TvvZ68.js";import{C as M,S as we}from"./ConfirmDialog-XlayNP6h.js";import{a as Te}from"./organization-DDg6GkQH.js";import{S as Ue}from"./cancel-guiltXZJ.js";import{S as Se}from"./plus-DjIalJJv.js";import{S as O}from"./whatsapp-NvO0N6MU.js";import{u as Pe}from"./useSelectedBot-CLgcYbP9.js";import{P as De}from"./PageHeader-Bs-rHxpU.js";import"./hoist-non-react-statics.cjs-Hp8kthgL.js";function ne({botId:t,organizationId:l,setPopUpDialog:C}){const o=async(p,{setErrors:x,setStatus:d,setSubmitting:a})=>{try{const i={botId:t,organizationId:l,callbackURL:p.crmCallBackUrl,channelId:"CRM_Callback_123",channelName:"CRM_Callback"};await ge(i),d({success:!0}),a(!0),C(!1),N(!0,"The CRM callback url added successfully!","success")}catch(i){d({success:!1}),x({submit:i.message}),a(!1),N(!0,"Not able to CRM callback url. Try after sometime!","error")}};return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{crmCallBackUrl:"",submit:""},validationSchema:E().shape({crmCallBackUrl:I().url("Enter valid url!").required("CRM Callback URL is required"),submit:I()}),onSubmit:o,children:({errors:p,handleBlur:x,handleChange:d,handleSubmit:a,isSubmitting:i,touched:c,values:y})=>e.jsxs("form",{noValidate:!0,onSubmit:a,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(S,{label:"CRM callback URL",id:"crmCallBackUrl",type:"url",name:"crmCallBackUrl",value:y.crmCallBackUrl,onBlur:x,onChange:d,autoComplete:"off",className:c.crmCallBackUrl&&p.crmCallBackUrl?"border-red-500":""}),c.crmCallBackUrl&&p.crmCallBackUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.crmCallBackUrl})]}),p.submit&&e.jsx("div",{className:"text-red-600 text-xs mb-2",children:p.submit}),e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:i?"Adding...":"Add"})})]})})})}var B={},G,ee;function Ie(){return ee||(ee=1,G=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var l=document.activeElement,C=[],o=0;o<t.rangeCount;o++)C.push(t.getRangeAt(o));switch(l.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":l.blur();break;default:l=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||C.forEach(function(p){t.addRange(p)}),l&&l.focus()}}),G}var K,ae;function Re(){if(ae)return K;ae=1;var t=Ie(),l={"text/plain":"Text","text/html":"Url",default:"Text"},C="Copy to clipboard: #{key}, Enter";function o(x){var d=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return x.replace(/#{\s*key\s*}/g,d)}function p(x,d){var a,i,c,y,b,s,h=!1;d||(d={}),a=d.debug||!1;try{c=t(),y=document.createRange(),b=document.getSelection(),s=document.createElement("span"),s.textContent=x,s.ariaHidden="true",s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",function(g){if(g.stopPropagation(),d.format)if(g.preventDefault(),typeof g.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var U=l[d.format]||l.default;window.clipboardData.setData(U,x)}else g.clipboardData.clearData(),g.clipboardData.setData(d.format,x);d.onCopy&&(g.preventDefault(),d.onCopy(g.clipboardData))}),document.body.appendChild(s),y.selectNodeContents(s),b.addRange(y);var T=document.execCommand("copy");if(!T)throw new Error("copy command was unsuccessful");h=!0}catch(g){a&&console.error("unable to copy using execCommand: ",g),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(d.format||"text",x),d.onCopy&&d.onCopy(window.clipboardData),h=!0}catch(U){a&&console.error("unable to copy using clipboardData: ",U),a&&console.error("falling back to prompt"),i=o("message"in d?d.message:C),window.prompt(i,x)}}finally{b&&(typeof b.removeRange=="function"?b.removeRange(y):b.removeAllRanges()),s&&document.body.removeChild(s),c()}return h}return K=p,K}var te;function Ae(){if(te)return B;te=1;function t(r){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(r)}Object.defineProperty(B,"__esModule",{value:!0}),B.CopyToClipboard=void 0;var l=p(ue()),C=p(Re()),o=["text","onCopy","options","children"];function p(r){return r&&r.__esModule?r:{default:r}}function x(r,n){var u=Object.keys(r);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(r);n&&(m=m.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),u.push.apply(u,m)}return u}function d(r){for(var n=1;n<arguments.length;n++){var u=arguments[n]!=null?arguments[n]:{};n%2?x(Object(u),!0).forEach(function(m){P(r,m,u[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(u)):x(Object(u)).forEach(function(m){Object.defineProperty(r,m,Object.getOwnPropertyDescriptor(u,m))})}return r}function a(r,n){if(r==null)return{};var u=i(r,n),m,v;if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(r);for(v=0;v<j.length;v++)m=j[v],!(n.indexOf(m)>=0)&&Object.prototype.propertyIsEnumerable.call(r,m)&&(u[m]=r[m])}return u}function i(r,n){if(r==null)return{};var u={},m=Object.keys(r),v,j;for(j=0;j<m.length;j++)v=m[j],!(n.indexOf(v)>=0)&&(u[v]=r[v]);return u}function c(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function y(r,n){for(var u=0;u<n.length;u++){var m=n[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(r,m.key,m)}}function b(r,n,u){return n&&y(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function s(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&h(r,n)}function h(r,n){return h=Object.setPrototypeOf||function(m,v){return m.__proto__=v,m},h(r,n)}function T(r){var n=f();return function(){var m=k(r),v;if(n){var j=k(this).constructor;v=Reflect.construct(m,arguments,j)}else v=m.apply(this,arguments);return g(this,v)}}function g(r,n){if(n&&(t(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U(r)}function U(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function f(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(r){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)},k(r)}function P(r,n,u){return n in r?Object.defineProperty(r,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[n]=u,r}var R=(function(r){s(u,r);var n=T(u);function u(){var m;c(this,u);for(var v=arguments.length,j=new Array(v),D=0;D<v;D++)j[D]=arguments[D];return m=n.call.apply(n,[this].concat(j)),P(U(m),"onClick",function(_){var A=m.props,$=A.text,Q=A.onCopy,ce=A.children,me=A.options,W=l.default.Children.only(ce),pe=(0,C.default)($,me);Q&&Q($,pe),W&&W.props&&typeof W.props.onClick=="function"&&W.props.onClick(_)}),m}return b(u,[{key:"render",value:function(){var v=this.props;v.text,v.onCopy,v.options;var j=v.children,D=a(v,o),_=l.default.Children.only(j);return l.default.cloneElement(_,d(d({},D),{},{onClick:this.onClick}))}}]),u})(l.default.PureComponent);return B.CopyToClipboard=R,P(R,"defaultProps",{onCopy:void 0,options:void 0}),B}var V,le;function _e(){if(le)return V;le=1;var t=Ae(),l=t.CopyToClipboard;return l.CopyToClipboard=l,V=l,V}var F=_e();const J=fe(F);function ie({botId:t,organizationId:l,setPopUpDialog:C,gupshupIntegrationObj:o,edit:p}){const x=async(a,{setErrors:i,setStatus:c,setSubmitting:y})=>{try{let b=a;const s=o==null?void 0:o._id;o&&(b={...a,objId:s}),await re(b),c({success:!0}),y(!0),C(!1),N(!0,"The Gupshup integration added successfully!","success")}catch(b){c({success:!1}),i({submit:b.message}),y(!1),N(!0,"Not able to activate Gupshup integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${se}/gupshup/${l}/${t}/entrypoint`,appId:(o==null?void 0:o.appId)||"",appName:(o==null?void 0:o.appName)||"",phoneNumberId:(o==null?void 0:o.phoneNumberId)||"",channelId:"gupshup_123",channelName:"gupshup",leadCategory:(o==null?void 0:o.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(o==null?void 0:o.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:I().required("App ID is required"),appName:I().required("App name is required"),phoneNumberId:X().min(10,"Please enter a valid phone number id").required("Phone number is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||typeof a=="number"&&a>0)}),onSubmit:x,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:y,isSubmitting:b,touched:s,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:y,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Gupshup Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:h.webHookUrl,onCopy:()=>N(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:c,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"Gupshup App ID *"}),e.jsx(S,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:T=>c(T.target.value),autoComplete:"off",onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.appId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"Gupshup App Name *"}),e.jsx(S,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number *"}),e.jsx(S,{id:"phoneNumberId",name:"phoneNumberId",type:"number",value:h.phoneNumberId,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.phoneNumberId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.phoneNumberId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:c,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadCategory})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(S,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadUpgradeToPreSaleCount=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadUpgradeToPreSaleCount})})]})]}),a.submit&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(w,{disabled:b,isLoading:b,htmlType:"submit",type:"primary",size:"lg",label:p?"Edit":"Add"})})]})})})}function Ee(t,l){return btoa(`${t}_${l}_whatsapp_int`)}function de({botId:t,organizationId:l,setPopUpDialog:C,whatsappIntegrationObj:o,edit:p}){const x=async(a,{setErrors:i,setStatus:c,setSubmitting:y})=>{try{let b=a;const s=o==null?void 0:o._id;s&&(b={...a,objId:s}),await re(b),c({success:!0}),y(!0),C(!1),N(!0,"The WhatsApp integration added successfully!","success")}catch(b){c({success:!1}),i({submit:b.message}),y(!1),N(!0,"Not able to activate WhatsApp integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${se}/whatsapp/${l}/${t}/entrypoint`,webHookSecret:Ee(l,t),appId:(o==null?void 0:o.appId)||"",appName:(o==null?void 0:o.appName)||"",phoneNumberId:(o==null?void 0:o.phoneNumberId)||"",verificationToken:(o==null?void 0:o.verificationToken)||"",channelId:"whatsapp_123",channelName:"whatsapp",leadCategory:(o==null?void 0:o.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(o==null?void 0:o.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:X().required("App ID must be a number"),appName:I().required("App name is required"),phoneNumberId:X().min(10,"Please enter a valid phone number id").required("Phone number is required"),verificationToken:I().required("Access Token  is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||!isNaN(Number(a))&&Number(a)>0)}),onSubmit:x,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:y,isSubmitting:b,touched:s,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:y,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Webhook Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:h.webHookUrl,onCopy:()=>N(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:c,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookSecret",children:"Webhook Verify token *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:h.webHookSecret,onCopy:()=>N(!0,"Webhook Verify Token copied to clipboard","success"),children:e.jsx("input",{id:"webHookSecret",type:"text",value:h.webHookSecret,name:"webHookSecret",onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100",disabled:!0})})}),s.webHookSecret&&a.webHookSecret&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookSecret})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"App ID *"}),e.jsx(S,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:c,onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"App Name *"}),e.jsx(S,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&a.appName==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number ID *"}),e.jsx(S,{id:"phoneNumberId",name:"phoneNumberId",type:"text",value:h.phoneNumberId,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&a.phoneNumberId==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"verificationToken",children:"Access Token *"}),e.jsx(S,{id:"verificationToken",name:"verificationToken",type:"text",value:h.verificationToken,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.verificationToken&&a.verificationToken?"border-red-500":""}),s.verificationToken&&a.verificationToken&&typeof a.verificationToken=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.verificationToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:c,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(S,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadUpgradeToPreSaleCount})]})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ve,{isLoading:b,disabled:b,type:"submit",children:p?"Edit":"Add"})})]})})})}function q({label:t,value:l,copyText:C,onCopy:o}){return e.jsxs("div",{className:"flex items-center gap-2 my-1",children:[e.jsx("b",{style:{minWidth:180},children:t}),e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:350,flex:"1 1 auto",marginRight:8,fontFamily:"monospace"},title:l,children:l}),e.jsx(F.CopyToClipboard,{text:C||l,onCopy:o,children:e.jsx(w,{label:"Copy",type:"primary",style:{minWidth:60}})})]})}function Le({integrationObj:t}){const[l,C]=Z.useState(!1),[o,p]=Z.useState(!1),x=async(i,c)=>{try{await ke(i),N(!0,`The ${c} deleted successfully!`,"success")}catch{N(!0,`Not able to delete the ${c}. Try after sometime!`,"error")}},d=i=>{const c=new Date(i);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(c)};let a=null;if(t.channelName==="Webchat")a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"Chat window Script Tag"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.scriptTag}),e.jsx(F.CopyToClipboard,{text:t.scriptTag,onCopy:()=>N(!0,"chat script copied to clipboard","success"),children:e.jsx(w,{label:"Copy",type:"primary"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]});else if(t.channelName==="whatsapp"){const i=`${Y}/whatsapp/${t.organizationId}/${t.botId}/${t._id}/entrypoint`,c=Ne(t.organizationId,t.botId);a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"WhatsApp Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(de,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},whatsappIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(w,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(M,{title:"Delete Whatsapp integration?",open:o,setOpen:p,onConfirm:()=>x(t,"Whatsapp integration"),children:"Confirm the deletion of Whatsapp integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number ID:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>N(!0,"Web hook callback url copied to clipboard","success")}),e.jsx(q,{label:"Webhook Verification Token:",value:c,onCopy:()=>N(!0,"Webhook Verification Token copied to clipboard","success")}),e.jsx(q,{label:"Access Token:",value:t.verificationToken,onCopy:()=>N(!0,"Access Token copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else if(t.channelName==="gupshup"){const i=`${Y}/gupshup/${t.organizationId}/${t.botId}/${t._id}/entrypoint`;a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"Gupshup Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ie,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},gupshupIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(w,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(M,{title:"Delete Gupshup integration?",open:o,setOpen:p,onConfirm:()=>x(t,"Gupshup integration"),children:"Confirm the deletion of Gupshup integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>N(!0,"Web hook callback url copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else t.channelName==="CRM_Callback"&&(a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"CRM Callback URL"}),l?e.jsx(w,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ne,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},crmIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.callbackURL}),e.jsx(w,{label:"Edit",type:"plain",onClick:()=>C(!0)}),e.jsx(w,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(F.CopyToClipboard,{text:t.callbackURL,onCopy:()=>N(!0,"CRM callback URL copied to clipboard","success"),children:e.jsx(w,{label:"Copy",type:"primary"})}),e.jsx(M,{title:"Delete CRM callback URL?",open:o,setOpen:p,onConfirm:()=>x(t,"crm callback url"),children:"Confirm the deletion of CRM callback URL."})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]}));return e.jsx("div",{className:"bg-white rounded shadow p-4 mb-4",children:a})}function $e({admins:t,index:l,handleBlur:C,handleChange:o,errors:p,touched:x,remove:d}){var a,i,c,y,b,s,h,T,g,U,f,k,P,R,r,n,u,m,v,j,D,_,A,$;return e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(S,{label:"Admin Name",id:`admins.${l}.adminName`,name:`admins.${l}.adminName`,type:"text",value:t.adminName,onBlur:C,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((i=(a=x.admins)==null?void 0:a[l])!=null&&i.adminName)&&((y=(c=p.admins)==null?void 0:c[l])!=null&&y.adminName)?"border-red-500":""}),l!==0&&((s=(b=x.admins)==null?void 0:b[l])==null?void 0:s.adminName)&&((T=(h=p.admins)==null?void 0:h[l])==null?void 0:T.adminName)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].adminName})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx(S,{label:"Role",id:`admins.${l}.role`,name:`admins.${l}.role`,type:"text",value:t.role,onBlur:C,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((U=(g=x.admins)==null?void 0:g[l])!=null&&U.role)&&((k=(f=p.admins)==null?void 0:f[l])!=null&&k.role)?"border-red-500":""}),l!==0&&((R=(P=x.admins)==null?void 0:P[l])==null?void 0:R.role)&&((n=(r=p.admins)==null?void 0:r[l])==null?void 0:n.role)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].role})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(S,{label:"Email",id:`admins.${l}.email`,name:`admins.${l}.email`,type:"text",value:t.email,onBlur:C,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((m=(u=x.admins)==null?void 0:u[l])!=null&&m.email)&&((j=(v=p.admins)==null?void 0:v[l])!=null&&j.email)?"border-red-500":""}),l!==0&&((_=(D=x.admins)==null?void 0:D[l])==null?void 0:_.email)&&(($=(A=p.admins)==null?void 0:A[l])==null?void 0:$.email)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].email})]}),l!==0&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Delete"}),e.jsx(w,{type:"plain",label:"ðŸ—‘ï¸",className:"text-2xl text-red-600",onClick:()=>d(l)})]})]})})}function Be({organizationId:t,admins:l}){const C={admins:l||[],submit:""},o=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),p=E().shape({admins:ye().of(Ce(a=>a.index===0?E().shape({}):E().shape({adminName:I().required("Admin Name is required"),role:I().required("Role is required"),email:I().trim().required("Email is required").email("Invalid email id").matches(o,"Invalid email id")})))}),x=a=>a.map((i,c)=>({...i,itemNo:c+1})),d=async(a,{setErrors:i,setStatus:c,setSubmitting:y})=>{try{y(!0),await Te(a,t),c({success:!0})}catch(b){c({success:!1}),i({submit:b.message}),y(!1),N(!0,b.message,"error")}};return e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Lead emails are sending to below given email ids"}),e.jsx("br",{}),e.jsx("br",{})]}),e.jsx(H,{initialValues:C,onSubmit:d,validationSchema:p,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:y,touched:b,values:s,setFieldValue:h,isSubmitting:T})=>e.jsx("form",{onSubmit:y,children:e.jsx(he,{name:"admins",children:({push:g,remove:U})=>e.jsxs(e.Fragment,{children:[s.admins.map((f,k)=>e.jsx($e,{admins:f,index:k,handleBlur:i,handleChange:c,errors:a,touched:b,remove:P=>{U(P);const R=x(s.admins.filter((r,n)=>n!==P));h("admins",R)}},k)),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4 mt-4",children:[e.jsx(w,{type:"secondary",className:"ml-2",onClick:()=>{g({adminName:"",role:"",email:""})},label:"Add Email"}),e.jsx(w,{type:"primary",className:"ml-2",disabled:T,isLoading:T,htmlType:"submit",label:"Save Changes"})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})]})})})})]})}function oa(){var U;const[t]=Pe(),l=xe(f=>f.botsList),C=z(f=>f.organizationId),o=z(f=>f.isSuperUser),p=z(f=>{var k;return(k=f.organization)==null?void 0:k.admins}),[x,d]=Z.useState(!1);be.useEffect(()=>{(async()=>{const k={organizationId:C,botId:t};try{await je(k)}catch{N(!0,"Not able to fetch integrations details. Try after sometime!","error")}})()},[t,C]);const a=(U=l.find(f=>f._id===t))==null?void 0:U.integrations;let i=null,c=null,y=null;a!==void 0&&(i=a.find(f=>f.channelName==="CRM_Callback"),c=a.find(f=>f.channelName==="whatsapp"),y=a.find(f=>f.channelName==="gupshup"));const b=()=>{L(c?e.jsx("div",{children:"The Whatsapp integration already configured."}):e.jsx(de,{botId:t,organizationId:C,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},s=()=>{L(i?e.jsx("div",{children:"The CRM Callback URL has been successfully configured."}):e.jsx(ne,{botId:t,organizationId:C,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},h=()=>{L(y?e.jsx("div",{children:"The Gupshup integration already configured."}):e.jsx(ie,{botId:t,organizationId:C,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},T=[{name:"WhatsApp Integration",icon:e.jsx(O,{}),method:b},{name:"CRM Callback",icon:e.jsx(we,{}),method:s},{name:"Gupshup Integration",icon:e.jsx(O,{}),method:h}],g=o?T:T.filter(f=>f.name!=="Gupshup Integration");return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 relative",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(De,{title:"Integrations",icon:x?Ue:Se,onClick:()=>d(f=>!f)}),x&&e.jsx("div",{className:"absolute right-0 top-[60px] flex flex-col items-end z-50",children:g.map(f=>e.jsx("button",{className:"mb-2 rounded-full bg-white shadow-lg w-8 h-8 flex items-center justify-center border border-gray-200 hover:bg-gray-100 transition",onClick:()=>{d(!1),f.method()},title:f.name,children:f.icon},f.name))})]})}),e.jsxs("div",{className:"space-y-4",children:[a&&a.map((f,k)=>f.channelId!=="callConnect_123"&&e.jsx(Le,{integrationObj:f},k)),o&&e.jsx(Be,{organizationId:C,admins:p})]})]})}export{oa as default};
