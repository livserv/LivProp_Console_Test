import{u as k,c as v,r as o,j as e,h as p}from"./AlertSnackbar-C1aUMYU1.js";import{f as F,u as B}from"./bots-RTkzsknN.js";import{S as w}from"./cancel-DwNAltMt.js";import{S as A}from"./delete-DBBYroVm.js";import{V as L,m as z}from"./svg-icons-s6gHrtH2.js";import{B as b}from"./Button-CyKn1nFN.js";import"./index-CaBd9U9N.js";import"./Button-858BvB8A.js";import{T as M}from"./TextBox-DpFMXUQ6.js";import{h as E,u as P,t as V,a as I}from"./trainingDocuments-BLN79bKs.js";import{u as T}from"./useSelectedBot-DfCk3dXC.js";import{S as O}from"./link-CZJeFCvB.js";import{S as W}from"./plus-JK6up8ig.js";import{T as $}from"./Toggle-DHRnwMWd.js";import{S as Z}from"./SpeedDial-U6qx180D.js";import{P as _}from"./PageHeader-lhnbYhCq.js";import"./ajax-C92vMgMI.js";import"./env-CmL5wTXD.js";import"./LabelWrapper-CF3T_xZa.js";import"./SelectBox-BqLJ97oN.js";import"./organization-D650NEzb.js";function D(t,s,a,i){function l(c,m,u){const{botsList:d}=k.getState(),x=d.find(f=>f._id===c);if(x){const f=x.trainingMedia.map(r=>r.url===m?{...r,name:u}:r);F(c,{trainingMedia:f}),v.setState(()=>({trainingMediaUpdate:!0}))}else console.error("Bot not found for the given ID.")}i==="delete"?l(a,t,t):l(a,t,s)}const H=t=>{window.open(t,"_blank")},R=async(t,s,a,i)=>{try{await E({organizationId:i,botId:a,fileName:s,fileUrl:t},a,i),p(!0,"The file deleted successfully!","success")}catch{p(!0,"Not able to delete the file. Try after sometime!","error")}};function Q({media:t,botId:s,organizationId:a}){const[i,l]=o.useState(!1),[c,m]=o.useState(""),[u,d]=o.useState(!1),[x,f]=o.useState(""),{name:r,url:n,type:g,originalName:h}=t,j=(N,y,S)=>{D(N,y,S,"delete")},C=async N=>{if(N.preventDefault(),f(""),!c){f("Training Media Name is required");return}if(c.length<3){f("Training Media Name length must be at least 3 characters");return}if(c.length>50){f("Training Media Name length must be less than 50 characters");return}try{d(!0),D(n,c,s,"add"),d(!1),m("")}catch(y){f(y.message),d(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4",style:{minHeight:"65px",maxHeight:"65px"},children:[h&&e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-gray-700",children:"File Name: "}),e.jsx("a",{href:n,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 truncate inline-block max-w-[250px] align-bottom",title:h,children:h})]})}),g==="single_page"&&e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-gray-700",children:"URL: "}),e.jsx("a",{href:n,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 truncate inline-block max-w-[250px] align-bottom",title:n,children:n})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-gray-700",children:"Type: "}),e.jsx("span",{className:"text-gray-600",children:g==="single_page"?"Web Page":"Document"})]})}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{className:"text-gray-700",children:"Document Name: "}),r===n?e.jsx("span",{className:"text-gray-600",children:"NA"}):e.jsxs("span",{className:"inline-flex items-center bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:[r,e.jsx("button",{onClick:()=>j(n,r,s),className:"ml-2 text-blue-600 hover:text-blue-800",children:e.jsx(w,{className:"w-3 h-3"})})]})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between border-gray-200 pt-4",children:[e.jsx("div",{className:"w-full md:flex-1",children:r===n?e.jsx("form",{onSubmit:C,className:"w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx(M,{placeholder:"Document Name",value:c,onChange:N=>m(N.target.value),className:"text-sm"}),x&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:x})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{type:"primary",size:"sm",label:u?"Adding...":"Add",htmlType:"submit",disabled:u,isLoading:u})})]})}):e.jsx("div",{className:"h-10"})}),e.jsxs("div",{className:"w-full md:w-auto mt-3 md:mt-0 flex items-center justify-center md:justify-end gap-2",children:[e.jsx("button",{onClick:()=>H(n),className:"p-2 text-green-600 hover:text-green-700 hover:bg-green-50 rounded transition",title:g==="text/plain"?"View Document":"View Web Page",children:e.jsx(L,{})}),e.jsx("button",{onClick:()=>l(!0),className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition",title:"Delete",children:e.jsx(A,{})})]})]}),i&&e.jsxs(q,{title:"Delete file?",open:i,setOpen:l,onConfirm:()=>R(n,h||n,s,a),children:["Confirm the deletion of ",h||n,"?"]})]})}function q({title:t,open:s,setOpen:a,onConfirm:i,children:l}){if(!s)return null;const c=()=>{i(),a(!1)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6 z-10",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:t}),e.jsx("p",{className:"text-gray-600 mb-6",children:l}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(b,{type:"secondary",size:"md",label:"Cancel",onClick:()=>a(!1)}),e.jsx(b,{type:"primary",size:"md",label:"Confirm",onClick:c})]})]})]})}function G({isOpen:t,toggleOpen:s}){return t?e.jsx(J,{isOpen:t,onClose:()=>s(!1),title:"Upload Training Documents",children:e.jsx(K,{setDocumentUploadDialogOpen:s})}):null}function J({isOpen:t,onClose:s,title:a,children:i}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:a}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(w,{className:"w-6 h-6"})})]}),i]})]}):null}const U=5242880;function K({setDocumentUploadDialogOpen:t}){const[,s]=T(),a=s?.trainingMedia,[i,l]=o.useState(null),[c,m]=o.useState(!1),[u,d]=o.useState(""),x=r=>{const n=r.target.files?.[0];if(d(""),!n){d("File is not selected"),l(null);return}if(n.size>U){d(`Maximum allowed file size is ${U/1048576} MB`),l(null);return}l(n)},f=async r=>{if(r.preventDefault(),!i){d("File is not selected");return}try{const{name:n}=i;a?.some(h=>h.originalName===n)?p(!0,"The file already uploaded!. Please select another file","error"):(m(!0),await P(i),t(!1),p(!0,"The file uploaded successfully!","success"))}catch(n){console.error("Error uploading the document:",n),m(!1),t(!1),p(!0,"Not able to upload the file. Try after sometime!","error")}};return e.jsx("form",{onSubmit:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File Upload (.csv, .txt, .docx, .pdf)"})}),i&&e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected File: ",e.jsx("span",{className:"font-medium",children:i.name})]})}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("label",{htmlFor:"file-input",children:[e.jsx("input",{type:"file",id:"file-input",className:"hidden",onChange:x,accept:".csv,.txt,.docx,.doc,.pdf,text/plain"}),e.jsx("span",{className:"inline-block cursor-pointer",children:e.jsx(b,{type:"primary",size:"lg",label:"Select File",onClick:r=>{r.preventDefault(),document.getElementById("file-input")?.click()}})})]}),e.jsx(b,{type:"primary",size:"lg",label:c?"Uploading...":"Upload",htmlType:"submit",disabled:c||!i,isLoading:c})]}),u&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-red-600 text-sm",children:u})})]})})}const X=t=>o.createElement("svg",{width:56,height:62,viewBox:"0 0 56 62",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M55.3249 54.7773L31.5565 17.7582C29.8922 15.1666 26.1065 15.1666 24.4419 17.7582L0.676131 54.7773C-1.12823 57.5935 0.890118 61.2893 4.23196 61.2893H51.7654C55.1099 61.2893 57.1283 57.5935 55.3239 54.7773H55.3249ZM30.1146 52.2068C30.1146 53.3745 29.1689 54.3203 28.0012 54.3203C26.8335 54.3203 25.8878 53.3745 25.8878 52.2068V51.6653C25.8878 50.4976 26.8335 49.5518 28.0012 49.5518C29.1689 49.5518 30.1146 50.4976 30.1146 51.6653V52.2068ZM30.1146 43.7667C30.1146 44.9343 29.1689 45.8801 28.0012 45.8801C26.8335 45.8801 25.8878 44.9343 25.8878 43.7667V32.9378C25.8878 31.7701 26.8335 30.8244 28.0012 30.8244C29.1689 30.8244 30.1146 31.7701 30.1146 32.9378V43.7667Z",fill:"#F8A92B"}),o.createElement("path",{d:"M28.0011 9.65832C29.1688 9.65832 30.1145 8.71259 30.1145 7.5449V2.11343C30.1145 0.945733 29.1688 0 28.0011 0C26.8334 0 25.8877 0.945733 25.8877 2.11343V7.5449C25.8877 8.71259 26.8334 9.65832 28.0011 9.65832Z",fill:"#F8A92B"}),o.createElement("path",{d:"M14.1717 13.6214C14.5838 14.0335 15.1254 14.2396 15.6669 14.2396C16.2084 14.2396 16.75 14.0335 17.1621 13.6214C17.989 12.7971 17.989 11.4604 17.1621 10.6335L13.3209 6.79236C12.494 5.96545 11.16 5.96545 10.3331 6.79236C9.50616 7.61663 9.50616 8.95333 10.3331 9.78024L14.1717 13.6214Z",fill:"#F8A92B"}),o.createElement("path",{d:"M40.3381 14.2396C40.8797 14.2396 41.4213 14.0335 41.8334 13.6214L45.6719 9.78024C46.4988 8.95333 46.4988 7.61663 45.6719 6.79236C44.845 5.96545 43.5109 5.96545 42.684 6.79236L38.8428 10.6335C38.0159 11.4604 38.0159 12.7971 38.8428 13.6214C39.255 14.0335 39.7966 14.2396 40.3381 14.2396Z",fill:"#F8A92B"}));function Y(){const[t,s]=o.useState(!1),[a,i]=o.useState(!1),[l,c]=o.useState(!1),m=()=>{s(!0)},u=()=>{i(!0)},d=[{icon:e.jsx(z,{}),name:"File Upload (.csv, .txt, .docx, .pdf)",method:u},{icon:e.jsx(O,{}),name:"Add Web Page url",method:m}];return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Training Documents",icon:l?w:W,onClick:()=>c(x=>!x)}),e.jsx(Z,{actions:d,isOpen:l,onClose:()=>c(!1)}),t&&e.jsx(se,{isOpen:t,onClose:()=>s(!1),title:"Train from website",children:e.jsx(ee,{setWebPageUrlAddDialogOpen:s})}),e.jsx(G,{isOpen:a,toggleOpen:i})]})}function Ce(){const[t,s]=o.useState(!1),[a,i]=o.useState(!1),l=v(r=>r.organizationId),c=v(r=>r.trainingMediaUpdate),[m,u]=T(),d=u?.trainingMedia,x=async()=>{i(!0);try{const r=await V(m,l),{deleted:n,totalDocs:g,supportedDocsCount:h,processedDocsCount:j,created:C,failedDocs:N}=r,y=N.length,S=y>0?y+" are failed to process":"all supported files processed successfully";i(!1),p(!0,`The bot training completed successfully! In ${g} files ${h} are supported, ${j} files processed, ${n} FAQ's deleted, ${C} FAQ's created and ${S}`,"success"),s(!1)}catch{i(!1),p(!0,"Not able to train the bot. Try after sometime!","error")}},f=async()=>{try{s(!0),await B(m,{trainingMedia:d}),v.setState(()=>({trainingMediaUpdate:!1})),p(!0,"The document names updated successfully!","success"),s(!1)}catch{s(!1),p(!0,"Not able to add document names. Try after sometime!","error")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6 relative",children:e.jsx("div",{className:"relative w-full flex justify-between items-center",children:e.jsx(Y,{})})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:e.jsx(te,{trainingMedia:d,botId:m,organizationId:l})}),e.jsx("div",{className:"flex justify-between items-center py-3 px-2",children:e.jsxs("div",{className:"ml-auto flex gap-2",children:[c&&e.jsx(b,{type:"secondary",size:"md",label:t?"Saving...":"Save Changes",onClick:f,disabled:t,isLoading:t}),e.jsx(b,{type:"secondary",size:"md",label:a?"Training...":"Train the bot",onClick:x,disabled:a,isLoading:a})]})})]})}function ee({setWebPageUrlAddDialogOpen:t}){const[,s]=T(),[a,i]=o.useState(""),[l,c]=o.useState(!1),[m,u]=o.useState(!1),[d,x]=o.useState(""),f=n=>{try{return new URL(n),!0}catch{return!1}},r=async n=>{if(n.preventDefault(),x(""),!a){x("Please enter webpage url");return}if(!f(a)){x("Enter valid url!");return}try{const{trainingMedia:g}=s;if(g.some(j=>j.url?.toLowerCase()===a?.toLowerCase()))p(!0,"This URL already available in the Training Documents!. Please add another URL","error");else{const j={url:a,useBrowser:l};u(!0),await I(j),t(!1),p(!0,"The url added successfully!","success")}}catch(g){console.error("Error adding training documents:-",g),u(!1),t(!1),p(!0,"Not able to add the url. Try after sometime!","error")}};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{label:"Webpage Url",type:"text",value:a,onChange:n=>i(n.target.value),placeholder:"https://www.yourwebsite.com/product-info"}),d&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"More options"}),e.jsx($,{label:"My page needs script to generate content / My page has issues with training",checked:l,onChange:n=>c(n)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{type:"primary",size:"md",label:m?"Adding...":"Add",htmlType:"submit",disabled:m,isLoading:m})})]})}function te({trainingMedia:t,botId:s,organizationId:a}){return e.jsxs(e.Fragment,{children:[t&&t.length===0&&e.jsx("div",{className:"col-span-full",children:e.jsxs("div",{className:"text-red-600 flex flex-col items-center justify-center py-8",children:[e.jsx(X,{className:"w-10 h-10 mb-2"}),e.jsx("p",{className:"text-sm",children:"Training Documents are not uploaded!"})]})}),t&&t.map((i,l)=>e.jsx(Q,{media:i,botId:s,organizationId:a},l))]})}function se({isOpen:t,onClose:s,title:a,children:i}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6 z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:a}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(w,{className:"w-6 h-6"})})]}),i]})]}):null}export{Ce as default};
