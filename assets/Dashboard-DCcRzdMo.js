import{f as _,j as r,b as j,e as N,R as f,r as F}from"./index-DNgbtrVq.js";import{t as V,c as S,s as h,g as p,d as z,b as k,f as L}from"./ajax-CVEl0eD2.js";import"./Button-C3bz2KtR.js";/* empty css                */import{T as R}from"./Table-BEPKmifY.js";import{S as Y}from"./download-CFABwSyr.js";import{B as U}from"./Button-CMcgYNbm.js";import{S as y}from"./SelectButton-Bo6x3q5L.js";import{P as W}from"./PageHeader-DbRe1Bzf.js";import"./SelectBox-CkRYZ70U.js";import"./LabelWrapper-DVnEPT7l.js";import"./organization-4PXNM00t.js";import"./useSelectedBot-CzDcn7AF.js";function C(e,t,s){const a=V(e,s==null?void 0:s.in);return isNaN(t)?S(e,NaN):(t&&a.setDate(a.getDate()+t),a)}function T(e,t,s){const a=V(e,s==null?void 0:s.in);if(isNaN(t))return S(e,NaN);const o=a.getDate(),i=S(e,a.getTime());i.setMonth(a.getMonth()+t+1,0);const n=i.getDate();return o>=n?i:(a.setFullYear(i.getFullYear(),i.getMonth(),o),a)}function Z(e,t,s){return C(e,t*7,s)}function b(e,t){const s=V(e,t==null?void 0:t.in);return s.setHours(23,59,59,999),s}const d=_(()=>G());function G(e,t){const s=b(new Date);return{fromDate:h(T(s,-1)),toDate:s,organizationId:e,botId:t}}function q(){const e=d(s=>s.overview);if(!e)return;const t=r.jsx("div",{className:"w-[1px] bg-[#DCDCDC] my-auto h-20"});return r.jsxs("div",{className:"flex justify-between bg-white w-full rounded-md py-3 px-5 shadow-[0px_1px_4px_0px_#5653534D]",children:[r.jsx(g,{title:"Interactive Visitors",count:e.current.interactiveVisitors,diff:e.difference.interactiveVisitors,color:"#5FC303"}),t,r.jsx(g,{title:"Visitor Count",count:e.current.totalVisitors,diff:e.difference.totalVisitors,color:"#F9932D"}),t,r.jsx(g,{title:"Presale",count:e.current.preSale,diff:e.difference.preSale,color:"#DB6767"}),t,r.jsx(g,{title:"General",count:e.current.general,diff:e.difference.general,color:"#AC7BC4"}),t,r.jsx(g,{title:"Others",count:e.current.others,diff:e.difference.others,color:"#2187AD"})]})}function g({count:e,title:t,diff:s=0,color:a}){return r.jsxs("div",{className:"flex flex-col justify-around text-center w-[175px]",children:[r.jsx("span",{className:"text-[33px] leading-10",style:{color:a},children:e||0}),r.jsx("span",{className:"text-lg",children:t}),s<0&&r.jsxs("span",{className:"capitalize text-[9px] font-semibold",children:["You lost ",r.jsx("span",{style:{color:a},children:Math.abs(s)})," this time"]}),s>=0&&r.jsxs("span",{className:"capitalize text-[9px] font-semibold",children:["You made an extra ",r.jsx("span",{style:{color:a},children:s||0})," this time"]})]})}async function J(){const{organizationId:e}=j.getState(),{selectedBotId:t}=N.getState(),s=d.getState(),{organizationId:a,botId:o}=s;let{fromDate:i,toDate:n}=s;i=h(i),n=b(n),e===a&&t===o||d.setState(G(e,t),!0);const u=await p(`/analytics/${e}/${t}/dashboard/overview`,{fromDate:i,toDate:n}),v=Q(i,n);i=v.start,n=v.end;const l=await p(`/analytics/${e}/${t}/dashboard/overview`,{fromDate:i,toDate:n}),m={totalVisitors:(u.totalVisitors||0)-(l.totalVisitors||0),interactiveVisitors:(u.interactiveVisitors||0)-(l.interactiveVisitors||0),preSale:(u.preSale||0)-(l.preSale||0),general:(u.general||0)-(l.general||0),others:(u.others||0)-(l.others||0),revisit:(u.revisit||0)-(l.revisit||0)},D={interactiveVisitors:x(l.interactiveVisitors,m.interactiveVisitors),preSale:x(l.preSale,m.preSale),general:x(l.general,m.general),others:x(l.others,m.others),revisit:x(l.revisit,m.revisit)},c={current:u,previous:l,difference:m,diffPercentage:D};d.setState({overview:c})}async function M(e){const{organizationId:t}=j.getState(),{selectedBotId:s}=N.getState(),a=d.getState();let{visitorProps:o}=a;o={page:1,count:10,...o,...e},d.setState({visitorProps:o,visitorList:null,visitorsListTotal:0});const{total:i,visitorList:n}=await p(`/analytics/${t}/${s}/dashboard/visitors-list`,o);d.setState({visitorsListTotal:i,visitorList:n})}async function K(e){const{organizationId:t}=j.getState(),{selectedBotId:s}=N.getState(),{fromDate:a,toDate:o}=d.getState();d.setState({visitorGroupedList:null});const i=await p(`/analytics/${t}/${s}/dashboard/grouped/${e}`,{fromDate:a,toDate:o});d.setState({visitorGroupedList:i})}function Q(e,t){const s=z(t,e),a=C(e,-1),o=C(a,-s);return{start:h(o),end:b(a)}}function x(e,t){return!t||!e?0:parseFloat((t*100/e).toFixed(2))}const X=[{title:"Group",field:"group",sortable:!0},{title:"Visitor Count",field:"total",sortable:!0,hideBelow:"md"},{title:"Interactions",field:"totalInteractions",sortable:!0,hideBelow:"xs"},{title:"Pre-Sale",field:"preSale",sortable:!0},{title:"General",field:"general",sortable:!0},{title:"Others",field:"others",sortable:!0,hideBelow:"sm"}];function ee({group:e}){const t=f.useMemo(()=>X.map((o,i)=>({...o,title:i?o.title:e.label})),[e]),s=d(o=>o.visitorGroupedList)||[],a=d(o=>o.visitorsGroupedListTotal)||0;return f.useEffect(()=>{e&&K(e.value).catch(o=>console.log("Error loading visitor grouped list:-",o))},[e]),r.jsx(R,{columns:t,rows:s,totalRows:a})}const I=[{title:"Name",field:"name",sortable:!0},{title:"Email Id",field:"email",sortable:!0,hideBelow:"md"},{title:"Phone Number",field:"phoneNumber",sortable:!1},{title:"Country",field:"country",sortable:!0,hideBelow:"xl"},{title:"City",field:"city",sortable:!0,hideBelow:"lg"},{title:"Visit Time",field:"visitTime",sortable:!0,hideBelow:"xl",template:e=>k(e.visitTime)},{title:"Category",field:"category",sortable:!0,hideBelow:"lg"},{title:"Transcript",field:"transcriptUrl",sortable:!1,cellClassName:"text-center",headerClassName:"text-center",template:e=>r.jsx("a",{href:e.transcriptUrl,target:"_blank",rel:"noreferrer noopener",className:"text-xs border rounded px-3 py-1 text-center font-bold text-[#1F87AF] border-[#1E8EB9] bg-[#F6FDFF]",children:"View"})}];function te({dateRangeType:e}){const{visitorList:t,visitorsListTotal:s,fromDate:a,toDate:o,visitorProps:i}=d(),n=f.useMemo(()=>{const c=b(new Date);switch(e){case"today":return{fromDate:h(c),toDate:c};case"week":return{fromDate:h(Z(c,-1)),toDate:c};case"month":return{fromDate:h(T(c,-1)),toDate:c};default:return{fromDate:a,toDate:o}}},[e,a,o]),{count:B,page:u,orderBy:v,order:l}=i||{},m=f.useMemo(()=>I.find(c=>c.field===v),[v]);f.useEffect(()=>{n&&M(n).catch(c=>console.log("Error loading visitor list:-",c))},[n]);const D=c=>{const{pageNumber:H,count:$,sortAsc:O,sortColumn:w}=c;M({page:H,count:$,orderBy:w==null?void 0:w.field,order:O!==!1?"asc":"desc"})};return r.jsx(R,{columns:I,sortColumn:m,sortAsc:l==="asc",page:u,rowsPerPage:B,rows:t||[],totalRows:s||0,onChange:D,noRowsMessage:"No visitors found for selected period"})}const E=[{value:"country",label:"Country"},{value:"city",label:"City"},{value:"os",label:"OS Name"},{value:"browser",label:"Browser"},{value:"date",label:"Date"},{value:"landing_page",label:"Landing Page"}],P=[{value:1,label:"Visitor List"},{value:0,label:"Analytics"}],A=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"custom",label:"Custom"}];function se(){const[e,t]=f.useState(P[0]),[s,a]=f.useState(E[0]),[o,i]=f.useState();return r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between py-4",children:[r.jsxs("div",{className:"pt-2",children:[!(e!=null&&e.value)&&r.jsxs("span",{className:"text-sm font-semibold",children:["Analytics - ",s.label," Wise"]}),!!(e!=null&&e.value)&&r.jsx("span",{className:"text-sm font-semibold",children:"Visitor List"}),r.jsx(y,{value:e,onChange:t,items:P,iconOnly:!0,className:"bg-primary pt-0 ps-0 pb-0 pr-0 text-white ms-2 align-middle"})]}),r.jsxs("div",{children:[r.jsx(U,{icon:r.jsx(Y,{}),size:"sm",type:"secondary",className:"mr-2 align-middle"}),!!(e!=null&&e.value)&&r.jsx(y,{value:o||A[0],items:A,className:"bg-[#323131] text-white",onChange:i}),!(e!=null&&e.value)&&r.jsx(y,{value:s,items:E,prefix:"Group by:",onChange:a,className:"bg-[#323131] text-white align-middle"})]})]}),!(e!=null&&e.value)&&r.jsx(ee,{group:s}),!!(e!=null&&e.value)&&r.jsx(te,{dateRangeType:o==null?void 0:o.value})]})}const re=e=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},F.createElement("path",{d:"M9 16.5C8.3 16.5 7.70833 16.2583 7.225 15.775C6.74167 15.2917 6.5 14.7 6.5 14C6.5 13.3 6.74167 12.7083 7.225 12.225C7.70833 11.7417 8.3 11.5 9 11.5C9.7 11.5 10.2917 11.7417 10.775 12.225C11.2583 12.7083 11.5 13.3 11.5 14C11.5 14.7 11.2583 15.2917 10.775 15.775C10.2917 16.2583 9.7 16.5 9 16.5ZM5 22C4.45 22 3.97917 21.8042 3.5875 21.4125C3.19583 21.0208 3 20.55 3 20V6C3 5.45 3.19583 4.97917 3.5875 4.5875C3.97917 4.19583 4.45 4 5 4H6V2H8V4H16V2H18V4H19C19.55 4 20.0208 4.19583 20.4125 4.5875C20.8042 4.97917 21 5.45 21 6V20C21 20.55 20.8042 21.0208 20.4125 21.4125C20.0208 21.8042 19.55 22 19 22H5ZM5 20H19V10H5V20Z",fill:"#FEF7FF"}));function xe(){const e=d();return f.useEffect(()=>{J().catch(t=>console.error("Unable to load analytics data",t))},[]),r.jsxs("div",{children:[r.jsx(W,{title:"Dashboard",icon:re}),r.jsxs("div",{className:"font-primary text-xs py-3 text-[#695656] font-medium",children:["Search Result: ",L(e.fromDate),"-",L(e.toDate)]}),r.jsx(q,{}),r.jsx(se,{})]})}export{xe as default};
