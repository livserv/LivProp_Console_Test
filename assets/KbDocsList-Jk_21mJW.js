import{b as d,e as S,R as q,f as R,r as u,j as e}from"./index-BjyquQqj.js";import{c as N}from"./Button-6bMBa1_B.js";import{S as z}from"./delete-BGuu1s6X.js";import{S as F}from"./edit-CCuXvpOl.js";import{S as K}from"./plus-DjIalJJv.js";import{g as C,r as G,p as O,e as T}from"./ajax-O4xclg-c.js";import{B as g}from"./Button-xWVoz13c.js";import{S as M}from"./TextBox-CU_W52Of.js";import{s as y,h as v}from"./utils-B3TvvZ68.js";import{P as V}from"./PageHeader-Bs-rHxpU.js";import{u as W}from"./useSelectedBot-CLgcYbP9.js";import{S as H}from"./send-7nrGp45X.js";import{F as Q,b as U,d as J}from"./index-CwwbquBK.js";async function pe(o){const{selectedBotId:i}=S.getState(),{organizationId:t,kbDocs:s}=d.getState(),n=await C(`/bot/${t}/${i}/knowledge-base/list`);d.setState(a=>({kbDocs:{...a.kbDocs||{},[String(i)]:n}}))}async function X(o){const{organizationId:i,selectedBotId:t}=d.getState(),s=await O(`/bot/${i}/${t}/knowledge-base`,o);return d.setState(n=>{const a={...n.kbDocs||{}},c=a[t];if(!c)return{};if(a[t]=[...c],o._id){const l=a[t].findIndex(m=>m._id===s._id);l>=0?a[t][l]=s:a[t].push(s)}else a[t].push(s);return{kbDocs:a}}),s}async function Y(o){const{organizationId:i,selectedBotId:t}=d.getState();await G(`/bot/${i}/${t}/knowledge-base/${o}`,o),d.setState(s=>{var a;const n={...s.kbDocs||{}};return n[t]=(a=n[t])==null?void 0:a.filter(c=>c._id!==o),{kbDocs:n}})}async function ge(o){if(!(o!=null&&o.length))return[];const{organizationId:i}=d.getState(),{selectedBotId:t}=S.getState();return await C(`/bot/${i}/${t}/knowledge-base/list?${o.map(s=>`docIds=${s}`).join("&")}`)}const f=R(()=>({page:1,rowsPerPage:10,totalDocs:0,docsList:[],isLoading:!1}));function Z(){const o=d(n=>n.organizationId),[i]=W();q.useEffect(()=>{P()},[i,o]);const t=f(n=>n.docsList),s=f(n=>n.isLoading);return[t,s]}async function P(o=1,i=10){const{organizationId:t}=d.getState(),{selectedBotId:s}=S.getState();if(!t||!s)return;const{botId:n}=f.getState(),a={page:o,rowsPerPage:i,isLoading:!0};n!==s&&(a.docsList=[]),f.setState(a);const c=await T.get(`/bot/${t}/${s}/knowledge-base/list`);f.setState({botId:s,docsList:c,totalDocs:c.length,isLoading:!1})}function k({onDone:o,initial:i}){const[t,s]=u.useState(i||{question:"",content:""}),n=(c,l)=>{s(m=>({...m,[c]:l}))},a=async()=>{await X(t),o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(Q,{value:t,onChange:s,children:[e.jsx(U,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:c=>n("question",c)}),e.jsx(J,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:c=>n("content",c)})]}),e.jsx("div",{className:"text-center",children:e.jsx(g,{icon:e.jsx(H,{}),size:"lg",type:"rounded",onClick:a,className:"bg-[#49d4a1]"})})]})}function ee(o){const{activeIndex:i,onNavigate:t=()=>{},docsList:s}=o,[n,a]=Z(),c=s??n,[l,m]=u.useState(10),[h,b]=u.useState(1),[D]=u.useState(""),L=[10,15,20,25],j=(c||[]).filter(r=>{var x;return!D||((x=r.question)==null?void 0:x.toLowerCase().includes(D.toLowerCase()))}),p=Math.ceil(j.length/l),w=(h-1)*l,B=w+l,I=j.slice(w,B),$=()=>v(),A=()=>y(e.jsx(k,{onDone:$}),{showCloseButton:!0,width:"700px"});u.useEffect(()=>{h>p&&b(1)},[j.length,p,h]);const E=r=>{const x=typeof r=="string"?parseInt(r,10):r;typeof x=="number"&&!isNaN(x)&&(m(x),b(1))},_=r=>{r<1||r>p||b(r)};return e.jsxs(e.Fragment,{children:[!s&&!i&&e.jsx("div",{className:"mb-4",children:e.jsx(V,{title:"Chat Bot Knowledge",icon:K,search:!0,onClick:A})}),e.jsxs("div",{className:N("w-full border border-mildGreyBGAlt rounded max-h-screen bg-white",{"opacity-50":a}),children:[I.map((r,x)=>e.jsx(te,{doc:r,index:w+x},r._id)),!s&&e.jsx("div",{className:"w-full flex flex-row px-4 py-3 gap-8 border-y-gray-100 bg-white",children:e.jsx(se,{count:l,counts:L,currentPage:h,totalPages:p,onChangeCount:E,goToPage:_})})]}),i&&!s&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(g,{label:"GENERATE",onClick:()=>t(i+1)})})]})}function te({doc:o,index:i}){const t=()=>{y(e.jsx(k,{onDone:v,initial:{question:o.question||"",content:o.content||""}}),{showCloseButton:!0,width:"700px"})},s=async n=>{console.log("Deleting document with ID:",n),await Y(n)};return e.jsxs("div",{className:N("w-full flex flex-row px-4 py-3 gap-8 border-y-gray-100",{"bg-white":i%2!==0,"bg-[#f7f7f7]":i%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!o.question&&e.jsx("span",{className:"font-normal text-md",children:o.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:o.content}),!!o.sourceDocument&&e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),e.jsx("a",{href:o.sourceDocument,target:"_blank",children:o.sourceDocument})]})]}),e.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[e.jsx(g,{icon:e.jsx(z,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>s(o._id)}),e.jsx(g,{icon:e.jsx(F,{height:24,width:24}),type:"plain",className:"me-8",onClick:t})]})]})}const se=({count:o,counts:i,currentPage:t,totalPages:s,onChangeCount:n,goToPage:a})=>{const c=i.map(l=>({label:l,value:l}));return e.jsxs("div",{className:"w-full p-4 rounded-lg shadow-lg flex items-center justify-between px-4 py-2 border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 min-w-max",children:"Rows per page"}),e.jsx(M,{className:"border border-gray-300 rounded px-2 py-1",value:o,options:c,showClear:!1,onChange:l=>n(l)})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(1),disabled:t===1,children:"«"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(t-1),disabled:t===1,children:"‹"}),e.jsxs("span",{className:"px-2 text-sm font-medium",children:[t," of ",s||1]}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(t+1),disabled:t>=s||!s,children:"›"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>a(s),disabled:t>=s||!s,children:"»"})]})]})},be=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as K,ge as a,be as b,pe as g};
