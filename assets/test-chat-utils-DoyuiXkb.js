import{R as a,j as i,r as yt}from"./index-D9EAXeej.js";import{K as et,J as nt,L as H,M as xt,N as vt,a as Ct,Q as It,C as St}from"./index-C2Z25x6i.js";import{g as rt,p as jt,R as Lt}from"./ajax-wCsmuh_l.js";import{r as Bt}from"./env-CBDBHzQq.js";import{a as P}from"./svg-icons-BHnUf74W.js";let B=null;function Mt(t){t.origin||(t.origin=null),t.botId||(t.botId=null);try{const{origin:n,botId:r}=t;B=new BroadcastChannel("lp_web_chat");const e=Tt(t);return B.addEventListener("message",e),B.postMessage({action:"GetConversationId",origin:n,botId:r}),()=>{B&&(B.removeEventListener("message",e),B.close(),B=null)}}catch(n){console.error("Unable to start session sharing:",n)}}function Tt({onHistoryChange:t,getHistory:n,origin:r=null,botId:e=null}){return c=>{const l=c.data||{};if(!(l.origin!==r||l.botId!==e))try{if(l.action==="GetConversationId"){const u=n();z(u,r,e)}else if(l.action==="SetConversationId"){const{conversationId:u,history:p}=l;u?et(u||void 0):nt(),p&&(t==null||t(p))}}catch(u){console.log("Error occurred when trying to handle session sharing:",u)}}}function z(t,n,r,e){if(B)try{const c=H()||"";if(!e&&!c)return;B.postMessage({action:"SetConversationId",origin:n,botId:r,conversationId:c,history:t})}catch(c){console.error("Error sharing session:",c)}}function O(){return{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}}function kt(t,n,r){var m;const{updateContact:e,onReceiveChatResponse:c,bot:l,locationDetails:u,onCallback:p,recipientId:f,history:b,chatFlowId:y,preferredLanguage:w}=n,{flowId:v,flowType:d}=((m=b==null?void 0:b[b.length-1])==null?void 0:m.media)||{};return typeof t=="string"&&v&&(t={method:"flow-response",type:d,flowId:v,answer:t}),(t==null?void 0:t.type)==="customForm"&&(t!=null&&t.answer)&&(t={method:"flow-response",type:d,flowId:v,answer:t.answer}),r?Dt(t,l,{onReceiveChatResponse:c,updateContact:e,onCallback:p,recipientId:f,chatFlowId:y,language:w},u):Et(t,l,{onReceiveChatResponse:c,updateContact:e,onCallback:p,recipientId:f,chatFlowId:y,language:w},u)}async function Et(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:c,recipientId:l,chatFlowId:u,language:p},f){const b=H(),{_id:y,organizationId:w,botSettings:v}=n,d={userQuery:t,recipientDetails:{recipientId:l,conversationId:b,language:p,...f},chatFlowId:u};r&&(d.testMode=!0);try{const m=await jt(`/bot/${w}/${y}/chat`,d,{noAuth:!0});return r==null||r(m),ot(m,{updateContact:e,botSettings:v,onCallback:c})}catch(m){return[{role:"assistant",type:"text",content:m.message||"Unknown Server error"}]}}async function Dt(t,n,{onReceiveChatResponse:r,updateContact:e,onCallback:c,recipientId:l,chatFlowId:u,language:p},f){const b=H(),{_id:y,organizationId:w,botSettings:v}=n,d={userQuery:t,recipientDetails:{recipientId:l,conversationId:b,language:p,...f},chatFlowId:u};r&&(d.testMode=!0);try{const C=await(await fetch(`${Bt}voicebot/voiceChat?organizationId=${w}&botId=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json();return r==null||r(C.data),{data:ot(C.data,{updateContact:e,botSettings:v,onCallback:c}),audioUri:C.data.audioUri}}catch(m){return console.log(m,"error"),[{role:"assistant",type:"text",content:m.message||"Unknown Server error"}]}}function ot(t,{updateContact:n,botSettings:r,onCallback:e}){const{chatRefId:c,recipientId:l,messages:u}=t;return et(c),e==null||e("set-visitor-id",{recipientId:l}),k(u,{updateContact:n,botSettings:r})}function k(t,{updateContact:n,botSettings:r}){if(!(t!=null&&t.length))return t;const e=t[t.length-1];return e.type==="form"&&t.push({role:"user",type:"lead",content:"",profile:e.media,updateContact:n,botSettings:r}),e.type==="customForm"&&(e.role==="assistant"&&(e.role="user"),Object.assign(e,{type:"customForm",content:"",media:e.media,updateContact:n,botSettings:r})),t}async function Nt(t){try{const n=new URLSearchParams(window.location.search),r=n.get("token"),e=n.get("sourceUrl"),c={authToken:r,recipientId:t,sourceUrl:e},{startupFlow:l,hideChatWindow:u,googleTagManagerId:p,...f}=await rt("/bot/get-bot-details-by-auth-token",c,{noAuth:!0});return{startupFlow:l,hideChatWindow:u,googleTagManagerId:p,bot:f}}catch(n){console.log("Failed to init chat:-",n)}}async function q(t,n,r,{autoLaunch:e,startupMessages:c}){const{_id:l,organizationId:u,botSettings:p={}}=t,f=H();if(!n||!f)return e?c||[O()]:[];try{const b=await rt(`/bot/${u}/${l}/chat/history/${n}/${f}`,null,{noAuth:!0}),{messages:y}=b||{};return k(y,{updateContact:r,botSettings:p})}catch(b){console.error("Failed to fetch chat history:-",b)}return e?[O()]:[]}function Ft({text:t="We are Online!",onHide:n,design:r,isLeft:e}){const c=$t(r,e),[l,u]=a.useState(!0),p=a.useCallback(f=>{f.preventDefault(),f.stopPropagation(),u(!1),n==null||n()},[n]);return l?i.jsxs("div",{className:"button-tooltip",style:c,children:[i.jsxs("div",{children:[i.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"}),i.jsx("b",{children:t}),i.jsx("br",{})]}),i.jsx("a",{className:"close-indicator",onClick:p,children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M1490 1245q0 40-24 68l-136 136q-24 24-68 24t-68-28l-294-294-294 294q-24 24-68 24t-68-28l-136-136q-24-24-24-68t24-68l294-294-294-294q-24-24-24-68t24-68l136-136q24-24 68-24t68 28l294 294 294-294q24-24 68-28t68 28l136 136q28 24 24 68t-24 68l-294 294 294 294q24 24 24 68z",fill:"#fff"})})})]}):null}function $t(t,n){let{spacingCorner:r,spacingBottom:e}=(t==null?void 0:t.launcher)||{};if(r=parseFloat(r)||void 0,e=parseFloat(e)||void 0,r&&(r+=5),e&&(e+=75),r||e)return{bottom:e,[n?"left":"right"]:r}}function At({isLeft:t,bgColor:n,secBgColor:r,imageUrl:e,chatIcon:c,barText:l="Live Chat",fontSize:u,color:p,autoAnimate:f=!0,style:b,onClick:y}){const w=t?"bottom-left":"bottom-right",v={backgroundColor:n},d={backgroundImage:`linear-gradient(90deg, ${n}, ${r})`},m=a.useRef(null);return a.useEffect(()=>{if(f){const C=setInterval(()=>{var S;(S=m.current)==null||S.classList.remove("bar-hide"),setTimeout(()=>{var j;return(j=m.current)==null?void 0:j.classList.add("bar-hide")},7e3)},35e3);return()=>clearInterval(C)}},[f]),i.jsxs("div",{className:`lp-launcher expand-button ${w}`,onClick:y,style:b,children:[i.jsx("div",{ref:m,className:"text-container bar-hide",style:d,children:i.jsx("div",{className:"bar-text",style:{minWidth:"150px",fontSize:u,color:p},children:i.jsxs("p",{children:["Hi there,"," ",i.jsx("img",{draggable:!1,className:"chat-hand",alt:"ðŸ‘‹",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"})," ","We are online!"]})})}),i.jsx("div",{className:"image-container",style:v,children:i.jsxs("div",{className:"image-sub-container",children:[e&&i.jsx("img",{src:e,alt:l}),!e&&c]})})]})}function Ht({design:t,onToggle:n}){const{launcher:{launcherType:r,buttonLogoUrl:e,buttonOnMobile:c,barText:l,fontSize:u,spacingCorner:p,spacingBottom:f,showMinimizeButtonToolTip:b=!0}={},header:{bgColor:y,secBgColor:w,fontColor:v}={},window:{fontFamily:d,align:m}={}}=t||{},C=m==="bottomLeft",S={bottom:f,[C?"left":"right"]:p};return r==="icon"||c?i.jsxs("div",{id:"lp-launcher",className:"lp-launcher button"+(e?"":" bordered"),onClick:n,style:{borderColor:y,color:v,background:e?"transparent":"linear-gradient(to right,"+y+", "+w+")",verticalAlign:"middle",padding:e?void 0:"16px",display:"flex",...S},children:[b&&i.jsx(Ft,{design:t,isLeft:C}),e&&i.jsx("img",{src:e,alt:"Live Chat"}),!e&&P]}):r==="expand"?i.jsx(At,{isLeft:C,color:v,style:S,bgColor:y,secBgColor:w,imageUrl:e,chatIcon:P,barText:l,fontSize:u,onClick:n}):i.jsxs("div",{id:"lp-launcher",className:"lp-launcher bar",onClick:n,style:{background:"linear-gradient(to right, "+y+", "+w+")",color:v,fontFamily:d,...S},children:[e&&i.jsx("img",{src:e,alt:l}),!e&&P,i.jsx("span",{children:l||"Live Chat"})]})}function Ut({googleTagManagerId:t}){return yt.useEffect(()=>{if(!t||document.querySelector(`script[data-gtm="${t}"]`))return;if(window.dataLayer&&document.querySelector('script[src*="gtm.js"]')){console.log("GTM already loaded by server");return}const n=document.createElement("script");n.innerHTML=`
            (function(w,d,s,l,i){
                w[l]=w[l]||[];
                w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
                var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
                j.async=true;
                j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
                f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','${t}');
        `,document.head.appendChild(n);const r=document.createElement("noscript");return r.innerHTML=`
          <iframe src="https://www.googletagmanager.com/ns.html?id=${t}"
            height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe>
        `,document.body.insertBefore(r,document.body.firstChild),()=>{document.head.removeChild(n),document.body.removeChild(r)}},[t]),null}function _t({design:t}){const n=t==null?void 0:t.remoteFontLink;return n?Lt.createPortal(i.jsx("link",{rel:"stylesheet",href:n}),document.head,"remoteFont"):null}const Gt={window:{spacingCorner:"0px",spacingBottom:"7px"},launcher:{spacingCorner:"0px",spacingBottom:"7px"}},tt=["lead","options","customForm","stop"];function Jt(t){var Y,Z;const{botDetails:n,botDesign:r,startupFlow:e,onReceiveChatResponse:c,autoLaunch:l,recipientId:u,origin:p,onCallback:f,optionsRenderer:b,fullscreen:y}=t,[w,v]=a.useState(l||!1),[d,m]=a.useState(r),[C,S]=a.useState(!1),[j,Q]=a.useState(n),[U,R]=a.useState(e),[at,_]=a.useState(e==null?void 0:e.messages),[it,ct]=a.useState(u),[E,G]=a.useState([]),[J,lt]=a.useState(),[K,V]=a.useState(),[dt,ut]=a.useState(null),o=a.useRef({autoLaunch:l});if(y)try{const s=window.innerWidth+"px",g=window.innerHeight+"px";d.window.width=s,d.window.height=g,d.window.spacingBottom="0px",d.window.spacingCorner="0px",d.launcher.spacingBottom="0px",d.launcher.spacingCorner="0px"}catch(s){console.error("Error setting fullscreen design:",s)}o.current.recipientId=it,o.current.bot=j,o.current.chatFlowId=U==null?void 0:U.flowId,o.current.startupMessages=at,o.current.origin=p,o.current.preferredLanguage=K;const gt=a.useCallback(s=>{xt(s),V(s)},[]);o.current.setAndBroadcastHistory=a.useCallback(s=>{var g;typeof s=="function"?G(h=>{var x;const I=s(h);return z(I,o.current.origin,(x=o.current.bot)==null?void 0:x._id,!0),I}):(G(s),z(s,o.current.origin,(g=o.current.bot)==null?void 0:g._id,!0))},[]),o.current.onCallback=a.useCallback((s,g)=>{s==="set-visitor-id"&&g.recipientId&&ct(g.recipientId),f==null||f(s,g)},[f]),o.current.history=E,o.current.showBot=w,o.current.design=d,o.current.locationDetails=J,o.current.onReceiveChatResponse=c,o.current.isLoadedInConsole=!!c,a.useEffect(()=>{Q(n)},[n]),a.useEffect(()=>{var h;const{updateContact:s,bot:g}=o.current;R(e),(h=e==null?void 0:e.messages)!=null&&h.length?_(k([...e.messages],{updateContact:s,botSettings:g.botSettings})):_(!1)},[e]),a.useEffect(()=>{if(j&&!o.current.isLoadedInConsole)return Mt({botId:j._id,origin:o.current.origin,onHistoryChange:s=>{var g;!(s!=null&&s.length)&&!((g=o.current.history)!=null&&g.length)||G(s)},getHistory:()=>o.current.history})},[j]),a.useEffect(()=>{m(r)},[r]),a.useEffect(()=>{V(vt());const{updateContact:s,bot:g,recipientId:h,autoLaunch:I,setAndBroadcastHistory:x,startupMessages:A}=o.current;g?q(g,h,s,{autoLaunch:I,startupMessages:k(A,{updateContact:s,botSettings:g.botSettings})}).then(x):Nt(h).then(D=>{if(!D)return;const{bot:L,startupFlow:M,googleTagManagerId:pt,hideChatWindow:mt}=D;if(mt)try{window.top&&window.top!==window.self&&window.top.postMessage({lsMessage:"hide_ls_window"},"*")}catch(N){console.error("Error hiding chat window:",N.message||N)}else{ut(pt),Q(L),R(M);const N=k(M==null?void 0:M.messages,{updateContact:s,botSettings:L.botSettings});_(N);const{design:wt,isLoadedInConsole:bt}=o.current;!wt&&L.botDesign&&m(Ct(L.botDesign,bt?void 0:Gt)),q(L,h,s,{autoLaunch:I,startupMessages:k(N,{updateContact:s,botSettings:L.botSettings})}).then(x)}}),It().then(lt)},[]);const F=a.useCallback((s,g)=>{var A,D,L,M;const{design:h,onCallback:I}=o.current;let{showBot:x}=o.current;x=s?!x:x,I==null||I("windowToggle",{state:x,design:x?{width:(A=h==null?void 0:h.window)==null?void 0:A.width,height:(D=h==null?void 0:h.window)==null?void 0:D.height,spacingBottom:(L=h==null?void 0:h.window)==null?void 0:L.spacingBottom,spacingCorner:(M=h==null?void 0:h.window)==null?void 0:M.spacingCorner}:g})},[]),$=a.useCallback(async s=>{var g;(g=o.current.history)!=null&&g.length||setTimeout(()=>{var I;if((I=o.current.startupMessages)!=null&&I.length){o.current.setAndBroadcastHistory(x=>x.concat(...o.current.startupMessages));return}const h=O();o.current.setAndBroadcastHistory(x=>x?x.concat(h):[h])},s||1700)},[]),X=a.useCallback(()=>{F(!0),v(s=>!s),S(!0),setTimeout(()=>S(!1),1e3),$()},[F,$]);a.useLayoutEffect(()=>{d&&F(!1,!0)},[d,F]);const W=a.useCallback(async(s,g=!1)=>kt(s,o.current,g),[]);o.current.updateContact=a.useCallback(async s=>{const g=await W(s);o.current.setAndBroadcastHistory(h=>h.filter(I=>!tt.includes(I.type)).concat(...Array.isArray(g)?g:[]))},[W]);const ht=a.useCallback(()=>{o.current.setAndBroadcastHistory([]),nt(),delete o.current.history,$(700)},[$]);if(!j||!J)return null;let T="hide-chat";w&&C?T="opening":w&&!C?T="show-chat":!w&&C&&(T="closing"),T+=((Y=d==null?void 0:d.window)==null?void 0:Y.align)==="bottomLeft"?" bottom-left ":" bottom-right ",c&&(T+=" test-console");const ft=E&&tt.includes((Z=E[E.length-1])==null?void 0:Z.type);return i.jsxs(i.Fragment,{children:[i.jsx(_t,{design:d}),i.jsx(Ut,{googleTagManagerId:dt}),i.jsxs("div",{className:"chat-handler "+T,children:[w&&!!j&&i.jsx(St,{botDesign:d,messages:E,showTime:!0,displayComponents:void 0,onUserMessage:W,disabledMessage:ft,onHistoryChange:o.current.setAndBroadcastHistory,onClear:ht,onHide:X,onCallback:o.current.onCallback,optionsRenderer:b,language:K,setLanguage:gt,fullscreen:y}),!w&&!C&&i.jsx(Ht,{design:d,onToggle:X})]})]})}const st="lp-vid";function Kt(t,n){if(t==="set-visitor-id"){const{recipientId:r}=n||{};r&&Wt(r)}}function Vt(){try{return localStorage.getItem(st)||void 0}catch(t){console.error("Unable to use browser cache",t)}}function Wt(t){try{localStorage.setItem(st,t)}catch(n){console.error("Unable to use browser cache",n)}}export{Jt as C,Vt as g,Kt as h};
