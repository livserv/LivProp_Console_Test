import{j as e,h as ue,i as fe,r as V,e as xe,b as Q,R as be}from"./index-DeVpdhnv.js";import{F as H,b as he}from"./formik.esm-Dqna8pR8.js";import{c as E,a as I,b as oe,d as Z,e as ye,f as Ce}from"./index.esm-p1b_i3Ga.js";import{a as g,P as ve}from"./ProgressButton-BQFNqtPR.js";import{B as j}from"./Button-DvaykwvA.js";import"./Button-BslcF3aF.js";import{w as Y,k as Ne}from"./ajax-DrXfQpOo.js";import{T}from"./TextBox-CMKgC3bd.js";import{a as ge,b as re,d as ke,g as je}from"./integrations-DxqqUdm1.js";import{w as se}from"./env-Zr-tPH8F.js";import{s as L}from"./utils-B3TvvZ68.js";import{C as z,S as we}from"./ConfirmDialog-BCg_rhnN.js";import{u as Te}from"./organization-CuO61pH4.js";import{u as Ue}from"./index-BnTRCg5W.js";import{S as Se}from"./cancel-Ch5890WF.js";import{S as Pe}from"./plus-CNTV0Fi0.js";import{S as O}from"./whatsapp-BrNyigoC.js";import{u as De}from"./useSelectedBot-CPbnCiBW.js";import{P as Ie}from"./PageHeader-tDDyzOQO.js";import"./hoist-non-react-statics.cjs-CCwJLIVg.js";import"./LabelWrapper-DsqNXTsv.js";import"./moment-C5S46NFB.js";import"./SelectBox-BgXl1Ze1.js";function ne({botId:t,organizationId:l,setPopUpDialog:y}){const o=async(p,{setErrors:x,setStatus:d,setSubmitting:a})=>{try{const i={botId:t,organizationId:l,callbackURL:p.crmCallBackUrl,channelId:"CRM_Callback_123",channelName:"CRM_Callback"};await ge(i),d({success:!0}),a(!0),y(!1),g(!0,"The CRM callback url added successfully!","success")}catch(i){d({success:!1}),x({submit:i.message}),a(!1),g(!0,"Not able to CRM callback url. Try after sometime!","error")}};return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{crmCallBackUrl:"",submit:""},validationSchema:E().shape({crmCallBackUrl:I().url("Enter valid url!").required("CRM Callback URL is required"),submit:I()}),onSubmit:o,children:({errors:p,handleBlur:x,handleChange:d,handleSubmit:a,isSubmitting:i,touched:c,values:C})=>e.jsxs("form",{noValidate:!0,onSubmit:a,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(T,{label:"CRM callback URL",id:"crmCallBackUrl",type:"url",name:"crmCallBackUrl",value:C.crmCallBackUrl,onBlur:x,onChange:d,autoComplete:"off",className:c.crmCallBackUrl&&p.crmCallBackUrl?"border-red-500":""}),c.crmCallBackUrl&&p.crmCallBackUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.crmCallBackUrl})]}),p.submit&&e.jsx("div",{className:"text-red-600 text-xs mb-2",children:p.submit}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:i?"Adding...":"Add"})})]})})})}var B={},M,ee;function Re(){return ee||(ee=1,M=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var l=document.activeElement,y=[],o=0;o<t.rangeCount;o++)y.push(t.getRangeAt(o));switch(l.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":l.blur();break;default:l=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||y.forEach(function(p){t.addRange(p)}),l&&l.focus()}}),M}var G,ae;function Ae(){if(ae)return G;ae=1;var t=Re(),l={"text/plain":"Text","text/html":"Url",default:"Text"},y="Copy to clipboard: #{key}, Enter";function o(x){var d=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return x.replace(/#{\s*key\s*}/g,d)}function p(x,d){var a,i,c,C,b,s,h=!1;d||(d={}),a=d.debug||!1;try{c=t(),C=document.createRange(),b=document.getSelection(),s=document.createElement("span"),s.textContent=x,s.ariaHidden="true",s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",function(N){if(N.stopPropagation(),d.format)if(N.preventDefault(),typeof N.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var u=l[d.format]||l.default;window.clipboardData.setData(u,x)}else N.clipboardData.clearData(),N.clipboardData.setData(d.format,x);d.onCopy&&(N.preventDefault(),d.onCopy(N.clipboardData))}),document.body.appendChild(s),C.selectNodeContents(s),b.addRange(C);var w=document.execCommand("copy");if(!w)throw new Error("copy command was unsuccessful");h=!0}catch(N){a&&console.error("unable to copy using execCommand: ",N),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(d.format||"text",x),d.onCopy&&d.onCopy(window.clipboardData),h=!0}catch(u){a&&console.error("unable to copy using clipboardData: ",u),a&&console.error("falling back to prompt"),i=o("message"in d?d.message:y),window.prompt(i,x)}}finally{b&&(typeof b.removeRange=="function"?b.removeRange(C):b.removeAllRanges()),s&&document.body.removeChild(s),c()}return h}return G=p,G}var te;function _e(){if(te)return B;te=1;function t(r){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(r)}Object.defineProperty(B,"__esModule",{value:!0}),B.CopyToClipboard=void 0;var l=p(ue()),y=p(Ae()),o=["text","onCopy","options","children"];function p(r){return r&&r.__esModule?r:{default:r}}function x(r,n){var f=Object.keys(r);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(r);n&&(m=m.filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable})),f.push.apply(f,m)}return f}function d(r){for(var n=1;n<arguments.length;n++){var f=arguments[n]!=null?arguments[n]:{};n%2?x(Object(f),!0).forEach(function(m){P(r,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(f)):x(Object(f)).forEach(function(m){Object.defineProperty(r,m,Object.getOwnPropertyDescriptor(f,m))})}return r}function a(r,n){if(r==null)return{};var f=i(r,n),m,v;if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(r);for(v=0;v<k.length;v++)m=k[v],!(n.indexOf(m)>=0)&&Object.prototype.propertyIsEnumerable.call(r,m)&&(f[m]=r[m])}return f}function i(r,n){if(r==null)return{};var f={},m=Object.keys(r),v,k;for(k=0;k<m.length;k++)v=m[k],!(n.indexOf(v)>=0)&&(f[v]=r[v]);return f}function c(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function C(r,n){for(var f=0;f<n.length;f++){var m=n[f];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(r,m.key,m)}}function b(r,n,f){return n&&C(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function s(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&h(r,n)}function h(r,n){return h=Object.setPrototypeOf||function(m,v){return m.__proto__=v,m},h(r,n)}function w(r){var n=U();return function(){var m=S(r),v;if(n){var k=S(this).constructor;v=Reflect.construct(m,arguments,k)}else v=m.apply(this,arguments);return N(this,v)}}function N(r,n){if(n&&(t(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return u(r)}function u(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function U(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(r){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(f){return f.__proto__||Object.getPrototypeOf(f)},S(r)}function P(r,n,f){return n in r?Object.defineProperty(r,n,{value:f,enumerable:!0,configurable:!0,writable:!0}):r[n]=f,r}var R=function(r){s(f,r);var n=w(f);function f(){var m;c(this,f);for(var v=arguments.length,k=new Array(v),D=0;D<v;D++)k[D]=arguments[D];return m=n.call.apply(n,[this].concat(k)),P(u(m),"onClick",function(_){var A=m.props,$=A.text,J=A.onCopy,ce=A.children,me=A.options,W=l.default.Children.only(ce),pe=(0,y.default)($,me);J&&J($,pe),W&&W.props&&typeof W.props.onClick=="function"&&W.props.onClick(_)}),m}return b(f,[{key:"render",value:function(){var v=this.props;v.text,v.onCopy,v.options;var k=v.children,D=a(v,o),_=l.default.Children.only(k);return l.default.cloneElement(_,d(d({},D),{},{onClick:this.onClick}))}}]),f}(l.default.PureComponent);return B.CopyToClipboard=R,P(R,"defaultProps",{onCopy:void 0,options:void 0}),B}var K,le;function Ee(){if(le)return K;le=1;var t=_e(),l=t.CopyToClipboard;return l.CopyToClipboard=l,K=l,K}var F=Ee();const X=fe(F);function ie({botId:t,organizationId:l,setPopUpDialog:y,gupshupIntegrationObj:o,edit:p}){const x=async(a,{setErrors:i,setStatus:c,setSubmitting:C})=>{try{let b=a;const s=o==null?void 0:o._id;o&&(b={...a,objId:s}),await re(b),c({success:!0}),C(!0),y(!1),g(!0,"The Gupshup integration added successfully!","success")}catch(b){c({success:!1}),i({submit:b.message}),C(!1),g(!0,"Not able to activate Gupshup integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${se}/gupshup/${l}/${t}/entrypoint`,appId:(o==null?void 0:o.appId)||"",appName:(o==null?void 0:o.appName)||"",phoneNumberId:(o==null?void 0:o.phoneNumberId)||"",channelId:"gupshup_123",channelName:"gupshup",leadCategory:(o==null?void 0:o.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(o==null?void 0:o.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:I().required("App ID is required"),appName:I().required("App name is required"),phoneNumberId:Z().min(10,"Please enter a valid phone number id").required("Phone number is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||typeof a=="number"&&a>0)}),onSubmit:x,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:C,isSubmitting:b,touched:s,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:C,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Gupshup Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(X,{text:h.webHookUrl,onCopy:()=>g(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:c,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"Gupshup App ID *"}),e.jsx(T,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:w=>c(w.target.value),autoComplete:"off",onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.appId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"Gupshup App Name *"}),e.jsx(T,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number *"}),e.jsx(T,{id:"phoneNumberId",name:"phoneNumberId",type:"number",value:h.phoneNumberId,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.phoneNumberId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.phoneNumberId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:c,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadCategory})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(T,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadUpgradeToPreSaleCount=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadUpgradeToPreSaleCount})})]})]}),a.submit&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(j,{disabled:b,isLoading:b,htmlType:"submit",type:"primary",size:"lg",label:p?"Edit":"Add"})})]})})})}function Le(t,l){return btoa(`${t}_${l}_whatsapp_int`)}function de({botId:t,organizationId:l,setPopUpDialog:y,whatsappIntegrationObj:o,edit:p}){const x=async(a,{setErrors:i,setStatus:c,setSubmitting:C})=>{try{let b=a;const s=o==null?void 0:o._id;s&&(b={...a,objId:s}),await re(b),c({success:!0}),C(!0),y(!1),g(!0,"The WhatsApp integration added successfully!","success")}catch(b){c({success:!1}),i({submit:b.message}),C(!1),g(!0,"Not able to activate WhatsApp integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${se}/whatsapp/${l}/${t}/entrypoint`,webHookSecret:Le(l,t),appId:(o==null?void 0:o.appId)||"",appName:(o==null?void 0:o.appName)||"",phoneNumberId:(o==null?void 0:o.phoneNumberId)||"",verificationToken:(o==null?void 0:o.verificationToken)||"",channelId:"whatsapp_123",channelName:"whatsapp",leadCategory:(o==null?void 0:o.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(o==null?void 0:o.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:Z().required("App ID must be a number"),appName:I().required("App name is required"),phoneNumberId:Z().min(10,"Please enter a valid phone number id").required("Phone number is required"),verificationToken:I().required("Access Token  is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||!isNaN(Number(a))&&Number(a)>0)}),onSubmit:x,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:C,isSubmitting:b,touched:s,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:C,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Webhook Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(X,{text:h.webHookUrl,onCopy:()=>g(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:c,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookSecret",children:"Webhook Verify token *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(X,{text:h.webHookSecret,onCopy:()=>g(!0,"Webhook Verify Token copied to clipboard","success"),children:e.jsx("input",{id:"webHookSecret",type:"text",value:h.webHookSecret,name:"webHookSecret",onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100",disabled:!0})})}),s.webHookSecret&&a.webHookSecret&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookSecret})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"App ID *"}),e.jsx(T,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:c,onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"App Name *"}),e.jsx(T,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&a.appName==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number ID *"}),e.jsx(T,{id:"phoneNumberId",name:"phoneNumberId",type:"text",value:h.phoneNumberId,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&a.phoneNumberId==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"verificationToken",children:"Access Token *"}),e.jsx(T,{id:"verificationToken",name:"verificationToken",type:"text",value:h.verificationToken,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.verificationToken&&a.verificationToken?"border-red-500":""}),s.verificationToken&&a.verificationToken&&typeof a.verificationToken=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.verificationToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:c,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(T,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:c,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadUpgradeToPreSaleCount})]})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ve,{isLoading:b,disabled:b,type:"submit",children:p?"Edit":"Add"})})]})})})}function q({label:t,value:l,copyText:y,onCopy:o}){return e.jsxs("div",{className:"flex items-center gap-2 my-1",children:[e.jsx("b",{style:{minWidth:180},children:t}),e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:350,flex:"1 1 auto",marginRight:8,fontFamily:"monospace"},title:l,children:l}),e.jsx(F.CopyToClipboard,{text:y||l,onCopy:o,children:e.jsx(j,{label:"Copy",type:"primary",style:{minWidth:60}})})]})}function $e({integrationObj:t}){const[l,y]=V.useState(!1),[o,p]=V.useState(!1),x=async(i,c)=>{try{await ke(i),g(!0,`The ${c} deleted successfully!`,"success")}catch{g(!0,`Not able to delete the ${c}. Try after sometime!`,"error")}},d=i=>{const c=new Date(i);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(c)};let a=null;if(t.channelName==="Webchat")a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"Chat window Script Tag"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.scriptTag}),e.jsx(F.CopyToClipboard,{text:t.scriptTag,onCopy:()=>g(!0,"chat script copied to clipboard","success"),children:e.jsx(j,{label:"Copy",type:"primary"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]});else if(t.channelName==="whatsapp"){const i=`${Y}/whatsapp/${t.organizationId}/${t.botId}/${t._id}/entrypoint`,c=Ne(t.organizationId,t.botId);a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"WhatsApp Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(de,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},whatsappIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(j,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(z,{title:"Delete Whatsapp integration?",open:o,setOpen:p,onConfirm:()=>x(t,"Whatsapp integration"),children:"Confirm the deletion of Whatsapp integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number ID:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>g(!0,"Web hook callback url copied to clipboard","success")}),e.jsx(q,{label:"Webhook Verification Token:",value:c,onCopy:()=>g(!0,"Webhook Verification Token copied to clipboard","success")}),e.jsx(q,{label:"Access Token:",value:t.verificationToken,onCopy:()=>g(!0,"Access Token copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else if(t.channelName==="gupshup"){const i=`${Y}/gupshup/${t.organizationId}/${t.botId}/${t._id}/entrypoint`;a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"Gupshup Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ie,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},gupshupIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(j,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(z,{title:"Delete Gupshup integration?",open:o,setOpen:p,onConfirm:()=>x(t,"Gupshup integration"),children:"Confirm the deletion of Gupshup integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>g(!0,"Web hook callback url copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else t.channelName==="CRM_Callback"&&(a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"CRM Callback URL"}),l?e.jsx(j,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ne,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},crmIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.callbackURL}),e.jsx(j,{label:"Edit",type:"plain",onClick:()=>y(!0)}),e.jsx(j,{label:"Delete",type:"plain",onClick:()=>p(!0)}),e.jsx(F.CopyToClipboard,{text:t.callbackURL,onCopy:()=>g(!0,"CRM callback URL copied to clipboard","success"),children:e.jsx(j,{label:"Copy",type:"primary"})}),e.jsx(z,{title:"Delete CRM callback URL?",open:o,setOpen:p,onConfirm:()=>x(t,"crm callback url"),children:"Confirm the deletion of CRM callback URL."})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]}));return e.jsx("div",{className:"bg-white rounded shadow p-4 mb-4",children:a})}function Be({admins:t,index:l,handleBlur:y,handleChange:o,errors:p,touched:x,remove:d}){var a,i,c,C,b,s,h,w,N,u,U,S,P,R,r,n,f,m,v,k,D,_,A,$;return e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(T,{label:"Admin Name",id:`admins.${l}.adminName`,name:`admins.${l}.adminName`,type:"text",value:t.adminName,onBlur:y,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((i=(a=x.admins)==null?void 0:a[l])!=null&&i.adminName)&&((C=(c=p.admins)==null?void 0:c[l])!=null&&C.adminName)?"border-red-500":""}),l!==0&&((s=(b=x.admins)==null?void 0:b[l])==null?void 0:s.adminName)&&((w=(h=p.admins)==null?void 0:h[l])==null?void 0:w.adminName)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].adminName})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx(T,{label:"Role",id:`admins.${l}.role`,name:`admins.${l}.role`,type:"text",value:t.role,onBlur:y,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((u=(N=x.admins)==null?void 0:N[l])!=null&&u.role)&&((S=(U=p.admins)==null?void 0:U[l])!=null&&S.role)?"border-red-500":""}),l!==0&&((R=(P=x.admins)==null?void 0:P[l])==null?void 0:R.role)&&((n=(r=p.admins)==null?void 0:r[l])==null?void 0:n.role)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].role})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(T,{label:"Email",id:`admins.${l}.email`,name:`admins.${l}.email`,type:"text",value:t.email,onBlur:y,onChange:o,autoComplete:"off",disabled:l===0,className:l!==0&&((m=(f=x.admins)==null?void 0:f[l])!=null&&m.email)&&((k=(v=p.admins)==null?void 0:v[l])!=null&&k.email)?"border-red-500":""}),l!==0&&((_=(D=x.admins)==null?void 0:D[l])==null?void 0:_.email)&&(($=(A=p.admins)==null?void 0:A[l])==null?void 0:$.email)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:p.admins[l].email})]}),l!==0&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Delete"}),e.jsx(j,{type:"plain",label:"ðŸ—‘ï¸",className:"text-2xl text-red-600",onClick:()=>d(l)})]})]})})}function We({organizationId:t}){const y={admins:Ue(a=>{var i;return(i=a.organization)==null?void 0:i.admins})||[],submit:""},o=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),p=E().shape({admins:ye().of(Ce(a=>a.index===0?E().shape({}):E().shape({adminName:I().required("Admin Name is required"),role:I().required("Role is required"),email:I().trim().required("Email is required").email("Invalid email id").matches(o,"Invalid email id")})))}),x=a=>a.map((i,c)=>({...i,itemNo:c+1})),d=async(a,{setErrors:i,setStatus:c,setSubmitting:C})=>{try{C(!0),await Te(a,t),c({success:!0})}catch(b){c({success:!1}),i({submit:b.message}),C(!1),g(!0,b.message,"error")}};return e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Lead emails are sending to below given email ids"}),e.jsx("br",{}),e.jsx("br",{})]}),e.jsx(H,{initialValues:y,onSubmit:d,validationSchema:p,children:({errors:a,handleBlur:i,handleChange:c,handleSubmit:C,touched:b,values:s,setFieldValue:h,isSubmitting:w})=>e.jsx("form",{onSubmit:C,children:e.jsx(he,{name:"admins",children:({push:N,remove:u})=>e.jsxs(e.Fragment,{children:[s.admins.map((U,S)=>e.jsx(Be,{admins:U,index:S,handleBlur:i,handleChange:c,errors:a,touched:b,remove:P=>{u(P);const R=x(s.admins.filter((r,n)=>n!==P));h("admins",R)}},S)),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4 mt-4",children:[e.jsx(j,{type:"secondary",className:"ml-2",onClick:()=>{N({adminName:"",role:"",email:""})},label:"Add Email"}),e.jsx(j,{type:"primary",className:"ml-2",disabled:w,isLoading:w,htmlType:"submit",label:"Save Changes"})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})]})})})})]})}function da(){var N;const[t]=De(),l=xe(u=>u.botsList),y=Q(u=>u.organizationId),o=Q(u=>u.isSuperUser),[p,x]=V.useState(!1);be.useEffect(()=>{(async()=>{const U={organizationId:y,botId:t};try{await je(U)}catch{g(!0,"Not able to fetch integrations details. Try after sometime!","error")}})()},[t,y]);const d=(N=l.find(u=>u._id===t))==null?void 0:N.integrations;let a=null,i=null,c=null;d!==void 0&&(a=d.find(u=>u.channelName==="CRM_Callback"),i=d.find(u=>u.channelName==="whatsapp"),c=d.find(u=>u.channelName==="gupshup"));const C=()=>{L(i?e.jsx("div",{children:"The Whatsapp integration already configured."}):e.jsx(de,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},b=()=>{L(a?e.jsx("div",{children:"The CRM Callback URL has been successfully configured."}):e.jsx(ne,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},s=()=>{L(c?e.jsx("div",{children:"The Gupshup integration already configured."}):e.jsx(ie,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},h=[{name:"WhatsApp Integration",icon:e.jsx(O,{}),method:C},{name:"CRM Callback",icon:e.jsx(we,{}),method:b},{name:"Gupshup Integration",icon:e.jsx(O,{}),method:s}],w=o?h:h.filter(u=>u.name!=="Gupshup Integration");return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 relative",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(Ie,{title:"Integrations",icon:p?Se:Pe,onClick:()=>x(u=>!u)}),p&&e.jsx("div",{className:"absolute right-0 top-[60px] flex flex-col items-end z-50",children:w.map(u=>e.jsx("button",{className:"mb-2 rounded-full bg-white shadow-lg w-8 h-8 flex items-center justify-center border border-gray-200 hover:bg-gray-100 transition",onClick:()=>{x(!1),u.method()},title:u.name,children:u.icon},u.name))})]})}),e.jsxs("div",{className:"space-y-4",children:[d&&d.map((u,U)=>u.channelId!=="callConnect_123"&&e.jsx($e,{integrationObj:u},U)),o&&e.jsx(We,{organizationId:y})]})]})}export{da as default};
