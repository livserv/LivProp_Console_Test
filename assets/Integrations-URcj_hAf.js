import{j as e,n as fe,i as xe,r as V,b as X,e as be,R as he}from"./index-76FBFgXB.js";import{F as H,a as g,P as ye,b as ve}from"./ProgressButton-DWBh4X0i.js";import{c as E,a as I,b as oe,d as Z,e as Ce,f as Ne}from"./index.esm-PZWCiyFD.js";import{B as k}from"./Button-DsociJtw.js";import{c as Y}from"./Button-Bm5UGBgp.js";import{n as ge}from"./ajax-w58snP7s.js";import{T}from"./TextBox-oEW-RbFW.js";import{a as je,b as se,d as ke,g as we}from"./integrations-Bu0t7z8G.js";import{w as ne}from"./env-CBDBHzQq.js";import{w as O}from"./env-CmL5wTXD.js";import{s as L}from"./utils-B3TvvZ68.js";import{C as z,S as Te}from"./ConfirmDialog-CMQm8cPD.js";import{b as Ue}from"./organization-BpWTUjVK.js";import{S as Se}from"./cancel-CE0oj0ka.js";import{S as Pe}from"./plus-DinZQlcC.js";import{S as ee}from"./whatsapp-8yopXq-a.js";import{u as De}from"./useSelectedBot-D50ZS0tk.js";import{P as Ie}from"./PageHeader-4Ub09-hf.js";import"./hoist-non-react-statics.cjs-U5WcsUGg.js";function ie({botId:t,organizationId:l,setPopUpDialog:y}){const r=async(c,{setErrors:f,setStatus:d,setSubmitting:a})=>{try{const i={botId:t,organizationId:l,callbackURL:c.crmCallBackUrl,channelId:"CRM_Callback_123",channelName:"CRM_Callback"};await je(i),d({success:!0}),a(!0),y(!1),g(!0,"The CRM callback url added successfully!","success")}catch(i){d({success:!1}),f({submit:i.message}),a(!1),g(!0,"Not able to CRM callback url. Try after sometime!","error")}};return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{crmCallBackUrl:"",submit:""},validationSchema:E().shape({crmCallBackUrl:I().url("Enter valid url!").required("CRM Callback URL is required"),submit:I()}),onSubmit:r,children:({errors:c,handleBlur:f,handleChange:d,handleSubmit:a,isSubmitting:i,touched:m,values:v})=>e.jsxs("form",{noValidate:!0,onSubmit:a,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(T,{label:"CRM callback URL",id:"crmCallBackUrl",type:"url",name:"crmCallBackUrl",value:v.crmCallBackUrl,onBlur:f,onChange:d,autoComplete:"off",className:m.crmCallBackUrl&&c.crmCallBackUrl?"border-red-500":""}),m.crmCallBackUrl&&c.crmCallBackUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.crmCallBackUrl})]}),c.submit&&e.jsx("div",{className:"text-red-600 text-xs mb-2",children:c.submit}),e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:i?"Adding...":"Add"})})]})})})}var B={},M,ae;function Re(){return ae||(ae=1,M=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var l=document.activeElement,y=[],r=0;r<t.rangeCount;r++)y.push(t.getRangeAt(r));switch(l.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":l.blur();break;default:l=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||y.forEach(function(c){t.addRange(c)}),l&&l.focus()}}),M}var G,te;function Ae(){if(te)return G;te=1;var t=Re(),l={"text/plain":"Text","text/html":"Url",default:"Text"},y="Copy to clipboard: #{key}, Enter";function r(f){var d=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return f.replace(/#{\s*key\s*}/g,d)}function c(f,d){var a,i,m,v,x,s,b=!1;d||(d={}),a=d.debug||!1;try{m=t(),v=document.createRange(),x=document.getSelection(),s=document.createElement("span"),s.textContent=f,s.ariaHidden="true",s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",function(N){if(N.stopPropagation(),d.format)if(N.preventDefault(),typeof N.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var h=l[d.format]||l.default;window.clipboardData.setData(h,f)}else N.clipboardData.clearData(),N.clipboardData.setData(d.format,f);d.onCopy&&(N.preventDefault(),d.onCopy(N.clipboardData))}),document.body.appendChild(s),v.selectNodeContents(s),x.addRange(v);var w=document.execCommand("copy");if(!w)throw new Error("copy command was unsuccessful");b=!0}catch(N){a&&console.error("unable to copy using execCommand: ",N),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(d.format||"text",f),d.onCopy&&d.onCopy(window.clipboardData),b=!0}catch(h){a&&console.error("unable to copy using clipboardData: ",h),a&&console.error("falling back to prompt"),i=r("message"in d?d.message:y),window.prompt(i,f)}}finally{x&&(typeof x.removeRange=="function"?x.removeRange(v):x.removeAllRanges()),s&&document.body.removeChild(s),m()}return b}return G=c,G}var le;function _e(){if(le)return B;le=1;function t(o){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(o)}Object.defineProperty(B,"__esModule",{value:!0}),B.CopyToClipboard=void 0;var l=c(fe()),y=c(Ae()),r=["text","onCopy","options","children"];function c(o){return o&&o.__esModule?o:{default:o}}function f(o,n){var u=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);n&&(p=p.filter(function(C){return Object.getOwnPropertyDescriptor(o,C).enumerable})),u.push.apply(u,p)}return u}function d(o){for(var n=1;n<arguments.length;n++){var u=arguments[n]!=null?arguments[n]:{};n%2?f(Object(u),!0).forEach(function(p){P(o,p,u[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(u)):f(Object(u)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(u,p))})}return o}function a(o,n){if(o==null)return{};var u=i(o,n),p,C;if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(o);for(C=0;C<j.length;C++)p=j[C],!(n.indexOf(p)>=0)&&Object.prototype.propertyIsEnumerable.call(o,p)&&(u[p]=o[p])}return u}function i(o,n){if(o==null)return{};var u={},p=Object.keys(o),C,j;for(j=0;j<p.length;j++)C=p[j],!(n.indexOf(C)>=0)&&(u[C]=o[C]);return u}function m(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function v(o,n){for(var u=0;u<n.length;u++){var p=n[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(o,p.key,p)}}function x(o,n,u){return n&&v(o.prototype,n),Object.defineProperty(o,"prototype",{writable:!1}),o}function s(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),n&&b(o,n)}function b(o,n){return b=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},b(o,n)}function w(o){var n=U();return function(){var p=S(o),C;if(n){var j=S(this).constructor;C=Reflect.construct(p,arguments,j)}else C=p.apply(this,arguments);return N(this,C)}}function N(o,n){if(n&&(t(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h(o)}function h(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function U(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(o){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(u){return u.__proto__||Object.getPrototypeOf(u)},S(o)}function P(o,n,u){return n in o?Object.defineProperty(o,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[n]=u,o}var R=(function(o){s(u,o);var n=w(u);function u(){var p;m(this,u);for(var C=arguments.length,j=new Array(C),D=0;D<C;D++)j[D]=arguments[D];return p=n.call.apply(n,[this].concat(j)),P(h(p),"onClick",function(_){var A=p.props,$=A.text,Q=A.onCopy,me=A.children,pe=A.options,W=l.default.Children.only(me),ue=(0,y.default)($,pe);Q&&Q($,ue),W&&W.props&&typeof W.props.onClick=="function"&&W.props.onClick(_)}),p}return x(u,[{key:"render",value:function(){var C=this.props;C.text,C.onCopy,C.options;var j=C.children,D=a(C,r),_=l.default.Children.only(j);return l.default.cloneElement(_,d(d({},D),{},{onClick:this.onClick}))}}]),u})(l.default.PureComponent);return B.CopyToClipboard=R,P(R,"defaultProps",{onCopy:void 0,options:void 0}),B}var K,re;function Ee(){if(re)return K;re=1;var t=_e(),l=t.CopyToClipboard;return l.CopyToClipboard=l,K=l,K}var F=Ee();const J=xe(F);function de({botId:t,organizationId:l,setPopUpDialog:y,gupshupIntegrationObj:r,edit:c}){const f=async(a,{setErrors:i,setStatus:m,setSubmitting:v})=>{try{let x=a;const s=r==null?void 0:r._id;r&&(x={...a,objId:s}),await se(x),m({success:!0}),v(!0),y(!1),g(!0,"The Gupshup integration added successfully!","success")}catch(x){m({success:!1}),i({submit:x.message}),v(!1),g(!0,"Not able to activate Gupshup integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${ne}/gupshup/${l}/${t}/entrypoint`,appId:(r==null?void 0:r.appId)||"",appName:(r==null?void 0:r.appName)||"",phoneNumberId:(r==null?void 0:r.phoneNumberId)||"",channelId:"gupshup_123",channelName:"gupshup",leadCategory:(r==null?void 0:r.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(r==null?void 0:r.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:I().required("App ID is required"),appName:I().required("App name is required"),phoneNumberId:Z().min(10,"Please enter a valid phone number id").required("Phone number is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||typeof a=="number"&&a>0)}),onSubmit:f,children:({errors:a,handleBlur:i,handleChange:m,handleSubmit:v,isSubmitting:x,touched:s,values:b})=>e.jsxs("form",{noValidate:!0,onSubmit:v,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Gupshup Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:b.webHookUrl,onCopy:()=>g(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:b.webHookUrl,name:"webHookUrl",onBlur:i,onChange:m,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"Gupshup App ID *"}),e.jsx(T,{id:"appId",name:"appId",value:b.appId,onBlur:i,onChange:w=>m(w.target.value),autoComplete:"off",onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.appId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"Gupshup App Name *"}),e.jsx(T,{id:"appName",name:"appName",value:b.appName,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number *"}),e.jsx(T,{id:"phoneNumberId",name:"phoneNumberId",type:"number",value:b.phoneNumberId,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.phoneNumberId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.phoneNumberId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:b.leadCategory||"preSale",onBlur:i,onChange:m,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadCategory})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(T,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:b.leadUpgradeToPreSaleCount,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadUpgradeToPreSaleCount=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadUpgradeToPreSaleCount})})]})]}),a.submit&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(k,{disabled:x,isLoading:x,htmlType:"submit",type:"primary",size:"lg",label:c?"Edit":"Add"})})]})})})}function Le(t,l){return btoa(`${t}_${l}_whatsapp_int`)}function ce({botId:t,organizationId:l,setPopUpDialog:y,whatsappIntegrationObj:r,edit:c}){const f=async(a,{setErrors:i,setStatus:m,setSubmitting:v})=>{try{let x=a;const s=r==null?void 0:r._id;s&&(x={...a,objId:s}),await se(x),m({success:!0}),v(!0),y(!1),g(!0,"The WhatsApp integration added successfully!","success")}catch(x){m({success:!1}),i({submit:x.message}),v(!1),g(!0,"Not able to activate WhatsApp integration. Try after sometime!","error")}};function d(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(H,{initialValues:{webHookUrl:`${ne}/whatsapp/${l}/${t}/entrypoint`,webHookSecret:Le(l,t),appId:(r==null?void 0:r.appId)||"",appName:(r==null?void 0:r.appName)||"",phoneNumberId:(r==null?void 0:r.phoneNumberId)||"",verificationToken:(r==null?void 0:r.verificationToken)||"",channelId:"whatsapp_123",channelName:"whatsapp",leadCategory:(r==null?void 0:r.leadCategory)||"preSale",leadUpgradeToPreSaleCount:(r==null?void 0:r.leadUpgradeToPreSaleCount)||"",submit:""},validationSchema:E().shape({appId:Z().required("App ID must be a number"),appName:I().required("App name is required"),phoneNumberId:Z().min(10,"Please enter a valid phone number id").required("Phone number is required"),verificationToken:I().required("Access Token  is required"),leadUpgradeToPreSaleCount:oe().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||!isNaN(Number(a))&&Number(a)>0)}),onSubmit:f,children:({errors:a,handleBlur:i,handleChange:m,handleSubmit:v,isSubmitting:x,touched:s,values:b})=>e.jsxs("form",{noValidate:!0,onSubmit:v,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Webhook Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:b.webHookUrl,onCopy:()=>g(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:b.webHookUrl,name:"webHookUrl",onBlur:i,onChange:m,autoComplete:"off",disabled:!0,onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),s.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookSecret",children:"Webhook Verify token *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{text:b.webHookSecret,onCopy:()=>g(!0,"Webhook Verify Token copied to clipboard","success"),children:e.jsx("input",{id:"webHookSecret",type:"text",value:b.webHookSecret,name:"webHookSecret",onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:"w-full border rounded px-3 py-2 bg-gray-100",disabled:!0})})}),s.webHookSecret&&a.webHookSecret&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookSecret})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"App ID *"}),e.jsx(T,{id:"appId",name:"appId",value:b.appId,onBlur:i,onChange:m,onKeyDown:d,className:s.appId&&a.appId?"border-red-500":""}),s.appId&&a.appId&&typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"App Name *"}),e.jsx(T,{id:"appName",name:"appName",value:b.appName,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.appName&&a.appName?"border-red-500":""}),s.appName&&a.appName&&a.appName==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number ID *"}),e.jsx(T,{id:"phoneNumberId",name:"phoneNumberId",type:"text",value:b.phoneNumberId,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),s.phoneNumberId&&a.phoneNumberId&&a.phoneNumberId==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"verificationToken",children:"Access Token *"}),e.jsx(T,{id:"verificationToken",name:"verificationToken",type:"text",value:b.verificationToken,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.verificationToken&&a.verificationToken?"border-red-500":""}),s.verificationToken&&a.verificationToken&&typeof a.verificationToken=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.verificationToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:b.leadCategory||"preSale",onBlur:i,onChange:m,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),s.leadCategory&&a.leadCategory&&typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(T,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:b.leadUpgradeToPreSaleCount,onBlur:i,onChange:m,autoComplete:"off",onKeyDown:d,className:s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),s.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadUpgradeToPreSaleCount})]})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ye,{isLoading:x,disabled:x,type:"submit",children:c?"Edit":"Add"})})]})})})}function q({label:t,value:l,copyText:y,onCopy:r}){return e.jsxs("div",{className:"flex items-center gap-2 my-1",children:[e.jsx("b",{style:{minWidth:180},children:t}),e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:350,flex:"1 1 auto",marginRight:8,fontFamily:"monospace"},title:l,children:l}),e.jsx(F.CopyToClipboard,{text:y||l,onCopy:r,children:e.jsx(k,{label:"Copy",type:"primary",style:{minWidth:60}})})]})}function $e({integrationObj:t}){const[l,y]=V.useState(!1),[r,c]=V.useState(!1),f=async(i,m)=>{try{await ke(i),g(!0,`The ${m} deleted successfully!`,"success")}catch{g(!0,`Not able to delete the ${m}. Try after sometime!`,"error")}},d=i=>{const m=new Date(i);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(m)};let a=null;if(t.channelName==="Webchat")a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"Chat window Script Tag"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.scriptTag}),e.jsx(F.CopyToClipboard,{text:t.scriptTag,onCopy:()=>g(!0,"chat script copied to clipboard","success"),children:e.jsx(k,{label:"Copy",type:"primary"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]});else if(t.channelName==="whatsapp"){const i=`${O}/whatsapp/${t.organizationId}/${t.botId}/${t._id}/entrypoint`,m=ge(t.organizationId,t.botId);a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"WhatsApp Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ce,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},whatsappIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(k,{label:"Delete",type:"plain",onClick:()=>c(!0)}),e.jsx(z,{title:"Delete Whatsapp integration?",open:r,setOpen:c,onConfirm:()=>f(t,"Whatsapp integration"),children:"Confirm the deletion of Whatsapp integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number ID:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>g(!0,"Web hook callback url copied to clipboard","success")}),e.jsx(q,{label:"Webhook Verification Token:",value:m,onCopy:()=>g(!0,"Webhook Verification Token copied to clipboard","success")}),e.jsx(q,{label:"Access Token:",value:t.verificationToken,onCopy:()=>g(!0,"Access Token copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else if(t.channelName==="gupshup"){const i=`${O}/gupshup/${t.organizationId}/${t.botId}/${t._id}/entrypoint`;a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-bold text-lg",children:"Gupshup Integration"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(de,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},gupshupIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(k,{label:"Delete",type:"plain",onClick:()=>c(!0)}),e.jsx(z,{title:"Delete Gupshup integration?",open:r,setOpen:c,onConfirm:()=>f(t,"Gupshup integration"),children:"Confirm the deletion of Gupshup integration."})]})]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone Number:"})," ",t.phoneNumberId]}),e.jsx(q,{label:"Webhook Callback Url:",value:i,onCopy:()=>g(!0,"Web hook callback url copied to clipboard","success")}),e.jsxs("div",{children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]})}else t.channelName==="CRM_Callback"&&(a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:"CRM Callback URL"}),l?e.jsx(k,{label:"Edit",type:"plain",onClick:()=>{L(e.jsx(ie,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},crmIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono",children:t.callbackURL}),e.jsx(k,{label:"Edit",type:"plain",onClick:()=>y(!0)}),e.jsx(k,{label:"Delete",type:"plain",onClick:()=>c(!0)}),e.jsx(F.CopyToClipboard,{text:t.callbackURL,onCopy:()=>g(!0,"CRM callback URL copied to clipboard","success"),children:e.jsx(k,{label:"Copy",type:"primary"})}),e.jsx(z,{title:"Delete CRM callback URL?",open:r,setOpen:c,onConfirm:()=>f(t,"crm callback url"),children:"Confirm the deletion of CRM callback URL."})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),d(t.integratedAt)]})]}));return e.jsx("div",{className:"bg-white rounded shadow p-4 mb-4",children:a})}function Be({admins:t,index:l,handleBlur:y,handleChange:r,errors:c,touched:f,remove:d}){var a,i,m,v,x,s,b,w,N,h,U,S,P,R,o,n,u,p,C,j,D,_,A,$;return e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(T,{label:"Admin Name",id:`admins.${l}.adminName`,name:`admins.${l}.adminName`,type:"text",value:t.adminName,onBlur:y,onChange:r,autoComplete:"off",disabled:l===0,className:l!==0&&((i=(a=f.admins)==null?void 0:a[l])!=null&&i.adminName)&&((v=(m=c.admins)==null?void 0:m[l])!=null&&v.adminName)?"border-red-500":""}),l!==0&&((s=(x=f.admins)==null?void 0:x[l])==null?void 0:s.adminName)&&((w=(b=c.admins)==null?void 0:b[l])==null?void 0:w.adminName)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].adminName})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx(T,{label:"Role",id:`admins.${l}.role`,name:`admins.${l}.role`,type:"text",value:t.role,onBlur:y,onChange:r,autoComplete:"off",disabled:l===0,className:l!==0&&((h=(N=f.admins)==null?void 0:N[l])!=null&&h.role)&&((S=(U=c.admins)==null?void 0:U[l])!=null&&S.role)?"border-red-500":""}),l!==0&&((R=(P=f.admins)==null?void 0:P[l])==null?void 0:R.role)&&((n=(o=c.admins)==null?void 0:o[l])==null?void 0:n.role)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].role})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(T,{label:"Email",id:`admins.${l}.email`,name:`admins.${l}.email`,type:"text",value:t.email,onBlur:y,onChange:r,autoComplete:"off",disabled:l===0,className:l!==0&&((p=(u=f.admins)==null?void 0:u[l])!=null&&p.email)&&((j=(C=c.admins)==null?void 0:C[l])!=null&&j.email)?"border-red-500":""}),l!==0&&((_=(D=f.admins)==null?void 0:D[l])==null?void 0:_.email)&&(($=(A=c.admins)==null?void 0:A[l])==null?void 0:$.email)&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:c.admins[l].email})]}),l!==0&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Delete"}),e.jsx(k,{type:"plain",label:"🗑️",className:"text-2xl text-red-600",onClick:()=>d(l)})]})]})})}function We({organizationId:t}){const y={admins:X(a=>{var i;return(i=a.organization)==null?void 0:i.admins})||[],submit:""},r=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),c=E().shape({admins:Ce().of(Ne(a=>a.index===0?E().shape({}):E().shape({adminName:I().required("Admin Name is required"),role:I().required("Role is required"),email:I().trim().required("Email is required").email("Invalid email id").matches(r,"Invalid email id")})))}),f=a=>a.map((i,m)=>({...i,itemNo:m+1})),d=async(a,{setErrors:i,setStatus:m,setSubmitting:v})=>{try{v(!0),await Ue(a,t),m({success:!0})}catch(x){m({success:!1}),i({submit:x.message}),v(!1),g(!0,x.message,"error")}};return e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Lead emails are sending to below given email ids"}),e.jsx("br",{}),e.jsx("br",{})]}),e.jsx(H,{initialValues:y,onSubmit:d,validationSchema:c,children:({errors:a,handleBlur:i,handleChange:m,handleSubmit:v,touched:x,values:s,setFieldValue:b,isSubmitting:w})=>e.jsx("form",{onSubmit:v,children:e.jsx(ve,{name:"admins",children:({push:N,remove:h})=>e.jsxs(e.Fragment,{children:[s.admins.map((U,S)=>e.jsx(Be,{admins:U,index:S,handleBlur:i,handleChange:m,errors:a,touched:x,remove:P=>{h(P);const R=f(s.admins.filter((o,n)=>n!==P));b("admins",R)}},S)),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4 mt-4",children:[e.jsx(k,{type:"secondary",className:"ml-2",onClick:()=>{N({adminName:"",role:"",email:""})},label:"Add Email"}),e.jsx(k,{type:"primary",className:"ml-2",disabled:w,isLoading:w,htmlType:"submit",label:"Save Changes"})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})]})})})})]})}const qe=({actions:t,isOpen:l,onClose:y,className:r})=>l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:y}),e.jsx("div",{className:Y("absolute right-0 top-[60px] z-50 animate-in fade-in slide-in-from-top-2 duration-200",r),children:e.jsx("div",{className:"flex flex-col items-end space-y-3",children:t.map((c,f)=>e.jsxs("div",{className:"flex items-center group",style:{animationDelay:`${f*50}ms`,animation:"slideInRight 0.3s ease-out forwards"},children:[e.jsxs("div",{className:"mr-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("span",{className:"bg-gray-800 text-white text-sm px-3 py-2 rounded-lg shadow-lg whitespace-nowrap",children:c.name}),e.jsx("div",{className:"absolute right-[-6px] top-1/2 transform -translate-y-1/2 w-0 h-0 border-l-[6px] border-l-gray-800 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent"})]}),e.jsxs("button",{className:Y("relative w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all duration-200 transform","hover:scale-110 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-300",{"bg-white from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700":!c.disabled,"bg-gray-300 text-gray-500 cursor-not-allowed":c.disabled}),onClick:()=>{c.disabled||(y(),c.method())},disabled:c.disabled,title:c.name,children:[e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:c.icon}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-200 opacity-0 scale-0 transition-all duration-300 pointer-events-none hover:opacity-30 hover:scale-100"})]})]},c.name))})}),e.jsx("style",{children:`
        @keyframes slideInRight {
          from {
            opacity: 0;
            transform: translateX(20px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `})]}):null;function sa(){var N;const[t]=De(),l=be(h=>h.botsList),y=X(h=>h.organizationId),r=X(h=>h.isSuperUser),[c,f]=V.useState(!1);he.useEffect(()=>{(async()=>{const U={organizationId:y,botId:t};try{await we(U)}catch{g(!0,"Not able to fetch integrations details. Try after sometime!","error")}})()},[t,y]);const d=(N=l.find(h=>h._id===t))==null?void 0:N.integrations;let a=null,i=null,m=null;d!==void 0&&(a=d.find(h=>h.channelName==="CRM_Callback"),i=d.find(h=>h.channelName==="whatsapp"),m=d.find(h=>h.channelName==="gupshup"));const v=()=>{L(i?e.jsx("div",{children:"The Whatsapp integration already configured."}):e.jsx(ce,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},x=()=>{L(a?e.jsx("div",{children:"The CRM Callback URL has been successfully configured."}):e.jsx(ie,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},s=()=>{L(m?e.jsx("div",{children:"The Gupshup integration already configured."}):e.jsx(de,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},b=[{name:"WhatsApp Integration",icon:e.jsx(ee,{}),method:v},{name:"CRM Callback",icon:e.jsx(Te,{}),method:x},{name:"Gupshup Integration",icon:e.jsx(ee,{}),method:s}],w=r?b:b.filter(h=>h.name!=="Gupshup Integration");return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 relative",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(Ie,{title:"Integrations",icon:c?Se:Pe,onClick:()=>f(h=>!h)}),e.jsx(qe,{actions:w,isOpen:c,onClose:()=>f(!1)})]})}),e.jsxs("div",{className:"space-y-4",children:[d&&d.map((h,U)=>h.channelId!=="callConnect_123"&&e.jsx($e,{integrationObj:h},U)),r&&e.jsx(We,{organizationId:y})]})]})}export{sa as default};
