import{r as m,j as e,c as _,h as x}from"./AlertSnackbar-BBOi9bHj.js";import{c as v}from"./index-B4Pd27tI.js";import{S as z}from"./delete-BYa5uglT.js";import{S as G}from"./download-CJnziux0.js";import{S as M}from"./edit-B3Se8WZw.js";import{S as K}from"./plus-MhxGst-q.js";import{S as O}from"./search-DFPqfhni.js";import"./Button-htJsKnEd.js";import{B as u}from"./Button-Cm50jxWY.js";import{S as H}from"./SelectBox-SgIxSiS9.js";import{T as Q}from"./TextBox-DU8s_y0c.js";import{s as S,h as D}from"./utils-BPLOM7gE.js";import{b as W,c as $,d as J,e as X,f as Y}from"./trainingDocuments-CAYPgW8I.js";import{u as A}from"./useSelectedBot-CTuACohy.js";import{P as Z}from"./PageHeader-CFxyZRKj.js";import{S as P}from"./send-DIJqnNt5.js";import{F as ee,a as te,d as se}from"./index-D9e1xcC3.js";import"./env-CmL5wTXD.js";import"./LabelWrapper-O3YM8ZQf.js";import"./bots-BMhX1rh2.js";import"./organization-B9OzZuX7.js";function k({onDone:o,initial:l,onUpdate:n}){const[t,a]=m.useState(l||{question:"",content:"",_id:""}),i=(r,f)=>{a(N=>({...N,[r]:f}))},c=async()=>{const r=await W(t);n?.(r),o()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(ee,{value:t,onChange:a,children:[e.jsx(te,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:r=>i("question",r)}),e.jsx(se,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:r=>i("content",r)})]}),e.jsx("div",{className:"text-center",children:e.jsx(u,{icon:e.jsx(P,{}),size:"lg",type:"rounded",onClick:c,className:"bg-[#49d4a1]"})})]})}function Ae(o){const{activeIndex:l,onNavigate:n=()=>{},docsList:t,onUpdate:a}=o,i=_(s=>s.organizationId),[c]=A(),[r,f]=$(),N=t??r,[h,I]=m.useState(10),[p,g]=m.useState(1),[b,L]=m.useState(""),B=[10,15,20,25],w=(N||[]).filter(s=>!b||s.question?.toLowerCase().includes(b.toLowerCase())||s.content?.toLowerCase().includes(b.toLowerCase())),j=Math.ceil(w.length/h),y=(p-1)*h,E=y+h,C=w.slice(y,E),q=()=>D(),T=()=>S(e.jsx(k,{onDone:q,onUpdate:a}),{showCloseButton:!0,width:"700px"}),F=async()=>{try{await J(),x(!0,"Documents downloaded successfully","success")}catch(s){console.error("Error while downloading docs:",s),x(!0,"Failed to download documents","error")}};m.useEffect(()=>{p>j&&g(1)},[w.length,j,p]);const R=s=>{const d=typeof s=="string"?parseInt(s,10):s;typeof d=="number"&&!isNaN(d)&&(I(d),g(1))},U=s=>{s<1||s>j||g(s)},V=async()=>{try{await X({botDetailsForVerification:{integrationUrl:""}},i,c)?x(!0,"The bot deployed successfully","success"):x(!0,"Not able to deploy the bot. Try after sometime!","error"),l&&n(l+1)}catch(s){console.error("Error during bot verification:",s),x(!0,"Not able to verify the bot. Try after sometime!","error")}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!t&&!l&&e.jsx("div",{className:"mb-4",children:e.jsx(Z,{title:"Chat Bot Knowledge",icon:K,onClick:T})}),!t&&!l&&e.jsx("div",{className:"flex justify-between items-center py-3 px-2",children:e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx(Q,{value:b,placeholder:"Search",onChange:s=>L(s.target.value),iconRight:O,className:"py-3"}),e.jsx(u,{icon:e.jsx(G,{}),size:"sm",type:"secondary",className:"align-middle",onClick:F,title:"Download as CSV"})]})}),e.jsxs("div",{className:v("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":f}),children:[e.jsx("div",{className:"flex-1",children:f?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"Loading..."}):C.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"No documents found."}):C.map((s,d)=>e.jsx(oe,{doc:s,index:y+d,onUpdate:a},s._id))}),!t&&e.jsx("div",{className:"w-full flex flex-row px-4 py-3 gap-8 border-t border-gray-100 bg-white mt-auto",children:e.jsx(ae,{count:h,counts:B,currentPage:p,totalPages:j,onChangeCount:R,goToPage:U})})]}),l&&!t&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(u,{label:"GENERATE",onClick:V})})]})}function oe({doc:o,index:l,onUpdate:n}){const[,t]=A(),a=()=>{S(e.jsx(k,{onDone:D,initial:{question:o.question||"",content:o.content||"",_id:o._id},onUpdate:n}),{showCloseButton:!0,width:"700px"})},i=async c=>{console.log("Deleting document with ID:",c),await Y(c)};return e.jsxs("div",{className:v("w-full flex flex-row px-4 py-3 gap-8 border-b border-gray-100",{"bg-white":l%2!==0,"bg-[#f7f7f7]":l%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!o.question&&e.jsx("span",{className:"font-normal text-md",children:o.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:o.content}),!!o.sourceDocument&&t?.trainingMedia?.length>0&&e.jsx(ne,{document:o,trainingMedia:t.trainingMedia})]}),e.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[e.jsx(u,{icon:e.jsx(z,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>i(o._id)}),e.jsx(u,{icon:e.jsx(M,{height:24,width:24}),type:"plain",className:"me-8",onClick:a})]})]})}function ne({document:o,trainingMedia:l}){const n=o.sourceDocument,t=m.useMemo(()=>{if(!l||!n)return null;const a=l.find(c=>c.docId===n);if(!a)return null;let i="";return a.url?i=decodeURIComponent(a.url.substring(a.url.lastIndexOf("/")+1)):a.originalName&&(i=a.originalName),{...a,fileName:i}},[n,l]);return t?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),t.url?e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[t.fileName,t.name?` ( ${t.name} )`:""]}):e.jsx("span",{children:t.fileName||t.name||"Unknown Document"})]}):null}const ae=({count:o,counts:l,currentPage:n,totalPages:t,onChangeCount:a,goToPage:i})=>{const c=l.map(r=>({label:r,value:r}));return e.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 min-w-max",children:"Rows per page"}),e.jsx(H,{className:"border border-gray-300 rounded px-2 py-1",value:o,options:c,showClear:!1,onChange:r=>a(r)})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>i(1),disabled:n===1,children:"«"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>i(n-1),disabled:n===1,children:"‹"}),e.jsxs("span",{className:"px-2 text-sm font-medium",children:[n," of ",t||1]}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>i(n+1),disabled:n>=t||!t,children:"›"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>i(t),disabled:n>=t||!t,children:"»"})]})]})};export{Ae as default};
