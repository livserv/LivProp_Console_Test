import{b as x,R as M,f as O,e as h,r as m,j as t}from"./index-CVL0-hNc.js";import{c as v}from"./Button-BKq5faa-.js";import{S as G}from"./delete-Dfn_0AB-.js";import{S as T}from"./edit-BynJfBV_.js";import{S as U}from"./plus-8PJ0HUL1.js";import{j as V,g as y,r as W,p as H}from"./ajax-9LNCspkD.js";import{B as b}from"./Button-Ba0cKsAg.js";import{S as Q}from"./TextBox-YKccQnrh.js";import{s as L,h as I}from"./utils-B3TvvZ68.js";import{a as J}from"./bots-Cqw05y99.js";import{u as D}from"./useSelectedBot-BORqnzZa.js";import{P as X}from"./PageHeader-C9H4KKsr.js";import{S as Y}from"./send-t5QxApCR.js";import{F as Z,a as P,d as ee}from"./index-Dhs6iMNn.js";const d=O(()=>({page:1,rowsPerPage:10,totalDocs:0,docsList:[],isLoading:!1,kbDocs:{}}));function te(){const s=x(i=>i.organizationId),[a]=D();M.useEffect(()=>{se()},[a,s]);const o=d(i=>i.docsList),e=d(i=>i.isLoading);return[o,e]}async function se(s=1,a=10){const{organizationId:o}=x.getState(),{selectedBotId:e}=h.getState();if(!o||!e)return;const{botId:i}=d.getState(),n={page:s,rowsPerPage:a,isLoading:!0};i!==e&&(n.docsList=[]),d.setState(n);const c=await V.get(`/bot/${o}/${e}/knowledge-base/list`);d.setState({botId:e,docsList:c,totalDocs:c.length,isLoading:!1})}async function De(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState(),{kbDocs:e}=d.getState(),i=await y(`/bot/${o}/${a}/knowledge-base/list`);d.setState(n=>({kbDocs:{...n.docsList||{},[String(a)]:i}}))}async function oe(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState();if(!a)throw new Error("No bot selected");const e=await H(`/bot/${o}/${a}/knowledge-base`,s);return d.setState(i=>{const n=[...i.docsList||[]];if(!Array.isArray(n))return{docsList:[e],totalDocs:1};if(s._id){const c=n.findIndex(l=>l._id===e._id);c>=0?n[c]=e:n.push(e)}else n.push(e);return{docsList:n,totalDocs:n.length}}),e}async function ne(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState();if(!a)throw new Error("No bot selected");await W(`/bot/${o}/${a}/knowledge-base/${s}`,s),d.setState(e=>{const n=[...e.docsList||[]].filter(c=>c._id!==s);return{docsList:n,totalDocs:n.length}})}async function Ce(s){if(!(s!=null&&s.length))return[];const{organizationId:a}=x.getState(),{selectedBotId:o}=h.getState();return await y(`/bot/${a}/${o}/knowledge-base/list?${s.map(e=>`docIds=${e}`).join("&")}`)}function k({onDone:s,initial:a}){const[o,e]=m.useState(a||{question:"",content:"",_id:""}),i=(c,l)=>{e(f=>({...f,[c]:l}))},n=async()=>{await oe(o),s()};return t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),t.jsxs(Z,{value:o,onChange:e,children:[t.jsx(P,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:c=>i("question",c)}),t.jsx(ee,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:c=>i("content",c)})]}),t.jsx("div",{className:"text-center",children:t.jsx(b,{icon:t.jsx(Y,{}),size:"lg",type:"rounded",onClick:n,className:"bg-[#49d4a1]"})})]})}function ae(s){const{activeIndex:a,onNavigate:o=()=>{},docsList:e}=s,[i]=D(),[n,c]=te(),l=e??n,[f,B]=m.useState(10),[g,j]=m.useState(1),[w,A]=m.useState(""),$=[10,15,20,25],S=(l||[]).filter(r=>{var u,C;return!w||((u=r.question)==null?void 0:u.toLowerCase().includes(w.toLowerCase()))||((C=r.content)==null?void 0:C.toLowerCase().includes(w.toLowerCase()))}),p=Math.ceil(S.length/f),N=(g-1)*f,E=N+f,_=S.slice(N,E),q=()=>I(),R=()=>L(t.jsx(k,{onDone:q}),{showCloseButton:!0,width:"700px"});m.useEffect(()=>{g>p&&j(1)},[S.length,p,g]);const z=r=>{const u=typeof r=="string"?parseInt(r,10):r;typeof u=="number"&&!isNaN(u)&&(B(u),j(1))},F=r=>{r<1||r>p||j(r)},K=async()=>{try{const r=await J(i,{verificationStatus:!0});console.log("Bot verification response:",r),a&&o(a+1)}catch(r){console.error("Error during bot verification:",r)}};return t.jsxs("div",{className:"flex flex-col min-h-full",children:[!e&&!a&&t.jsx("div",{className:"mb-4",children:t.jsx(X,{title:"Chat Bot Knowledge",icon:U,search:!0,onSearchChange:A,onClick:R})}),t.jsxs("div",{className:v("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":c}),children:[t.jsx("div",{className:"flex-1",children:_.map((r,u)=>t.jsx(ie,{doc:r,index:N+u},r._id))}),!e&&t.jsx("div",{className:"w-full flex flex-row px-4 py-3 gap-8 border-t border-gray-100 bg-white mt-auto",children:t.jsx(re,{count:f,counts:$,currentPage:g,totalPages:p,onChangeCount:z,goToPage:F})})]}),a&&!e&&t.jsx("div",{className:"flex mt-6 justify-end",children:t.jsx(b,{label:"GENERATE",onClick:K})})]})}function ie({doc:s,index:a}){var n;const[,o]=D(),e=()=>{L(t.jsx(k,{onDone:I,initial:{question:s.question||"",content:s.content||"",_id:s._id}}),{showCloseButton:!0,width:"700px"})},i=async c=>{console.log("Deleting document with ID:",c),await ne(c)};return t.jsxs("div",{className:v("w-full flex flex-row px-4 py-3 gap-8 border-b border-gray-100",{"bg-white":a%2!==0,"bg-[#f7f7f7]":a%2===0}),children:[t.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!s.question&&t.jsx("span",{className:"font-normal text-md",children:s.question}),t.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:s.content}),!!s.sourceDocument&&((n=o==null?void 0:o.trainingMedia)==null?void 0:n.length)>0&&t.jsx(ce,{document:s,trainingMedia:o.trainingMedia})]}),t.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[t.jsx(b,{icon:t.jsx(G,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>i(s._id)}),t.jsx(b,{icon:t.jsx(T,{height:24,width:24}),type:"plain",className:"me-8",onClick:e})]})]})}function ce({document:s,trainingMedia:a}){const o=s.sourceDocument,e=m.useMemo(()=>{if(!a||!o)return null;const i=a.find(c=>c.docId===o);if(!i)return null;let n="";return i.url?n=decodeURIComponent(i.url.substring(i.url.lastIndexOf("/")+1)):i.originalName&&(n=i.originalName),{...i,fileName:n}},[o,a]);return e?t.jsxs("span",{className:"text-[8px]",children:[t.jsx("strong",{className:"me-1",children:"Source Document:"}),e.url?t.jsxs("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[e.fileName,e.name?` ( ${e.name} )`:""]}):t.jsx("span",{children:e.fileName||e.name||"Unknown Document"})]}):null}const re=({count:s,counts:a,currentPage:o,totalPages:e,onChangeCount:i,goToPage:n})=>{const c=a.map(l=>({label:l,value:l}));return t.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"mr-2 min-w-max",children:"Rows per page"}),t.jsx(Q,{className:"border border-gray-300 rounded px-2 py-1",value:s,options:c,showClear:!1,onChange:l=>i(l)})]}),t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(1),disabled:o===1,children:"«"}),t.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(o-1),disabled:o===1,children:"‹"}),t.jsxs("span",{className:"px-2 text-sm font-medium",children:[o," of ",e||1]}),t.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(o+1),disabled:o>=e||!e,children:"›"}),t.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(e),disabled:o>=e||!e,children:"»"})]})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{ae as K,Ce as a,ve as b,De as g,d as u};
