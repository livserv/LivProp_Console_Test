import{c as w,j as e,r as h}from"./index-ZI2lrJcY.js";import{B as C}from"./Button-D45EhMo3.js";import{p as M}from"./ajax-Dn8TPa60.js";import{f as L}from"./bots-DHKao2_m.js";import{u as U}from"./useSelectedBot-03EZdpiB.js";import{P as F}from"./PageHeader-C1z49-Kx.js";import"./env-CmL5wTXD.js";import"./TextBox-STMLrBrV.js";import"./organization-sXdgI3IG.js";const z="/assets/media-image-ClRAX5XZ.png";async function B(t,i,x){const n=await M(`/bot/${i}/${x}/delete-conversation-media`,t),{conversationMedia:o}=n;L(x,{conversationMedia:o})}async function D(t,i,x){const n=new FormData;n.append("file",t);const o=await M(`/bot/${x}/${i}/upload-conversation-media`,n),{conversationMedia:r}=o;L(i,{conversationMedia:r})}function K(t){const{mimeType:i,selectedFiles:x,handleSelection:n}=t,[o,r]=U(),u=r==null?void 0:r.conversationMedia,l=w(p=>p.organizationId);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{title:"Conversation Media"}),e.jsx($,{organizationId:l,botId:o,mimeType:i}),e.jsx(W,{botId:o,organizationId:l,conversationMediaList:u,mimeType:i,handleSelection:n,selectedFiles:x})]})}function $({organizationId:t,botId:i,mimeType:x=".png,.jpeg,.jpg,.mpeg,.mp4,.pdf"}){var k;const[n,o]=h.useState(!1),[r,u]=h.useState(null),[l,p]=h.useState(!1),[g,c]=h.useState({}),s=h.useRef(null),d=w(m=>m.conversationMediaUpdate),f=(k=w(m=>m.botsList).find(m=>m._id===i))==null?void 0:k.conversationMedia,v=()=>{o(!0)},y=(m,j,b)=>{console.log(`${m.toUpperCase()}: ${j} - ${b}`)},N=m=>{var b;const j=(b=m.target.files)==null?void 0:b[0];j&&(j.size>5242880?(c({file:`Maximum allowed file size is ${5242880/1048576} MB`}),u(null)):(c({}),u(j)))},S=async m=>{if(m.preventDefault(),!r){c({file:"File is not selected"});return}try{(f==null?void 0:f.some(b=>b.name===r.name))?y("error","File Upload","The file already uploaded! Please select another file"):(p(!0),await D(r,i,t),o(!1),u(null),s.current&&(s.current.value=""),y("success","File Upload","The file uploaded successfully!"))}catch{y("error","File Upload","Not able to upload the file. Try after sometime!")}finally{p(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[d&&e.jsx(C,{type:"primary",size:"lg",label:"Save Changes",disabled:!1}),e.jsx("button",{onClick:v,className:"bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-colors duration-200",title:"Upload Conversation Media",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Upload Conversation Media"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("form",{onSubmit:S,className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Upload Media (*.png,*.jpeg,*.jpg,*.mpeg,*.mp4,*.pdf)"}),r&&e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Selected File: ",r.name]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{ref:s,type:"file",onChange:N,accept:x,className:"hidden"}),e.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-md px-4 py-2 text-center cursor-pointer transition-colors",children:"Select File"})]}),e.jsx(C,{type:"primary",size:"md",label:l?"Uploading...":"Upload",disabled:l||!r,htmlType:"submit"})]}),g.file&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:g.file})]})})]})})]})}function W({conversationMediaList:t,botId:i,organizationId:x,handleSelection:n,selectedFiles:o,mimeType:r}){const u=(c,s)=>c?c.filter(d=>{const{type:a}=d;return s?s==="application/pdf"?a===s:s==="image/*"?a.startsWith("image/"):s==="video/*"?a.startsWith("video/"):!1:!0}):[],[l,p]=h.useState([]);h.useEffect(()=>{const s=u(t,r).map(d=>({...d,isSelected:o?o.some(a=>a.url===d.url):!1}));p(s)},[t,o,r]);const g=c=>{const s=l.map(d=>d.url===c.url?{...d,isSelected:!d.isSelected}:d);p(s),n==null||n(s)};return e.jsxs("div",{children:[l&&l.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-yellow-500 mb-2",children:e.jsx("svg",{className:"w-10 h-10 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("p",{className:"text-red-600 text-sm",children:"Conversation Media and Keywords are not uploaded!"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:l.map((c,s)=>e.jsx(T,{media:c,botId:i,organizationId:x,onToggleSelection:g,handleSelection:n},s))})]})}function T({media:t,botId:i,organizationId:x,onToggleSelection:n,handleSelection:o}){const[r,u]=h.useState(!1),l=(a,f,v)=>{console.log(`${a.toUpperCase()}: ${f} - ${v}`)},p=a=>{window.open(a)},g=async(a,f,v,y)=>{try{await B({fileName:f,fileUrl:a},y,v),l("success","File Delete","The file deleted successfully!"),u(!1)}catch{l("error","Delete File","Not able to delete the file. Try after sometime!")}},c=()=>{navigator.clipboard.writeText(t.url).then(()=>{l("success","Copy URL","Image URL copied to clipboard!")})},s=()=>{n(t)},d=()=>{const a=t.type.split("/")[0];return a==="image"?e.jsxs("a",{href:t.url,rel:"noreferrer",target:"_blank",title:t.name,className:"block text-center",children:[e.jsx("img",{src:t.url,alt:t.name,className:"max-h-24 mx-auto object-contain"}),e.jsx("p",{className:"font-semibold text-xs mt-2 truncate max-w-[100px]",children:t.name})]}):a==="application"?e.jsxs("a",{href:t.url,rel:"noreferrer",target:"_blank",title:t.name,className:"block text-center",children:[e.jsx("img",{src:z,alt:"Document",className:"max-h-24 mx-auto object-contain"}),e.jsx("p",{className:"font-semibold text-xs mt-2 truncate max-w-[100px]",children:t.name})]}):e.jsxs("video",{controls:!0,className:"max-w-full mx-auto",children:[e.jsx("source",{src:t.url,type:"video/mp4"}),e.jsx("track",{kind:"captions",src:"",srcLang:"en",label:"English"}),"Your browser does not support the video tag."]})};return e.jsxs("div",{className:`bg-white border rounded-lg shadow-sm transition-all duration-200 ${t.isSelected?"border-blue-500 bg-blue-50":"border-gray-200 hover:shadow-md"}`,children:[e.jsx("div",{className:"p-4 min-h-[120px] max-h-[135px] flex items-center justify-center",children:d()}),e.jsx("div",{className:"p-2 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[e.jsx("button",{onClick:()=>u(!0),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded text-xs flex items-center justify-center",title:"Delete File",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("button",{onClick:()=>p(t.url),className:"bg-blue-600 hover:bg-blue-700 text-white p-2 rounded text-xs flex items-center justify-center",title:"View File",children:e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsx("button",{onClick:c,className:"bg-gray-600 hover:bg-gray-700 text-white p-2 rounded text-xs flex items-center justify-center",title:"Copy URL",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o&&e.jsx("button",{onClick:s,className:`p-2 rounded text-xs flex items-center justify-center ${t.isSelected?"bg-green-600 hover:bg-green-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,title:"Select File",children:t.isSelected?e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})})})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Delete file?"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Confirm the deletion of ",t.name,"?"]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>g(t.url,t.name,i,x),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]})})]})}export{K as default};
