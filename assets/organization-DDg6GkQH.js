import{g,p as f,j as l}from"./ajax-O4xclg-c.js";import{b as i,e as S}from"./index-BjyquQqj.js";async function b(e,t){const a=await d(),{organizationId:s}=i.getState();return e?e!==s&&i.setState({organizationId:e}):e=s,e&&(a||await y(e),await p(e,t)),!0}async function d(){const e=i.getState();let{organizationList:t,organizationId:a,organization:s}=e;if(!(!e.isSuperUser||Array.isArray(t))){if(t=await f("/organization/list",null),t!=null&&t.length)if(a=a||sessionStorage.getItem("orgId"),a)s||(s=t==null?void 0:t.filter(n=>n._id===a)[0]);else{const n=t[0];a=n._id,s=n}return i.setState({organizationList:t,organizationId:a,organization:s}),!0}}async function m(e,t){t||(t=i.getState().organizationId);const a=await l(`/organization/${t}`,e);i.setState(s=>{const{organizationList:n,organizationId:o,organization:u}=s,r={};return o===t&&(r.organization={...u,...a}),n&&(r.organizationList=n.map(c=>c._id===t?{...c,...a}:c)),r})}function z(e){if(!e||typeof e!="object")return;let{organization:t}=i.getState();t&&(t={...t,...e},i.setState({organization:t}))}async function p(e,t){var o;const a=await g(`/bot/${e}/list`),s=t||((o=a[0])==null?void 0:o._id),n=a.reduce((u,r)=>(u[r._id]=r,u),{});return i.setState({organizationId:e}),S.setState({botsList:a,botsMap:n,selectedBotId:s}),s}async function y(e){const t=await f("/organization/get-organization-by-id",{organizationId:e});i.setState({organization:t})}function B(e){S.setState({selectedBotId:e})}export{m as a,p as b,b as l,B as s,z as u};
