import{j as e,h as N,p as ue,m as fe,r as K,c as V,u as xe,R as be}from"./AlertSnackbar-Bg-JJn4T.js";import{F as q,a as he}from"./formik.esm-i_laJiGP.js";import{c as D,a as T,d as se,e as O,f as ye,g as ge}from"./index.esm-BsghAU9u.js";import{B as v}from"./Button-BttHeqAG.js";import{m as Ce}from"./index-B48b7GnV.js";import"./Button-NNSQHuwk.js";import{T as k}from"./TextBox-BmmLi5UC.js";import{a as Ne,b as oe,d as ve,g as je}from"./integrations-_X2v-uI6.js";import{w as re}from"./env-CBDBHzQq.js";import{P as ke}from"./ProgressButton-Dv7Av4Su.js";import{w as Q}from"./env-CmL5wTXD.js";import{s as R}from"./utils-BPLOM7gE.js";import{C as H}from"./ConfirmDialog-DymsjHlL.js";import{u as we}from"./organization-CIVrCXCQ.js";import{S as Ie}from"./cancel-Dx84oIux.js";import{S as Te}from"./link-Be8HVrO9.js";import{S as Ue}from"./plus-BpgRU9-g.js";import{S as Se}from"./SpeedDial-Dk3UHClS.js";import{S as Y}from"./whatsapp-Cllp2D4q.js";import{u as Pe}from"./useSelectedBot-CX7YTqP_.js";import{P as De}from"./PageHeader-CQCm4-5c.js";import"./LabelWrapper-D8qjrIKZ.js";import"./SelectBox-CVZhpQlv.js";function ne({botId:t,organizationId:l,setPopUpDialog:y}){const c=async(m,{setErrors:f,setStatus:n,setSubmitting:a})=>{try{const i={botId:t,organizationId:l,callbackURL:m.crmCallBackUrl,channelId:"CRM_Callback_123",channelName:"CRM_Callback"};await Ne(i),n({success:!0}),a(!0),y(!1),N(!0,"The CRM callback url added successfully!","success")}catch(i){n({success:!1}),f({submit:i.message}),a(!1),N(!0,"Not able to CRM callback url. Try after sometime!","error")}};return e.jsx("div",{className:"w-full",children:e.jsx(q,{initialValues:{crmCallBackUrl:"",submit:""},validationSchema:D().shape({crmCallBackUrl:T().url("Enter valid url!").required("CRM Callback URL is required"),submit:T()}),onSubmit:c,children:({errors:m,handleBlur:f,handleChange:n,handleSubmit:a,isSubmitting:i,touched:d,values:g})=>e.jsxs("form",{noValidate:!0,onSubmit:a,children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(k,{label:"CRM callback URL",id:"crmCallBackUrl",type:"url",name:"crmCallBackUrl",value:g.crmCallBackUrl,onBlur:f,onChange:n,autoComplete:"off",className:d.crmCallBackUrl&&m.crmCallBackUrl?"border-red-500":""}),d.crmCallBackUrl&&m.crmCallBackUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:m.crmCallBackUrl})]}),m.submit&&e.jsx("div",{className:"text-red-600 text-xs mb-2",children:m.submit}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{disabled:i,isLoading:i,htmlType:"submit",type:"primary",size:"lg",label:i?"Adding...":"Add"})})]})})})}var A={},z,ee;function Re(){return ee||(ee=1,z=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var l=document.activeElement,y=[],c=0;c<t.rangeCount;c++)y.push(t.getRangeAt(c));switch(l.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":l.blur();break;default:l=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||y.forEach(function(m){t.addRange(m)}),l&&l.focus()}}),z}var M,ae;function Ae(){if(ae)return M;ae=1;var t=Re(),l={"text/plain":"Text","text/html":"Url",default:"Text"},y="Copy to clipboard: #{key}, Enter";function c(f){var n=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return f.replace(/#{\s*key\s*}/g,n)}function m(f,n){var a,i,d,g,b,o,h=!1;n||(n={}),a=n.debug||!1;try{d=t(),g=document.createRange(),b=document.getSelection(),o=document.createElement("span"),o.textContent=f,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(u){if(u.stopPropagation(),n.format)if(u.preventDefault(),typeof u.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var w=l[n.format]||l.default;window.clipboardData.setData(w,f)}else u.clipboardData.clearData(),u.clipboardData.setData(n.format,f);n.onCopy&&(u.preventDefault(),n.onCopy(u.clipboardData))}),document.body.appendChild(o),g.selectNodeContents(o),b.addRange(g);var I=document.execCommand("copy");if(!I)throw new Error("copy command was unsuccessful");h=!0}catch(u){a&&console.error("unable to copy using execCommand: ",u),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(n.format||"text",f),n.onCopy&&n.onCopy(window.clipboardData),h=!0}catch(w){a&&console.error("unable to copy using clipboardData: ",w),a&&console.error("falling back to prompt"),i=c("message"in n?n.message:y),window.prompt(i,f)}}finally{b&&(typeof b.removeRange=="function"?b.removeRange(g):b.removeAllRanges()),o&&document.body.removeChild(o),d()}return h}return M=m,M}var te;function _e(){if(te)return A;te=1;function t(s){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t(s)}Object.defineProperty(A,"__esModule",{value:!0}),A.CopyToClipboard=void 0;var l=m(ue()),y=m(Ae()),c=["text","onCopy","options","children"];function m(s){return s&&s.__esModule?s:{default:s}}function f(s,r){var x=Object.keys(s);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(s);r&&(p=p.filter(function(C){return Object.getOwnPropertyDescriptor(s,C).enumerable})),x.push.apply(x,p)}return x}function n(s){for(var r=1;r<arguments.length;r++){var x=arguments[r]!=null?arguments[r]:{};r%2?f(Object(x),!0).forEach(function(p){S(s,p,x[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(x)):f(Object(x)).forEach(function(p){Object.defineProperty(s,p,Object.getOwnPropertyDescriptor(x,p))})}return s}function a(s,r){if(s==null)return{};var x=i(s,r),p,C;if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(s);for(C=0;C<j.length;C++)p=j[C],!(r.indexOf(p)>=0)&&Object.prototype.propertyIsEnumerable.call(s,p)&&(x[p]=s[p])}return x}function i(s,r){if(s==null)return{};var x={},p=Object.keys(s),C,j;for(j=0;j<p.length;j++)C=p[j],!(r.indexOf(C)>=0)&&(x[C]=s[C]);return x}function d(s,r){if(!(s instanceof r))throw new TypeError("Cannot call a class as a function")}function g(s,r){for(var x=0;x<r.length;x++){var p=r[x];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}function b(s,r,x){return r&&g(s.prototype,r),Object.defineProperty(s,"prototype",{writable:!1}),s}function o(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(r&&r.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),r&&h(s,r)}function h(s,r){return h=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},h(s,r)}function I(s){var r=W();return function(){var p=U(s),C;if(r){var j=U(this).constructor;C=Reflect.construct(p,arguments,j)}else C=p.apply(this,arguments);return u(this,C)}}function u(s,r){if(r&&(t(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(s)}function w(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function W(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function U(s){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(x){return x.__proto__||Object.getPrototypeOf(x)},U(s)}function S(s,r,x){return r in s?Object.defineProperty(s,r,{value:x,enumerable:!0,configurable:!0,writable:!0}):s[r]=x,s}var _=(function(s){o(x,s);var r=I(x);function x(){var p;d(this,x);for(var C=arguments.length,j=new Array(C),P=0;P<C;P++)j[P]=arguments[P];return p=r.call.apply(r,[this].concat(j)),S(w(p),"onClick",function(F){var E=p.props,X=E.text,J=E.onCopy,ce=E.children,me=E.options,L=l.default.Children.only(ce),pe=(0,y.default)(X,me);J&&J(X,pe),L&&L.props&&typeof L.props.onClick=="function"&&L.props.onClick(F)}),p}return b(x,[{key:"render",value:function(){var C=this.props;C.text,C.onCopy,C.options;var j=C.children,P=a(C,c),F=l.default.Children.only(j);return l.default.cloneElement(F,n(n({},P),{},{onClick:this.onClick}))}}]),x})(l.default.PureComponent);return A.CopyToClipboard=_,S(_,"defaultProps",{onCopy:void 0,options:void 0}),A}var G,le;function Ee(){if(le)return G;le=1;var t=_e(),l=t.CopyToClipboard;return l.CopyToClipboard=l,G=l,G}var B=Ee();const Z=fe(B);function ie({botId:t,organizationId:l,setPopUpDialog:y,gupshupIntegrationObj:c,edit:m}){const f=async(a,{setErrors:i,setStatus:d,setSubmitting:g})=>{try{let b=a;const o=c?._id;c&&(b={...a,objId:o}),await oe(b),d({success:!0}),g(!0),y(!1),N(!0,"The Gupshup integration added successfully!","success")}catch(b){d({success:!1}),i({submit:b.message}),g(!1),N(!0,"Not able to activate Gupshup integration. Try after sometime!","error")}};function n(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(q,{initialValues:{webHookUrl:`${re}/gupshup/${l}/${t}/entrypoint`,appId:c?.appId||"",appName:c?.appName||"",phoneNumberId:c?.phoneNumberId||"",channelId:"gupshup_123",channelName:"gupshup",leadCategory:c?.leadCategory||"preSale",leadUpgradeToPreSaleCount:c?.leadUpgradeToPreSaleCount||"",submit:""},validationSchema:D().shape({appId:T().required("App ID is required"),appName:T().required("App name is required"),phoneNumberId:O().min(10,"Please enter a valid phone number id").required("Phone number is required"),leadUpgradeToPreSaleCount:se().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||typeof a=="number"&&a>0)}),onSubmit:f,children:({errors:a,handleBlur:i,handleChange:d,handleSubmit:g,isSubmitting:b,touched:o,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:g,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Gupshup Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Z,{text:h.webHookUrl,onCopy:()=>N(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:d,autoComplete:"off",disabled:!0,onKeyDown:n,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),o.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"Gupshup App ID *"}),e.jsx(k,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:I=>d(I.target.value),autoComplete:"off",onKeyDown:n,className:o.appId&&a.appId?"border-red-500":""}),o.appId&&a.appId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.appId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"Gupshup App Name *"}),e.jsx(k,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.appName&&a.appName?"border-red-500":""}),o.appName&&a.appName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number *"}),e.jsx(k,{id:"phoneNumberId",name:"phoneNumberId",type:"number",value:h.phoneNumberId,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),o.phoneNumberId&&a.phoneNumberId&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.phoneNumberId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.phoneNumberId})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:d,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),o.leadCategory&&a.leadCategory&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadCategory})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(k,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:typeof a.leadUpgradeToPreSaleCount=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.leadUpgradeToPreSaleCount})})]})]}),a.submit&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(v,{disabled:b,isLoading:b,htmlType:"submit",type:"primary",size:"lg",label:m?"Edit":"Add"})})]})})})}function Le(t,l){return btoa(`${t}_${l}_whatsapp_int`)}function de({botId:t,organizationId:l,setPopUpDialog:y,whatsappIntegrationObj:c,edit:m}){const f=async(a,{setErrors:i,setStatus:d,setSubmitting:g})=>{try{let b=a;const o=c?._id;o&&(b={...a,objId:o}),await oe(b),d({success:!0}),g(!0),y(!1),N(!0,"The WhatsApp integration added successfully!","success")}catch(b){d({success:!1}),i({submit:b.message}),g(!1),N(!0,"Not able to activate WhatsApp integration. Try after sometime!","error")}};function n(a){a.key==="Enter"&&a.preventDefault()}return e.jsx("div",{className:"w-full",children:e.jsx(q,{initialValues:{webHookUrl:`${re}/whatsapp/${l}/${t}/entrypoint`,webHookSecret:Le(l,t),appId:c?.appId||"",appName:c?.appName||"",phoneNumberId:c?.phoneNumberId||"",verificationToken:c?.verificationToken||"",channelId:"whatsapp_123",channelName:"whatsapp",leadCategory:c?.leadCategory||"preSale",leadUpgradeToPreSaleCount:c?.leadUpgradeToPreSaleCount||"",submit:""},validationSchema:D().shape({appId:O().required("App ID must be a number"),appName:T().required("App name is required"),phoneNumberId:O().min(10,"Please enter a valid phone number id").required("Phone number is required"),verificationToken:T().required("Access Token  is required"),leadUpgradeToPreSaleCount:se().test("is-null-or-positive","Categorize to Presale after no of conversations must be greater than 0",a=>a==null||!isNaN(Number(a))&&Number(a)>0)}),onSubmit:f,children:({errors:a,handleBlur:i,handleChange:d,handleSubmit:g,isSubmitting:b,touched:o,values:h})=>e.jsxs("form",{noValidate:!0,onSubmit:g,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookUrl",children:"Webhook Callback URL *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Z,{text:h.webHookUrl,onCopy:()=>N(!0,"Webhook Callback URL copied to clipboard","success"),children:e.jsx("input",{id:"webHookUrl",type:"url",value:h.webHookUrl,name:"webHookUrl",onBlur:i,onChange:d,autoComplete:"off",disabled:!0,onKeyDown:n,className:"w-full border rounded px-3 py-2 bg-gray-100"})})}),o.webHookUrl&&a.webHookUrl&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookUrl})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"webHookSecret",children:"Webhook Verify token *"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Z,{text:h.webHookSecret,onCopy:()=>N(!0,"Webhook Verify Token copied to clipboard","success"),children:e.jsx("input",{id:"webHookSecret",type:"text",value:h.webHookSecret,name:"webHookSecret",onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:"w-full border rounded px-3 py-2 bg-gray-100",disabled:!0})})}),o.webHookSecret&&a.webHookSecret&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.webHookSecret})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appId",children:"App ID *"}),e.jsx(k,{id:"appId",name:"appId",value:h.appId,onBlur:i,onChange:d,onKeyDown:n,className:o.appId&&a.appId?"border-red-500":""}),o.appId&&a.appId&&typeof a.appId=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"appName",children:"App Name *"}),e.jsx(k,{id:"appName",name:"appName",value:h.appName,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.appName&&a.appName?"border-red-500":""}),o.appName&&a.appName&&a.appName==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.appName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"phoneNumberId",children:"Phone Number ID *"}),e.jsx(k,{id:"phoneNumberId",name:"phoneNumberId",type:"text",value:h.phoneNumberId,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.phoneNumberId&&a.phoneNumberId?"border-red-500":""}),o.phoneNumberId&&a.phoneNumberId&&a.phoneNumberId==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"verificationToken",children:"Access Token *"}),e.jsx(k,{id:"verificationToken",name:"verificationToken",type:"text",value:h.verificationToken,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.verificationToken&&a.verificationToken?"border-red-500":""}),o.verificationToken&&a.verificationToken&&typeof a.verificationToken=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.verificationToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadCategory",children:"Initial Lead Category"}),e.jsxs("select",{id:"leadCategory",name:"leadCategory",value:h.leadCategory||"preSale",onBlur:i,onChange:d,className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"preSale",children:"Presale"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"others",children:"Others"})]}),o.leadCategory&&a.leadCategory&&typeof a.leadCategory=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadCategory})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",htmlFor:"leadUpgradeToPreSaleCount",children:"Categorize to Presale after conversations"}),e.jsx(k,{id:"leadUpgradeToPreSaleCount",name:"leadUpgradeToPreSaleCount",value:h.leadUpgradeToPreSaleCount,onBlur:i,onChange:d,autoComplete:"off",onKeyDown:n,className:o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount?"border-red-500":""}),o.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount&&a.leadUpgradeToPreSaleCount==="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:a.leadUpgradeToPreSaleCount})]})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ke,{isLoading:b,disabled:b,type:"submit",children:m?"Edit":"Add"})})]})})})}function $({label:t,value:l,copyText:y,onCopy:c}){return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 my-3",children:[e.jsx("b",{className:"sm:min-w-[180px] text-sm sm:text-base",children:t}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap flex-1 font-mono text-xs sm:text-sm",title:l,children:l}),e.jsx(B.CopyToClipboard,{text:y||l,onCopy:c,children:e.jsx(v,{label:"Copy",type:"primary",style:{minWidth:60}})})]})]})}function $e({integrationObj:t}){const[l,y]=K.useState(!1),[c,m]=K.useState(!1),f=async(i,d)=>{try{await ve(i),N(!0,`The ${d} deleted successfully!`,"success")}catch{N(!0,`Not able to delete the ${d}. Try after sometime!`,"error")}},n=i=>{const d=new Date(i);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(d)};let a=null;if(t.channelName==="Webchat")a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-3",children:"Chat window Script Tag"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs sm:text-sm break-all flex-1",children:t.scriptTag}),e.jsx(B.CopyToClipboard,{text:t.scriptTag,onCopy:()=>N(!0,"chat script copied to clipboard","success"),children:e.jsx(v,{label:"Copy",type:"primary",style:{width:"100%",maxWidth:"120px"}})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:n(t.integratedAt)})]})]});else if(t.channelName==="whatsapp"){const i=`${Q}/whatsapp/${t.organizationId}/${t.botId}/${t._id}/entrypoint`,d=Ce(t.organizationId,t.botId);a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx("div",{className:"font-bold text-lg",children:"WhatsApp Integration"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(v,{label:"Edit",type:"plain",onClick:()=>{R(e.jsx(de,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},whatsappIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(v,{label:"Delete",type:"plain",onClick:()=>m(!0)}),e.jsx(H,{title:"Delete Whatsapp integration?",open:c,setOpen:m,onConfirm:()=>f(t,"Whatsapp integration"),children:"Confirm the deletion of Whatsapp integration."})]})]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"Phone Number ID:"})," ",t.phoneNumberId]}),e.jsx($,{label:"Webhook Callback Url:",value:i,onCopy:()=>N(!0,"Web hook callback url copied to clipboard","success")}),e.jsx($,{label:"Webhook Verification Token:",value:d,onCopy:()=>N(!0,"Webhook Verification Token copied to clipboard","success")}),e.jsx($,{label:"Access Token:",value:t.verificationToken,onCopy:()=>N(!0,"Access Token copied to clipboard","success")}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:n(t.integratedAt)})]})]})}else if(t.channelName==="gupshup"){const i=`${Q}/gupshup/${t.organizationId}/${t.botId}/${t._id}/entrypoint`;a=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsx("div",{className:"font-bold text-lg",children:"Gupshup Integration"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(v,{label:"Edit",type:"plain",onClick:()=>{R(e.jsx(ie,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},gupshupIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}),e.jsx(v,{label:"Delete",type:"plain",onClick:()=>m(!0)}),e.jsx(H,{title:"Delete Gupshup integration?",open:c,setOpen:m,onConfirm:()=>f(t,"Gupshup integration"),children:"Confirm the deletion of Gupshup integration."})]})]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"App Name:"})," ",t.appName]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"App Id:"})," ",t.appId]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base break-all",children:[e.jsx("b",{children:"Phone Number:"})," ",t.phoneNumberId]}),e.jsx($,{label:"Webhook Callback Url:",value:i,onCopy:()=>N(!0,"Web hook callback url copied to clipboard","success")}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Initial Lead Category:"})," ",t.leadCategory||"preSales"]}),e.jsxs("div",{className:"mb-2 text-sm sm:text-base",children:[e.jsx("b",{children:"Categorize to Presale after no of conversations:"})," ",t.leadUpgradeToPreSaleCount||""]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:n(t.integratedAt)})]})]})}else t.channelName==="CRM_Callback"&&(a=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-lg mb-3",children:"CRM Callback URL"}),l?e.jsx(v,{label:"Edit",type:"plain",onClick:()=>{R(e.jsx(ne,{botId:t.botId,organizationId:t.organizationId,setPopUpDialog:()=>{},crmIntegrationObj:t,edit:!0}),{showCloseButton:!0,width:"700px"})}}):e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-3",children:[e.jsx("span",{className:"font-mono text-xs sm:text-sm break-all flex-1",children:t.callbackURL}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(v,{label:"Edit",type:"plain",onClick:()=>y(!0)}),e.jsx(v,{label:"Delete",type:"plain",onClick:()=>m(!0)}),e.jsx(B.CopyToClipboard,{text:t.callbackURL,onCopy:()=>N(!0,"CRM callback URL copied to clipboard","success"),children:e.jsx(v,{label:"Copy",type:"primary"})})]}),e.jsx(H,{title:"Delete CRM callback URL?",open:c,setOpen:m,onConfirm:()=>f(t,"crm callback url"),children:"Confirm the deletion of CRM callback URL."})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-semibold",children:"Integrated At: "}),e.jsx("span",{className:"text-sm",children:n(t.integratedAt)})]})]}));return e.jsx("div",{className:"bg-white rounded shadow p-4 mb-4",children:a})}function Be({admins:t,index:l,handleBlur:y,handleChange:c,errors:m,touched:f,remove:n}){return e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(k,{label:"Admin Name",id:`admins.${l}.adminName`,name:`admins.${l}.adminName`,type:"text",value:t.adminName,onBlur:y,onChange:c,autoComplete:"off",disabled:l===0,className:l!==0&&f.admins?.[l]?.adminName&&m.admins?.[l]?.adminName?"border-red-500":""}),l!==0&&f.admins?.[l]?.adminName&&m.admins?.[l]?.adminName&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:m.admins[l].adminName})]}),e.jsxs("div",{className:"flex-1 min-w-[120px]",children:[e.jsx(k,{label:"Role",id:`admins.${l}.role`,name:`admins.${l}.role`,type:"text",value:t.role,onBlur:y,onChange:c,autoComplete:"off",disabled:l===0,className:l!==0&&f.admins?.[l]?.role&&m.admins?.[l]?.role?"border-red-500":""}),l!==0&&f.admins?.[l]?.role&&m.admins?.[l]?.role&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:m.admins[l].role})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(k,{label:"Email",id:`admins.${l}.email`,name:`admins.${l}.email`,type:"text",value:t.email,onBlur:y,onChange:c,autoComplete:"off",disabled:l===0,className:l!==0&&f.admins?.[l]?.email&&m.admins?.[l]?.email?"border-red-500":""}),l!==0&&f.admins?.[l]?.email&&m.admins?.[l]?.email&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:m.admins[l].email})]}),l!==0&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Delete"}),e.jsx(v,{type:"plain",label:"ðŸ—‘ï¸",className:"text-2xl text-red-600",onClick:()=>n(l)})]})]})})}function qe({organizationId:t}){const y={admins:V(a=>a.organization?.admins)||[],submit:""},c=new RegExp(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),m=D().shape({admins:ye().of(ge(a=>a.index===0?D().shape({}):D().shape({adminName:T().required("Admin Name is required"),role:T().required("Role is required"),email:T().trim().required("Email is required").email("Invalid email id").matches(c,"Invalid email id")})))}),f=a=>a.map((i,d)=>({...i,itemNo:d+1})),n=async(a,{setErrors:i,setStatus:d,setSubmitting:g})=>{try{const{submit:b,...o}=a;g(!0),await we(o,t),N(!0,"Lead email ids updated successfully","success"),d({success:!0})}catch(b){d({success:!1}),i({submit:b.message}),g(!1),N(!0,b.message,"error")}};return e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("strong",{children:"Lead emails are sending to below given email ids"}),e.jsx("br",{}),e.jsx("br",{})]}),e.jsx(q,{initialValues:y,onSubmit:n,validationSchema:m,children:({errors:a,handleBlur:i,handleChange:d,handleSubmit:g,touched:b,values:o,setFieldValue:h,isSubmitting:I})=>e.jsx("form",{onSubmit:g,children:e.jsx(he,{name:"admins",children:({push:u,remove:w})=>e.jsxs(e.Fragment,{children:[o.admins.map((W,U)=>e.jsx(Be,{admins:W,index:U,handleBlur:i,handleChange:d,errors:a,touched:b,remove:S=>{w(S);const _=f(o.admins.filter((s,r)=>r!==S));h("admins",_)}},U)),e.jsxs("div",{className:"flex flex-wrap justify-end gap-4 mt-4",children:[e.jsx(v,{type:"secondary",className:"ml-2",onClick:()=>{u({adminName:"",role:"",email:""})},label:"Add Email"}),e.jsx(v,{type:"primary",className:"ml-2",disabled:I,isLoading:I,htmlType:"submit",label:"Save Changes"})]}),typeof a.submit=="string"&&e.jsx("div",{className:"text-red-600 text-xs mt-2",children:a.submit})]})})})})]})}function da(){const[t]=Pe(),l=xe(u=>u.botsList),y=V(u=>u.organizationId),c=V(u=>u.isSuperUser),[m,f]=K.useState(!1);be.useEffect(()=>{(async()=>{const w={organizationId:y,botId:t};try{await je(w)}catch{N(!0,"Not able to fetch integrations details. Try after sometime!","error")}})()},[t,y]);const n=l.find(u=>u._id===t)?.integrations;let a=null,i=null,d=null;n!==void 0&&(a=n.find(u=>u.channelName==="CRM_Callback"),i=n.find(u=>u.channelName==="whatsapp"),d=n.find(u=>u.channelName==="gupshup"));const g=()=>{R(i?e.jsx("div",{children:"The Whatsapp integration already configured."}):e.jsx(de,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},b=()=>{R(a?e.jsx("div",{children:"The CRM Callback URL has been successfully configured."}):e.jsx(ne,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},o=()=>{R(d?e.jsx("div",{children:"The Gupshup integration already configured."}):e.jsx(ie,{botId:t,organizationId:y,setPopUpDialog:()=>{}}),{showCloseButton:!0,width:"500px"})},h=[{name:"WhatsApp Integration",icon:e.jsx(Y,{}),method:g},{name:"CRM Callback",icon:e.jsx(Te,{}),method:b},{name:"Gupshup Integration",icon:e.jsx(Y,{}),method:o}],I=c?h:h.filter(u=>u.name!=="Gupshup Integration");return e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4 relative",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(De,{title:"Integrations",icon:m?Ie:Ue,onClick:()=>f(u=>!u)}),e.jsx(Se,{actions:I,isOpen:m,onClose:()=>f(!1)})]})}),e.jsxs("div",{className:"space-y-4",children:[n&&n.map((u,w)=>u.channelId!=="callConnect_123"&&e.jsx($e,{integrationObj:u},w)),c&&e.jsx(qe,{organizationId:y})]})]})}export{da as default};
