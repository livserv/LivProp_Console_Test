import{f as _,j as a,b as C,e as N,R as f,r as F}from"./index-BjyquQqj.js";import{t as V,c as j,s as h,g as p,d as z,b as k,f as L}from"./ajax-O4xclg-c.js";import"./Button-6bMBa1_B.js";/* empty css                */import{T as R}from"./Table-DVwGFF8E.js";import{S as Y}from"./download-UDvzH0o4.js";import{B as U}from"./Button-xWVoz13c.js";import{S as y}from"./SelectButton-CZBMX1rR.js";import{P as W}from"./PageHeader-Bs-rHxpU.js";import"./TextBox-CU_W52Of.js";import"./organization-DDg6GkQH.js";import"./useSelectedBot-CLgcYbP9.js";function S(e,t,s){const r=V(e,s==null?void 0:s.in);return isNaN(t)?j(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function T(e,t,s){const r=V(e,s==null?void 0:s.in);if(isNaN(t))return j(e,NaN);const i=r.getDate(),o=j(e,r.getTime());o.setMonth(r.getMonth()+t+1,0);const n=o.getDate();return i>=n?o:(r.setFullYear(o.getFullYear(),o.getMonth(),i),r)}function Z(e,t,s){return S(e,t*7,s)}function b(e,t){const s=V(e,t==null?void 0:t.in);return s.setHours(23,59,59,999),s}const d=_(()=>G());function G(e,t){const s=b(new Date);return{fromDate:h(T(s,-1)),toDate:s,organizationId:e,botId:t}}function q(){const e=d(s=>s.overview);if(!e)return;const t=a.jsx("div",{className:"w-[1px] bg-[#DCDCDC] my-auto h-20"});return a.jsxs("div",{className:"flex justify-between bg-white w-full rounded-md py-3 px-5 shadow-[0px_1px_4px_0px_#5653534D]",children:[a.jsx(x,{title:"Interactive Visitors",count:e.current.interactiveVisitors,diff:e.difference.interactiveVisitors,color:"#5FC303"}),t,a.jsx(x,{title:"Visitor Count",count:e.current.totalVisitors,diff:e.difference.totalVisitors,color:"#F9932D"}),t,a.jsx(x,{title:"Presale",count:e.current.preSale,diff:e.difference.preSale,color:"#DB6767"}),t,a.jsx(x,{title:"General",count:e.current.general,diff:e.difference.general,color:"#AC7BC4"}),t,a.jsx(x,{title:"Others",count:e.current.others,diff:e.difference.others,color:"#2187AD"})]})}function x({count:e,title:t,diff:s=0,color:r}){return a.jsxs("div",{className:"flex flex-col justify-around text-center w-[175px]",children:[a.jsx("span",{className:"text-[33px] leading-10",style:{color:r},children:e||0}),a.jsx("span",{className:"text-lg",children:t}),s<0&&a.jsxs("span",{className:"capitalize text-[9px] font-semibold",children:["You lost ",a.jsx("span",{style:{color:r},children:Math.abs(s)})," this time"]}),s>=0&&a.jsxs("span",{className:"capitalize text-[9px] font-semibold",children:["You made an extra ",a.jsx("span",{style:{color:r},children:s||0})," this time"]})]})}async function J(){const{organizationId:e}=C.getState(),{selectedBotId:t}=N.getState(),s=d.getState(),{organizationId:r,botId:i}=s;let{fromDate:o,toDate:n}=s;o=h(o),n=b(n),e===r&&t===i||d.setState(G(e,t),!0);const u=await p(`/analytics/${e}/${t}/dashboard/overview`,{fromDate:o,toDate:n}),v=Q(o,n);o=v.start,n=v.end;const l=await p(`/analytics/${e}/${t}/dashboard/overview`,{fromDate:o,toDate:n}),m={totalVisitors:(u.totalVisitors||0)-(l.totalVisitors||0),interactiveVisitors:(u.interactiveVisitors||0)-(l.interactiveVisitors||0),preSale:(u.preSale||0)-(l.preSale||0),general:(u.general||0)-(l.general||0),others:(u.others||0)-(l.others||0),revisit:(u.revisit||0)-(l.revisit||0)},w={interactiveVisitors:g(l.interactiveVisitors,m.interactiveVisitors),preSale:g(l.preSale,m.preSale),general:g(l.general,m.general),others:g(l.others,m.others),revisit:g(l.revisit,m.revisit)},c={current:u,previous:l,difference:m,diffPercentage:w};d.setState({overview:c})}async function M(e){const{organizationId:t}=C.getState(),{selectedBotId:s}=N.getState(),r=d.getState();let{visitorProps:i}=r;i={page:1,count:10,...i,...e},d.setState({visitorProps:i,visitorList:null,visitorsListTotal:0});const{total:o,visitorList:n}=await p(`/analytics/${t}/${s}/dashboard/visitors-list`,i);d.setState({visitorsListTotal:o,visitorList:n})}async function K(e){const{organizationId:t}=C.getState(),{selectedBotId:s}=N.getState(),{fromDate:r,toDate:i}=d.getState();d.setState({visitorGroupedList:null});const o=await p(`/analytics/${t}/${s}/dashboard/grouped/${e}`,{fromDate:r,toDate:i});d.setState({visitorGroupedList:o})}function Q(e,t){const s=z(t,e),r=S(e,-1),i=S(r,-s);return{start:h(i),end:b(r)}}function g(e,t){return!t||!e?0:parseFloat((t*100/e).toFixed(2))}const X=[{title:"Group",field:"group",sortable:!0},{title:"Visitor Count",field:"total",sortable:!0,hideBelow:"md"},{title:"Interactions",field:"totalInteractions",sortable:!0,hideBelow:"xs"},{title:"Pre-Sale",field:"preSale",sortable:!0},{title:"General",field:"general",sortable:!0},{title:"Others",field:"others",sortable:!0,hideBelow:"sm"}];function ee({group:e}){const t=f.useMemo(()=>X.map((i,o)=>({...i,title:o?i.title:e.label})),[e]),s=d(i=>i.visitorGroupedList)||[],r=d(i=>i.visitorsGroupedListTotal)||0;return f.useEffect(()=>{e&&K(e.value).catch(i=>console.log("Error loading visitor grouped list:-",i))},[e]),a.jsx(R,{columns:t,rows:s,totalRows:r})}const I=[{title:"Name",field:"name",sortable:!0},{title:"Email Id",field:"email",sortable:!0,hideBelow:"md"},{title:"Phone Number",field:"phoneNumber",sortable:!1},{title:"Country",field:"country",sortable:!0,hideBelow:"xl"},{title:"City",field:"city",sortable:!0,hideBelow:"lg"},{title:"Visit Time",field:"visitTime",sortable:!0,hideBelow:"xl",template:e=>k(e.visitTime)},{title:"Category",field:"category",sortable:!0,hideBelow:"lg"},{title:"Transcript",field:"transcriptUrl",sortable:!1,cellClassName:"text-center",headerClassName:"text-center",template:e=>a.jsx("a",{href:e.transcriptUrl,target:"_blank",rel:"noreferrer noopener",className:"text-xs border rounded px-3 py-1 text-center font-bold text-[#1F87AF] border-[#1E8EB9] bg-[#F6FDFF]",children:"View"})}];function te({dateRangeType:e}){const{visitorList:t,visitorsListTotal:s,fromDate:r,toDate:i,visitorProps:o}=d(),n=f.useMemo(()=>{const c=b(new Date);switch(e){case"today":return{fromDate:h(c),toDate:c};case"week":return{fromDate:h(Z(c,-1)),toDate:c};case"month":return{fromDate:h(T(c,-1)),toDate:c};default:return{fromDate:r,toDate:i}}},[e,r,i]),{count:B,page:u,orderBy:v,order:l}=o||{},m=f.useMemo(()=>I.find(c=>c.field===v),[v]);f.useEffect(()=>{n&&M(n).catch(c=>console.log("Error loading visitor list:-",c))},[n]);const w=c=>{const{pageNumber:H,count:$,sortAsc:O,sortColumn:D}=c;M({page:H,count:$,orderBy:D==null?void 0:D.field,order:O!==!1?"asc":"desc"})};return a.jsx(R,{columns:I,sortColumn:m,sortAsc:l==="asc",page:u,rowsPerPage:B,rows:t||[],totalRows:s||0,onChange:w,noRowsMessage:"No visitors found for selected period"})}const E=[{value:"country",label:"Country"},{value:"city",label:"City"},{value:"os",label:"OS Name"},{value:"browser",label:"Browser"},{value:"date",label:"Date"},{value:"landing_page",label:"Landing Page"}],P=[{value:1,label:"Visitor List"},{value:0,label:"Analytics"}],A=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"custom",label:"Custom"}];function se(){const[e,t]=f.useState(P[0]),[s,r]=f.useState(E[0]),[i,o]=f.useState();return a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between py-4",children:[a.jsxs("div",{className:"pt-2",children:[!(e!=null&&e.value)&&a.jsxs("span",{className:"text-sm font-semibold",children:["Analytics - ",s.label," Wise"]}),!!(e!=null&&e.value)&&a.jsx("span",{className:"text-sm font-semibold",children:"Visitor List"}),a.jsx(y,{value:e,onChange:t,items:P,iconOnly:!0,className:"bg-primary pt-0 ps-0 pb-0 pr-0 text-white ms-2 align-middle"})]}),a.jsxs("div",{children:[a.jsx(U,{icon:a.jsx(Y,{}),size:"sm",type:"secondary",className:"mr-2 align-middle"}),!!(e!=null&&e.value)&&a.jsx(y,{value:i||A[0],items:A,className:"bg-[#323131] text-white",onChange:o}),!(e!=null&&e.value)&&a.jsx(y,{value:s,items:E,prefix:"Group by:",onChange:r,className:"bg-[#323131] text-white align-middle"})]})]}),!(e!=null&&e.value)&&a.jsx(ee,{group:s}),!!(e!=null&&e.value)&&a.jsx(te,{dateRangeType:i==null?void 0:i.value})]})}const ae=e=>F.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},F.createElement("path",{d:"M9 16.5C8.3 16.5 7.70833 16.2583 7.225 15.775C6.74167 15.2917 6.5 14.7 6.5 14C6.5 13.3 6.74167 12.7083 7.225 12.225C7.70833 11.7417 8.3 11.5 9 11.5C9.7 11.5 10.2917 11.7417 10.775 12.225C11.2583 12.7083 11.5 13.3 11.5 14C11.5 14.7 11.2583 15.2917 10.775 15.775C10.2917 16.2583 9.7 16.5 9 16.5ZM5 22C4.45 22 3.97917 21.8042 3.5875 21.4125C3.19583 21.0208 3 20.55 3 20V6C3 5.45 3.19583 4.97917 3.5875 4.5875C3.97917 4.19583 4.45 4 5 4H6V2H8V4H16V2H18V4H19C19.55 4 20.0208 4.19583 20.4125 4.5875C20.8042 4.97917 21 5.45 21 6V20C21 20.55 20.8042 21.0208 20.4125 21.4125C20.0208 21.8042 19.55 22 19 22H5ZM5 20H19V10H5V20Z",fill:"#FEF7FF"}));function xe(){const e=d();return f.useEffect(()=>{J().catch(t=>console.error("Unable to load analytics data",t))},[]),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsx(W,{title:"Dashboard",icon:ae})}),a.jsxs("div",{className:"font-primary text-xs py-3 text-[#695656] font-medium",children:["Search Result: ",L(e.fromDate)," - ",L(e.toDate)]}),a.jsx(q,{}),a.jsx(se,{})]})}export{xe as default};
