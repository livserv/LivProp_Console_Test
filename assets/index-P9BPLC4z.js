import{a as D,c as b,R as r,r as R,j as s}from"./index-NAnt_Oc8.js";import{g as f,j as B}from"./ajax-SRoHVB_J.js";import{a as S,C as M,K as V}from"./KbDocsEditor-BFnChVbI.js";import"./env-CmL5wTXD.js";import"./svg-icons-CH5w-DsQ.js";import"./env-CBDBHzQq.js";import"./index-BqrlrnUk.js";import"./KbDocsList-DxLoriHY.js";import"./delete-Dqx8lmRz.js";import"./edit-0Ghe4Q88.js";import"./plus-DoD6YtyP.js";import"./Button-zWOA4jsL.js";import"./TextBox-Dmnm1mCI.js";import"./utils-B3TvvZ68.js";import"./useSelectedBot-B7lWLd04.js";import"./bots-B07VAmi_.js";import"./PageHeader-BVdIbyxJ.js";import"./organization-CG6iBTvh.js";import"./send-DGXH4Oyv.js";import"./index-DqhWLRvm.js";import"./ProgressButton-BBUVoLQ_.js";function ot(e){const o=D(),c=e.organizationId??o.organizationId,d=e.botId??o.botId,m=e.recipientId??o.recipientId,h=e.chatId??o.chatId,{isSuperUser:$}=b(),{isAuthenticated:g}=b(),[p,y]=r.useState(),[i,I]=r.useState(),[u,x]=R.useState(null),v=`/bot/${c}/${d}/chat/history/${m}/${h}?includeBot=1${g?"&includeKB=1":""}${i!=null&&i.code?`&language=${encodeURIComponent(i.code)}`:""}`;r.useEffect(()=>{f(v).then(t=>{var a;const n=B((a=t.messages[0])==null?void 0:a.createdAt);t.botDesign=S(t.botDesign,{window:{width:"600px",height:"calc(100vh - 120px)"},header:{titleText:n+` (${t.titleText})`}}),y(A(t))},t=>{console.error("Unable to load chat conversations:",t)})},[v]);const j=r.useCallback(async(t,n)=>{const a=await f(`/bot/${c}/${d}/chat/history/${m}/${h}/replay/${t}?modelName=${n||""}`);x(a)},[c,d,m,h]);if(!p)return s.jsx("div",{children:"Loading... Please wait..."});const w=t=>{const{role:n,type:a,passedDocIds:l,searchQuery:H}=t||{};if(n!=="assistant"||a!=="text"||!(l!=null&&l.length)&&!H)return null;const C=()=>s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{d:"M19 2H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm0 17H8V4h11v15zm-2-7H10v2h7v-2zm0-4H10v2h7V8zm-9 9H5V5c0-1.1.9-2 2-2h1v2H7v12zm0 2v-2h1v2H7z"})});return s.jsx("span",{className:"ml-2 cursor-pointer",onClick:()=>z(t),children:s.jsx(C,{})})},z=t=>{x(t)};return s.jsxs("div",{className:"conversation-history"+(g?" authenticated":""),children:[s.jsx("div",{children:s.jsx(M,{botDesign:p.botDesign,messages:p.messages,showTime:!0,disabledMessage:!0,optionsRenderer:w,language:i,setLanguage:I,activateVoiceBot:!1})}),u&&s.jsx(V,{message:u,isSuperUser:$,onReplay:j})]})}function A(e){const o=e.messages.length&&e.messages[e.messages.length-1];return(o==null?void 0:o.type)==="options"&&(o.content=""),e}export{ot as default};
