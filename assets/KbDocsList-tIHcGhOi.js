import{c as x,R as M,h as O,e as h,r as m,j as e,f as D}from"./index-DhAF13mr.js";import{k as G,g as L,r as U,p as V,c as k}from"./ajax-CI6-ZEd2.js";import{S as W}from"./delete-CDrQ5BZa.js";import{S as H}from"./edit-D2A2KO32.js";import{S as Q}from"./plus-BQhHuxz7.js";import{B as p}from"./Button-COZJcxZ5.js";import{S as J}from"./TextBox-DHId1yNx.js";import{s as I,h as B}from"./utils-B3TvvZ68.js";import{a as X}from"./bots-BWrOzw8N.js";import{u as y}from"./useSelectedBot-Dt0H2nnB.js";import{P as Y}from"./PageHeader-DFd81B-W.js";import{S as Z}from"./send-NcrvgS99.js";import{F as P,a as ee,d as te}from"./index-BwST3DeH.js";const d=O(()=>({page:1,rowsPerPage:10,totalDocs:0,docsList:[],isLoading:!1,kbDocs:{}}));function se(){const s=x(i=>i.organizationId),[a]=y();M.useEffect(()=>{oe()},[a,s]);const o=d(i=>i.docsList),t=d(i=>i.isLoading);return[o,t]}async function oe(s=1,a=10){const{organizationId:o}=x.getState(),{selectedBotId:t}=h.getState();if(!o||!t)return;const{botId:i}=d.getState(),n={page:s,rowsPerPage:a,isLoading:!0};i!==t&&(n.docsList=[]),d.setState(n);const r=await G.get(`/bot/${o}/${t}/knowledge-base/list`);d.setState({botId:t,docsList:r,totalDocs:r.length,isLoading:!1})}async function De(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState(),{kbDocs:t}=d.getState(),i=await L(`/bot/${o}/${a}/knowledge-base/list`);d.setState(n=>({kbDocs:{...n.docsList||{},[String(a)]:i}}))}async function ne(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState();if(!a)throw new Error("No bot selected");const t=await V(`/bot/${o}/${a}/knowledge-base`,s);return d.setState(i=>{const n=[...i.docsList||[]];if(!Array.isArray(n))return{docsList:[t],totalDocs:1};if(s._id){const r=n.findIndex(l=>l._id===t._id);r>=0?n[r]=t:n.push(t)}else n.push(t);return{docsList:n,totalDocs:n.length}}),t}async function ae(s){const{selectedBotId:a}=h.getState(),{organizationId:o}=x.getState();if(!a)throw new Error("No bot selected");await U(`/bot/${o}/${a}/knowledge-base/${s}`,s),d.setState(t=>{const n=[...t.docsList||[]].filter(r=>r._id!==s);return{docsList:n,totalDocs:n.length}})}async function ye(s){if(!(s!=null&&s.length))return[];const{organizationId:a}=x.getState(),{selectedBotId:o}=h.getState();return await L(`/bot/${a}/${o}/knowledge-base/list?${s.map(t=>`docIds=${t}`).join("&")}`)}function A({onDone:s,initial:a}){const[o,t]=m.useState(a||{question:"",content:"",_id:""}),i=(r,l)=>{t(f=>({...f,[r]:l}))},n=async()=>{await ne(o),s()};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"font-bold text-lg pb-1 text-center",children:"Add document"}),e.jsxs(P,{value:o,onChange:t,children:[e.jsx(ee,{field:"question",placeholder:"Provide title or question for the content",label:"Question",wrapperClassName:"h-6",onChange:r=>i("question",r)}),e.jsx(te,{field:"content",placeholder:"Provide content or answer for the question",label:"Content",className:"h-24",onChange:r=>i("content",r)})]}),e.jsx("div",{className:"text-center",children:e.jsx(p,{icon:e.jsx(Z,{}),size:"lg",type:"rounded",onClick:n,className:"bg-[#49d4a1]"})})]})}function ie(s){const{activeIndex:a,onNavigate:o=()=>{},docsList:t}=s,[i]=y(),[n,r]=se(),l=t??n,[f,$]=m.useState(10),[g,j]=m.useState(1),[w,E]=m.useState(""),_=[10,15,20,25],N=(l||[]).filter(c=>{var u,C;return!w||((u=c.question)==null?void 0:u.toLowerCase().includes(w.toLowerCase()))||((C=c.content)==null?void 0:C.toLowerCase().includes(w.toLowerCase()))}),b=Math.ceil(N.length/f),S=(g-1)*f,q=S+f,v=N.slice(S,q),R=()=>B(),z=()=>I(e.jsx(A,{onDone:R}),{showCloseButton:!0,width:"700px"});m.useEffect(()=>{g>b&&j(1)},[N.length,b,g]);const F=c=>{const u=typeof c=="string"?parseInt(c,10):c;typeof u=="number"&&!isNaN(u)&&($(u),j(1))},K=c=>{c<1||c>b||j(c)},T=async()=>{try{await X(i,{verificationStatus:!0})?D(!0,"The bot verified successfully","success"):D(!0,"Not able to verify the bot. Try after sometime!","error"),a&&o(a+1)}catch(c){console.error("Error during bot verification:",c),D(!0,"Not able to verify the bot. Try after sometime!","error")}};return e.jsxs("div",{className:"flex flex-col min-h-full",children:[!t&&!a&&e.jsx("div",{className:"mb-4",children:e.jsx(Y,{title:"Chat Bot Knowledge",icon:Q,search:!0,onSearchChange:E,onClick:z})}),e.jsxs("div",{className:k("w-full border border-mildGreyBGAlt rounded bg-white flex-1 flex flex-col",{"opacity-50":r}),children:[e.jsx("div",{className:"flex-1",children:r?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"Loading..."}):v.length===0?e.jsx("div",{className:"flex justify-center items-center h-32 text-gray-500",children:"No documents found."}):v.map((c,u)=>e.jsx(re,{doc:c,index:S+u},c._id))}),!t&&e.jsx("div",{className:"w-full flex flex-row px-4 py-3 gap-8 border-t border-gray-100 bg-white mt-auto",children:e.jsx(le,{count:f,counts:_,currentPage:g,totalPages:b,onChangeCount:F,goToPage:K})})]}),a&&!t&&e.jsx("div",{className:"flex mt-6 justify-end",children:e.jsx(p,{label:"GENERATE",onClick:T})})]})}function re({doc:s,index:a}){var n;const[,o]=y(),t=()=>{I(e.jsx(A,{onDone:B,initial:{question:s.question||"",content:s.content||"",_id:s._id}}),{showCloseButton:!0,width:"700px"})},i=async r=>{console.log("Deleting document with ID:",r),await ae(r)};return e.jsxs("div",{className:k("w-full flex flex-row px-4 py-3 gap-8 border-b border-gray-100",{"bg-white":a%2!==0,"bg-[#f7f7f7]":a%2===0}),children:[e.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[!!s.question&&e.jsx("span",{className:"font-normal text-md",children:s.question}),e.jsx("div",{className:"text-xs overflow-hidden line-clamp-3",children:s.content}),!!s.sourceDocument&&((n=o==null?void 0:o.trainingMedia)==null?void 0:n.length)>0&&e.jsx(ce,{document:s,trainingMedia:o.trainingMedia})]}),e.jsxs("div",{className:"flex flex-row my-auto w-[130px]",children:[e.jsx(p,{icon:e.jsx(W,{height:24,width:24}),type:"plain",className:"me-8",onClick:()=>i(s._id)}),e.jsx(p,{icon:e.jsx(H,{height:24,width:24}),type:"plain",className:"me-8",onClick:t})]})]})}function ce({document:s,trainingMedia:a}){const o=s.sourceDocument,t=m.useMemo(()=>{if(!a||!o)return null;const i=a.find(r=>r.docId===o);if(!i)return null;let n="";return i.url?n=decodeURIComponent(i.url.substring(i.url.lastIndexOf("/")+1)):i.originalName&&(n=i.originalName),{...i,fileName:n}},[o,a]);return t?e.jsxs("span",{className:"text-[8px]",children:[e.jsx("strong",{className:"me-1",children:"Source Document:"}),t.url?e.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:[t.fileName,t.name?` ( ${t.name} )`:""]}):e.jsx("span",{children:t.fileName||t.name||"Unknown Document"})]}):null}const le=({count:s,counts:a,currentPage:o,totalPages:t,onChangeCount:i,goToPage:n})=>{const r=a.map(l=>({label:l,value:l}));return e.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 min-w-max",children:"Rows per page"}),e.jsx(J,{className:"border border-gray-300 rounded px-2 py-1",value:s,options:r,showClear:!1,onChange:l=>i(l)})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(1),disabled:o===1,children:"«"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(o-1),disabled:o===1,children:"‹"}),e.jsxs("span",{className:"px-2 text-sm font-medium",children:[o," of ",t||1]}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(o+1),disabled:o>=t||!t,children:"›"}),e.jsx("button",{className:"font-bold text-2xl disabled:text-[#695A5A]",onClick:()=>n(t),disabled:o>=t||!t,children:"»"})]})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{ie as K,ye as a,ve as b,De as g,d as u};
