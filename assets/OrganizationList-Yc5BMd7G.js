import{j as e,h,r as l,c as P,S as B,R as v}from"./AlertSnackbar-Cu3h0plZ.js";import{c as o}from"./index-Dg8oRa5J.js";import{F as H,b as w}from"./formik.esm-C5vJFWWq.js";import"./Button-CdgpWTFt.js";import{T as x}from"./Toggle-CcqCGqkZ.js";import{P as K}from"./ProgressButton-Bv9WgXBa.js";import{u as z,g as _}from"./organization-DVIpOgT3.js";import{S as E}from"./download-CzRVVFET.js";import{p as $,i as k,f as F,m as V}from"./ajax-C92vMgMI.js";/* empty css                */import{T as O}from"./Table-Bn0KppKC.js";import{E as W}from"./ChatbotIcons-CUhGyjS-.js";import{t as q}from"./common-PFIJTlAS.js";import{A as G}from"./env-DWkyVZs8.js";import{S as J}from"./TableFooter-BVFgPTOX.js";import{S as Q}from"./settings-DiPUJCAI.js";import{B as D}from"./Button-xOGl-aJM.js";import{S as X}from"./SelectButton-DTQpfNsr.js";import{T as Y}from"./TextBox-5aOHTS0e.js";import{s as Z}from"./utils-BPLOM7gE.js";import{P as ee}from"./PageHeader-DOOQ2yEQ.js";import"./env-CmL5wTXD.js";import"./SelectBox-BDGweDPH.js";import"./LabelWrapper-EgF8sr7h.js";import"./useSelectedBot-Be2ooMzm.js";function te({organizationId:c,consoleDisplaySettings:r={},onDone:m}){const f={hideTrainingTab:r?.hideTrainingTab||!1,hideSettingsTab:r?.hideSettingsTab||!1,hideKBTab:r?.hideKBTab||!1,hideMediaTab:r?.hideMediaTab||!1,hideDesignTab:r?.hideDesignTab||!1,hideFlowDesignTab:r?.hideFlowDesignTab??!0},g=async s=>{try{await z({settings:s},c),h(!0,"Console display settings updated successfully","success"),m()}catch{h(!0,"Not able to update the console display settings. Try after sometime!","error")}};return e.jsx(H,{initialValues:f,onSubmit:g,children:({values:s,handleChange:n,isSubmitting:u,handleSubmit:d})=>e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold border-b pb-2",children:"Console Settings"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Hide Settings"}),e.jsx(w,{as:x,name:"hideSettingsTab",checked:s.hideSettingsTab,onChange:()=>n({target:{name:"hideSettingsTab",value:!s.hideSettingsTab}})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Hide Knowledge Base"}),e.jsx(w,{as:x,name:"hideKBTab",checked:s.hideKBTab,onChange:()=>n({target:{name:"hideKBTab",value:!s.hideKBTab}})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Hide Conversation Media"}),e.jsx(w,{as:x,name:"hideMediaTab",checked:s.hideMediaTab,onChange:()=>n({target:{name:"hideMediaTab",value:!s.hideMediaTab}})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Hide Bot Design"}),e.jsx(w,{as:x,name:"hideDesignTab",checked:s.hideDesignTab,onChange:()=>n({target:{name:"hideDesignTab",value:!s.hideDesignTab}})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Hide Bot Flow"}),e.jsx(w,{as:x,name:"hideFlowDesignTab",checked:s.hideFlowDesignTab,onChange:()=>n({target:{name:"hideFlowDesignTab",value:!s.hideFlowDesignTab}})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(K,{isLoading:u,disabled:u,type:"submit",children:"Update"})})]})})}async function ae(c){return await $(c,{})}function se(){const[,c]=l.useState(1),[,r]=l.useState(10),[m,f]=l.useState(!0),[g,s]=l.useState(!1),[n,u]=l.useState(null),d=P(a=>a.organizationsInvoiceList),T=q(G,"/");l.useEffect(()=>{p()},[]);const p=async()=>{try{f(!0),await _()}catch{h(!0,"Not able to fetch Organizations Invoice. Try after sometime!","error")}finally{f(!1)}},y=async(a,b)=>{try{s(!0),u(b);const j=await ae(a),{sentCount:N,totalCount:C}=j;h(!0,`${N} invoices sent out of ${C} to the organizations`,"success"),await p()}catch{h(!0,"Not able to send the invoices to organizations. Try after sometime!","error")}finally{s(!1),u(null)}},S=[{field:"period",title:"Invoice Period",sortable:!0,cellClassName:o("text-left")},{field:"totalInvoices",title:"Total Invoices",sortable:!0,cellClassName:o("text-center")},{field:"invoiceDate",title:"Invoice Date",sortable:!0,cellClassName:o("text-left"),template:a=>k(a.invoiceDate)},{field:"totalAmount",title:"Total Amount",sortable:!0,cellClassName:o("text-center"),template:a=>F(a.totalAmount)},{field:"emailPendingCount",title:"Pending Email",sortable:!0,cellClassName:o("text-center")},{field:"downloadPath",title:"Download",cellClassName:o("text-center"),template:a=>e.jsx("a",{href:T+a.downloadPath,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 hover:text-blue-800",title:"Download",children:e.jsx(E,{})})},{field:"triggerEmailPath",title:"Send Email",cellClassName:o("text-center"),template:a=>a.triggerEmailPath?e.jsx("button",{onClick:()=>y(a.triggerEmailPath,a.period),disabled:g,className:"inline-flex items-center text-green-600 hover:text-green-800 disabled:opacity-50 disabled:cursor-not-allowed",title:"Send email",children:n===a.period?e.jsx(B,{}):e.jsx(W,{})}):null}];return m?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(B,{})}):!d||d.length===0?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No Data Available"})}):e.jsx("div",{className:"flex flex-col gap-3",children:e.jsx(O,{rows:d,columns:S,totalRows:d.length,pagination:!0,onChange:({pageNumber:a,count:b})=>{c(a),r(b)}})})}const I=[{value:0,label:"Organization List"},{value:1,label:"Organization Invoice"}];function Ie(){const[c,r]=l.useState(1),[m,f]=l.useState(10),[g,s]=l.useState(""),[n,u]=v.useState(I[0]),[d,T]=v.useState(),[,p]=l.useState(!1),[y,S]=l.useState(),a=P(t=>t.organizationList),b=[{field:"name",title:"Name",sortable:!0},{field:"websiteUrl",title:"Website",cellClassName:o("max-w-[250px]"),hideBelow:"lg",template:t=>!!t.websiteUrl&&e.jsx("a",{href:t.websiteUrl,target:"_blank",title:t.websiteUrl,rel:"noreferrer noopener",children:V(t.websiteUrl)})},{field:"email",title:"Email",cellClassName:o("max-w-[250px]"),hideBelow:"sm"},{field:"registeredAt",title:"Registered Date",hideBelow:"xl",sortable:!0},{field:"credits",title:"Credits",hideBelow:"lg",sortable:!0},{field:"managed",title:"Managed",cellClassName:o("text-center"),hideBelow:"md",template:t=>e.jsx(x,{checked:t.handledByLivServ,containerClassName:"mx-auto",onChange:i=>U(i,t._id)})},{field:"",title:"",cellClassName:o("text-center"),template:t=>e.jsx(D,{icon:e.jsx(Q,{}),type:"plain",onClick:()=>N(t._id,t.settings)})}],j=v.useMemo(()=>a.map(t=>({_id:t._id,name:t.organizationName,websiteUrl:t.websiteUrl,email:t.admins.map(i=>i.email).join(", "),registeredAt:k(t.registeredAt),credits:F(t.availableCredits),handledByLivServ:t.handledByLivServ,settings:t.settings})),[a]),N=(t,i)=>{T(t),S(i),p(!0)},C=t=>Z(e.jsx(te,{organizationId:t,consoleDisplaySettings:y,onDone:()=>p(!1)}),{showCloseButton:!0,width:"700px"});l.useEffect(()=>{d&&C(d)},[d]);const U=async(t,i)=>{const A=t,R=i;try{await z({handledByLivServ:A},R),h(!0,"Handled by LivServ updated successfully","success")}catch{h(!0,"Not able to update the Handled by LivServ. Try after sometime!","error")}},L=v.useMemo(()=>{const t=g?.toLowerCase()?.trim();return t?j.filter(i=>i.name?.toLowerCase().includes(t)||i.email?.toLowerCase().includes(t)||i.websiteUrl?.toLowerCase().includes(t)):j},[g,j]),M=v.useMemo(()=>{const t=(c-1)*m,i=t+m;return L.slice(t,i)},[L,c,m]);return e.jsxs("div",{children:[e.jsx(ee,{title:"Organizations"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:n.value===0?"Organization List":"Organization Invoice"}),e.jsx(X,{value:n,onChange:u,items:I,iconOnly:!0,className:"bg-primary pt-0 ps-0 pb-0 pr-0 text-white ms-2 align-middle"})]}),n.value===0&&e.jsxs("div",{className:"flex justify-between items-center py-2 px-2",children:[e.jsx(Y,{value:g,placeholder:"Search",onChange:t=>s(t.target.value),iconRight:J}),e.jsx(D,{icon:e.jsx(E,{}),size:"sm",type:"secondary",className:"mx-2 align-middle"})]})]}),n.value===0?e.jsx(O,{rows:M,columns:b,totalRows:L?.length,pagination:!0,onChange:({pageNumber:t,count:i})=>{r(t),f(i)}}):e.jsx(se,{})]})]})}export{Ie as default};
