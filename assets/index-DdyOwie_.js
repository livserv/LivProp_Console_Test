import{c as x,R as n,r as D,j as t}from"./index-DuC4Mltx.js";import{g as v,j as R}from"./ajax-Dg5qCVW5.js";import{a as B,C as S}from"./index-n866CRcs.js";import{K as M}from"./KbDocsEditor-RbUBlcoI.js";import"./env-CmL5wTXD.js";import"./svg-icons-DkfMjFdL.js";import"./env-CBDBHzQq.js";import"./index-L9XfBzKq.js";import"./KbDocsList-E4K6qYHY.js";import"./delete-Ds-TzRmI.js";import"./edit-umyf-Zsk.js";import"./plus-DfhLrlb5.js";import"./Button-DdsXQ3Sk.js";import"./TextBox-ZHvCDHRT.js";import"./utils-B3TvvZ68.js";import"./bots-CP-zys72.js";import"./useSelectedBot-tpsOa1Oj.js";import"./PageHeader-1XJ8iS48.js";import"./organization-Cx6sJydY.js";import"./send-BbQUsHBI.js";import"./index-BUR5OX-W.js";import"./ProgressButton-6GlyEWs_.js";function ee({organizationId:s,botId:o,recipientId:c,chatId:m}){const{isSuperUser:f}=x(),{isAuthenticated:l}=x(),[p,$]=n.useState(),[r,y]=n.useState(),[d,u]=D.useState(null),g=`/bot/${s}/${o}/chat/history/${c}/${m}?includeBot=1${l?"&includeKB=1":""}${r!=null&&r.code?`&language=${encodeURIComponent(r.code)}`:""}`;n.useEffect(()=>{v(g).then(e=>{var a;const i=R((a=e.messages[0])==null?void 0:a.createdAt);e.botDesign=B(e.botDesign,{window:{width:"600px",height:"calc(100vh - 120px)"},header:{titleText:i+` (${e.titleText})`}}),$(V(e))},e=>{console.error("Unable to load chat conversations:",e)})},[g]);const j=n.useCallback(async(e,i)=>{const a=await v(`/bot/${s}/${o}/chat/history/${c}/${m}/replay/${e}?modelName=${i||""}`);u(a)},[s,o,c,m]);if(!p)return t.jsx("div",{children:"Loading... Please wait..."});const b=e=>{const{role:i,type:a,passedDocIds:h,searchQuery:H}=e||{};if(i!=="assistant"||a!=="text"||!(h!=null&&h.length)&&!H)return null;const C=()=>t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:t.jsx("path",{d:"M19 2H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm0 17H8V4h11v15zm-2-7H10v2h7v-2zm0-4H10v2h7V8zm-9 9H5V5c0-1.1.9-2 2-2h1v2H7v12zm0 2v-2h1v2H7z"})});return t.jsx("span",{className:"ml-2 cursor-pointer",onClick:()=>w(e),children:t.jsx(C,{})})},w=e=>{u(e)};return t.jsxs("div",{className:"conversation-history"+(l?" authenticated":""),children:[t.jsx("div",{children:t.jsx(S,{botDesign:p.botDesign,messages:p.messages,showTime:!0,disabledMessage:!0,optionsRenderer:b,language:r,setLanguage:y,activateVoiceBot:!1})}),d&&t.jsx(M,{message:d,isSuperUser:f,onReplay:j})]})}function V(s){const o=s.messages.length&&s.messages[s.messages.length-1];return(o==null?void 0:o.type)==="options"&&(o.content=""),s}export{ee as default};
